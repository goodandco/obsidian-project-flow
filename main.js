/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var Ye=Object.defineProperty;var zt=Object.getOwnPropertyDescriptor;var Ht=Object.getOwnPropertyNames;var Kt=Object.prototype.hasOwnProperty;var _=(e,t)=>()=>(e&&(t=e(e=0)),t);var L=(e,t)=>{for(var r in t)Ye(e,r,{get:t[r],enumerable:!0})},qt=(e,t,r,o)=>{if(t&&typeof t=="object"||typeof t=="function")for(let n of Ht(t))!Kt.call(e,n)&&n!==r&&Ye(e,n,{get:()=>t[n],enumerable:!(o=zt(t,n))||o.enumerable});return e};var Xt=e=>qt(Ye({},"__esModule",{value:!0}),e);var it={};L(it,{DEFAULT_ENTITY_TYPES:()=>re,DEFAULT_PROJECT_TYPES:()=>ne});var re,ne,ue=_(()=>{re={task:{id:"task",name:"Task",templatePath:"template-task.md",targetFolder:"Work/Tasks",filenameRule:"${PROJECT_ID}-${TITLE}",requiredFields:["TITLE"],patchMarkers:["AI:CONTENT","AI:ACTIONS"]},"meeting.planning":{id:"meeting.planning",name:"Meeting (Planning)",templatePath:"template-meeting-planning.md",targetFolder:"Meetings",filenameRule:"${DATE} ${TITLE}",requiredFields:["TITLE"],patchMarkers:["AI:AGENDA","AI:NOTES","AI:ACTIONS"]},"meeting.refinement":{id:"meeting.refinement",name:"Meeting (Refinement)",templatePath:"template-meeting-refinement.md",targetFolder:"Meetings",filenameRule:"${DATE} ${TITLE}",requiredFields:["TITLE"],patchMarkers:["AI:AGENDA","AI:NOTES","AI:ACTIONS"]},"meeting.retro":{id:"meeting.retro",name:"Meeting (Retro)",templatePath:"template-meeting-retro.md",targetFolder:"Meetings",filenameRule:"${DATE} ${TITLE}",requiredFields:["TITLE"],patchMarkers:["AI:AGENDA","AI:NOTES","AI:ACTIONS"]},"meeting.demo":{id:"meeting.demo",name:"Meeting (Demo)",templatePath:"template-meeting-demo.md",targetFolder:"Meetings",filenameRule:"${DATE} ${TITLE}",requiredFields:["TITLE"],patchMarkers:["AI:AGENDA","AI:NOTES","AI:ACTIONS"]},"meeting.daily":{id:"meeting.daily",name:"Meeting (Daily)",templatePath:"template-meeting-daily.md",targetFolder:"Meetings",filenameRule:"${DATE} ${TITLE}",requiredFields:["TITLE"],patchMarkers:["AI:AGENDA","AI:NOTES","AI:ACTIONS"]},"meeting.knowledge":{id:"meeting.knowledge",name:"Meeting (Knowledge)",templatePath:"template-meeting-knowledge.md",targetFolder:"Meetings",filenameRule:"${DATE} ${TITLE}",requiredFields:["TITLE"],patchMarkers:["AI:AGENDA","AI:NOTES","AI:ACTIONS"]},sprint:{id:"sprint",name:"Sprint",templatePath:"template-sprint.md",targetFolder:"Work",filenameRule:"Sprint ${TITLE}",requiredFields:["TITLE"],patchMarkers:["AI:CONTENT","AI:ACTIONS"]},idea:{id:"idea",name:"Idea",templatePath:"template-idea.md",targetFolder:"Knowledge Base",filenameRule:"Idea ${TITLE}",requiredFields:["TITLE"],patchMarkers:["AI:CONTENT"]}},ne={operational:{id:"operational",name:"Operational",description:"Default ProjectFlow structure for active projects.",folderStructure:["Knowledge Base","Meetings","Work","Work/Tasks","People"],initialNotes:[{fileName:"${PROJECT_FULL_NAME}.md",template:"project.md"},{fileName:"${PROJECT_NAME} Meetings.md",template:"meetings.md"},{fileName:"${PROJECT_NAME} People.md",template:"people.md"},{fileName:"${PROJECT_NAME} Work.md",template:"work.md"},{fileName:"${PROJECT_NAME} Knowledge Base.md",template:"knowledge-base.md"}],allowedEntityTypes:Object.keys(re)}}});var se={};L(se,{SafeFileManager:()=>ze});var ze,ae=_(()=>{ze=class{constructor(t){this.vault=t.vault}async createBatch(t){let r=[];try{for(let o of t)o.type==="folder"?await this.ensureFolder(o.path):await this.createIfAbsent(o.path,o.data)==="created"&&r.push(o.path);return{ok:!0}}catch(o){for(let n of r.reverse())try{let s=this.vault.getAbstractFileByPath(n);s&&this.vault.delete&&await this.vault.delete(s)}catch(s){}return{ok:!1,error:o}}}async has(t){var r;try{return this.vault.getAbstractFileByPath(t)?!0:(r=this.vault.adapter)!=null&&r.exists?await this.vault.adapter.exists(t):!1}catch(o){return!1}}async ensureFolder(t){var o;if(!this.vault.getAbstractFileByPath(t))try{await this.vault.createFolder(t)}catch(n){if(n&&typeof n=="object"&&((o=n.message)!=null&&o.includes("Parent folder"))){let s=t.split("/").filter(Boolean),a="";for(let l of s)if(a=a?`${a}/${l}`:l,!this.vault.getAbstractFileByPath(a))try{await this.vault.createFolder(a)}catch(c){}}}}async createIfAbsent(t,r){if(await this.has(t))return"skipped";try{return await this.vault.create(t,r),"created"}catch(o){return await this.has(t),"skipped"}}async removeDir(t){let r=this.vault.getAbstractFileByPath(t);if(r&&this.vault)try{await this.vault.trash(r,!0),await new Promise(o=>setTimeout(o,200))}catch(o){console.warn(`removeDir: failed to trash ${t}: ${o}`)}else console.warn(`removeDir: file not found: ${t}. File: ${r==null?void 0:r.path}`)}}});var fe={};L(fe,{sanitizeFileName:()=>Ae,sanitizePath:()=>V});function Ae(e){let t=(e!=null?e:"").trim();return Array.from(t).filter(o=>o.charCodeAt(0)>=32).join("").replace(/[\\/:*?"<>|]/g,"-").replace(/\s+/g," ").replace(/\.+$/g,"").substring(0,200)||"untitled"}function V(e){return e?e.split("/").filter(Boolean).map(Ae).join("/"):""}var ie=_(()=>{});var he={};L(he,{PROJECT_INDEX_VERSION:()=>Zt,addToProjectIndex:()=>er,buildProjectIndex:()=>lt,ensureProjectIndex:()=>$e,getProjectIndexCache:()=>Fe,removeFromProjectIndex:()=>tr,setProjectIndexCache:()=>Qt,toIndexEntry:()=>He});function Fe(){return Ie}function Qt(e){Ie=e}function lt(e){let t={},r={},o={};if(e&&typeof e=="object"){for(let[n,s]of Object.entries(e))if(!(!s||typeof s!="object")){for(let[a,l]of Object.entries(s))if(!(!l||typeof l!="object"))for(let[c,i]of Object.entries(l)){if(!i||!i.variables||!i.info)continue;let d=He(i,c,n,a);t[d.fullName]=d,r[d.projectId]=d,o[d.projectTag]=d}}}return{version:1,byFullName:t,byId:r,byTag:o}}function He(e,t,r,o){var n;return{fullName:e.variables.PROJECT_FULL_NAME,projectId:t,projectTag:e.variables.PROJECT_TAG,path:e.variables.PROJECT_PATH,dimension:r,category:o,projectName:e.info.name,parent:(n=e.info.parent)!=null?n:null}}function $e(e,t){if(!e||e.version!==1){let r=lt(t);return Ie=r,{index:r,updated:!0}}return Ie=e,{index:e,updated:!1}}function er(e,t,r,o,n){let s=He(t,r,o,n);return e.byFullName[s.fullName]=s,e.byId[s.projectId]=s,e.byTag[s.projectTag]=s,e}function tr(e,t){return delete e.byFullName[t.fullName],delete e.byId[t.projectId],delete e.byTag[t.projectTag],e}var Zt,Ie,le=_(()=>{Zt=1,Ie=null});var Pe={};L(Pe,{PROJECT_GRAPH_VERSION:()=>rr,addProjectToGraph:()=>sr,buildProjectGraph:()=>Ke,cleanArchivedGraph:()=>qe,ensureProjectGraph:()=>ye,getChildren:()=>Xe,getParents:()=>Ze,getProjectGraphCache:()=>or,removeProjectFromGraph:()=>ar,setProjectGraphCache:()=>nr});function or(){return Ne}function nr(e){Ne=e}function Ke(e,t){let r={},o={};return e&&dt(e,r),t&&dt(t,o),{version:1,byFullName:r,archivedByFullName:o}}function ye(e,t,r){if(!e||e.version!==1){let o=Ke(t,r);return Ne=o,{graph:o,updated:!0}}return Ne=e,{graph:e,updated:!1}}function sr(e,t,r){let o=t.variables.PROJECT_FULL_NAME,n=pt(t.info.parent),s=r?e.archivedByFullName:e.byFullName;if(s[o]=s[o]||{parent:n,children:[]},s[o].parent=n!=null?n:null,n){let a=s[n]||{parent:null,children:[]};a.children.includes(o)||a.children.push(o),s[n]=a}return e}function ar(e,t,r){let o=r?e.archivedByFullName:e.byFullName,n=o[t];return n!=null&&n.parent&&o[n.parent]&&(o[n.parent].children=o[n.parent].children.filter(s=>s!==t)),delete o[t],e}function qe(e,t){let r=Ke(void 0,t);return e.archivedByFullName=r.archivedByFullName,e}function Xe(e,t,r){var n,s;return(s=(n=(r?e.archivedByFullName:e.byFullName)[t])==null?void 0:n.children)!=null?s:[]}function Ze(e,t,r){var a,l,c,i;let o=r?e.archivedByFullName:e.byFullName,n=[],s=(l=(a=o[t])==null?void 0:a.parent)!=null?l:null;for(;s;)n.push(s),s=(i=(c=o[s])==null?void 0:c.parent)!=null?i:null;return n}function dt(e,t){for(let r of Object.values(e))for(let o of Object.values(r))for(let n of Object.values(o)){if(!n||!n.variables)continue;let s=n.variables.PROJECT_FULL_NAME,a=pt(n.info.parent);if(t[s]=t[s]||{parent:a,children:[]},t[s].parent=a!=null?a:null,a){let l=t[a]||{parent:null,children:[]};l.children.includes(s)||l.children.push(s),t[a]=l}}}function pt(e){let t=e==null?void 0:e.trim();return t&&t.length>0?t:null}var rr,Ne,de=_(()=>{rr=1,Ne=null});var ft={};L(ft,{ensureValidOrThrow:()=>pr,validateProjectName:()=>lr,validateTag:()=>dr});function lr(e){if(!e||!e.trim())return{ok:!1,reason:"Project name is required"};let t=e.trim();if(t.length>120)return{ok:!1,reason:"Project name too long (max 120)"};for(let r of t)if(r.charCodeAt(0)<32||r==="/"||r==="\\")return{ok:!1,reason:"Project name contains invalid characters"};return{ok:!0}}function dr(e){if(!e||!e.trim())return{ok:!1,reason:"Tag is required"};let t=e.trim();return cr.test(t)?{ok:!0}:{ok:!1,reason:"Tag must be 2-63 chars, start with letter/digit; may include -, _, /"}}function pr(e,t){let r=e();if(!r.ok)throw new Error(`${t}: ${r.reason}`)}var cr,ht=_(()=>{cr=/^[A-Za-z0-9][A-Za-z0-9_/-]{1,62}$/});var Me={};L(Me,{processTemplate:()=>mr});function Pt(e){return e==null?"":String(e)}function mr(e,t){if(!e||typeof e!="string")return"";let r=e;for(let[o,n]of Object.entries(t)){let s=Pt(n),a=`$_${o}`;r.includes(a)&&(r=r.split(a).join(s))}for(let[o,n]of Object.entries(t)){let s=Pt(n),a=new RegExp(`\\$\\{${gr(o)}\\}`,"g");r=r.replace(a,s)}return r}function gr(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}var Ge=_(()=>{});function jt(e,t){let r=new Date,o=r.getFullYear().toString(),n=r.toISOString().split("T")[0],s=t.projectsRoot||"1. Projects",a=e.parent&&e.parent.trim().length>0?`.${e.parent.trim()}`:"",l=`${o}${a}.${e.name}`,c=t.dimensions.find(g=>g.name===e.dimension),i=c?`${c.order}. ${c.name}`:e.dimension,d=`${s}/${i}/${e.category}/${l}`,f=`${d}`;return{PROJECT_NAME:e.name,PROJECT_TAG:e.tag,PROJECT_PARENT:e.parent?e.parent:"",PARENT_TAG:e.parent?e.tag:"",YEAR:o,DATE:n,PROJECT_FULL_NAME:l,PROJECT_RELATIVE_PATH:d,PROJECT_PATH:f,DIMENSION:c?c.name:e.dimension,CATEGORY:e.category,PROJECT_ID:e.id,PROJECT_DIMENSION:c?c.name:e.dimension}}async function Le(e,t){try{let{processTemplate:r}=await Promise.resolve().then(()=>(Ge(),Me));return r(e,t)}catch(r){console.warn("Template processor import failed, using legacy replacement:",r);let o=e;return Object.entries(t).forEach(([n,s])=>{let a=`$_${n}`;o=o.split(a).join(s)}),o}}var Tt=_(()=>{});var wt={};L(wt,{mergeEntityTypes:()=>Be,mergeProjectTypes:()=>me});function Be(e){let t={...re};if(e&&typeof e=="object")for(let[r,o]of Object.entries(e))!o||typeof o!="object"||(t[r]={...t[r],...o,id:r});return t}function me(e){let t={...ne};if(e&&typeof e=="object")for(let[r,o]of Object.entries(e))!o||typeof o!="object"||(t[r]={...t[r],...o,id:r});return t}var Je=_(()=>{ue()});var Rt={};L(Rt,{resolveProjectType:()=>ur});function ur(e,t){let r=me(e.projectTypes),o=t==null?void 0:t.projectTypeId,n=o&&r[o]?o:"operational",s=r[n]||r.operational;return{projectTypeId:n,projectType:s}}var vt=_(()=>{Je()});async function Ve(e,t){var r,o;try{let{resolveProjectType:n}=await Promise.resolve().then(()=>(vt(),Rt)),{projectTypeId:s,projectType:a}=n(e.settings,t);t.projectTypeId=s;let l=jt(t,e.settings),c=e.settings.projectsRoot||"1. Projects",{sanitizePath:i,sanitizeFileName:d}=await Promise.resolve().then(()=>(ie(),fe)),{SafeFileManager:f}=await Promise.resolve().then(()=>(ae(),se)),g=new f(e.app),m=i(c),u=e.settings.dimensions.find(h=>h.name===t.dimension),y=u?`${u.order}. ${u.name}`:t.dimension,P=d(y),j=d(t.category),A=i(`${m}/${P}/${j}/${l.PROJECT_FULL_NAME}`),U=(r=a==null?void 0:a.folderStructure)!=null?r:["Knowledge Base","Meetings","Work","Work/Tasks","People"],Q=[{type:"folder",path:A},...U.map(h=>({type:"folder",path:i(`${A}/${h}`)}))],O=e.app.vault.adapter,W=`.obsidian/plugins/${e.manifest.id}/src/templates`,p=(o=a==null?void 0:a.initialNotes)!=null?o:[{fileName:`${l.PROJECT_FULL_NAME}.md`,template:"project.md"},{fileName:`${t.name} Meetings.md`,template:"meetings.md"},{fileName:`${t.name} People.md`,template:"people.md"},{fileName:`${t.name} Work.md`,template:"work.md"},{fileName:`${t.name} Knowledge Base.md`,template:"knowledge-base.md"}],v=[];for(let h of p){let w=h.fileName?await Le(h.fileName,l):h.fileName,k=`${W}/${h.template}`;if(!await O.exists(k))throw new Error(`Template file not found: ${h.template}`);let B=await O.read(k),J=await Le(B,l),S=i(`${A}/${d(w)}`);v.push({type:"file",path:S,data:J})}let F=await g.createBatch([...Q,...v]);if(!("ok"in F)||!F.ok)throw new Error(`Batch creation failed: ${F.error||"unknown"}`);return await yr(e,t.name,l),await fr(e,t,l),[!0,`Project "${t.name}" created successfully!`]}catch(n){return[!1,`Error creating project: ${n}`]}}async function fr(e,t,r){try{let{ensureProjectIndex:o,addToProjectIndex:n}=await Promise.resolve().then(()=>(le(),he)),{ensureProjectGraph:s,addProjectToGraph:a}=await Promise.resolve().then(()=>(de(),Pe)),l={info:t,variables:r,createdAt:new Date().toISOString()},c=t.dimension,i=t.category,d=t.id;if(!e.settings.projectRecords||Array.isArray(e.settings.projectRecords)){let u={},y=Array.isArray(e.settings.projectRecords)?e.settings.projectRecords:[];for(let P of y){let j=P.info.dimension,A=P.info.category,U=P.info.id;u[j]=u[j]||{},u[j][A]=u[j][A]||{},u[j][A][U]=P}e.settings.projectRecords=u}let f=e.settings.projectRecords;if(f[c]=f[c]||{},f[c][i]=f[c][i]||{},f[c][i][d])throw new Error(`Project with id "${d}" already exists in ${c}:${i}`);f[c][i][d]=l;let{index:g}=o(e.settings.projectIndex,f);e.settings.projectIndex=n(g,l,d,c,i);let{graph:m}=s(e.settings.projectGraph,f,e.settings.archivedRecords);e.settings.projectGraph=a(m,l,!1),await e.saveData(e.settings)}catch(o){throw console.warn("Failed to record project creation:",o),o}}async function hr(e,t,r,o,n){try{let s=e.app.vault.adapter,a=`.obsidian/plugins/${e.manifest.id}/src/templates/${o}`;if(!await s.exists(a))throw new Error(`Template file not found: ${o}`);let l=await s.read(a),c=await Le(l,n),i=`${t}/${r}`,{SafeFileManager:d}=await Promise.resolve().then(()=>(ae(),se));await new d(e.app).createIfAbsent(i,c)}catch(s){throw console.error(`Failed to create ${r}:`,s),new Error(`Failed to create ${r}: ${s}`)}}async function yr(e,t,r){let{sanitizePath:o,sanitizeFileName:n}=await Promise.resolve().then(()=>(ie(),fe)),{SafeFileManager:s}=await Promise.resolve().then(()=>(ae(),se)),a=new s(e.app),l=o(`Templates/${t}_Templates`);await a.ensureFolder(l);let c=[{source:"template-meeting-daily.md",target:`${t}_Meeting_Daily_Template.md`},{source:"template-meeting-discussion.md",target:`${t}_Meeting_Discussion_Template.md`},{source:"template-meeting-knowledge.md",target:`${t}_Meeting_Knowledge_Template.md`},{source:"template-meeting-planning.md",target:`${t}_Meeting_Planning_Template.md`},{source:"template-meeting-refinement.md",target:`${t}_Meeting_Refinement_Template.md`},{source:"template-meeting-retro.md",target:`${t}_Meeting_Retro_Template.md`},{source:"template-meeting-demo.md",target:`${t}_Meeting_Demo_Template.md`},{source:"template-sprint.md",target:`${t}_Sprint_Template.md`},{source:"template-task.md",target:`${t}_Task_Template.md`},{source:"template-idea.md",target:`${t}_Idea_Template.md`},{source:"template-knowledge-base-item.md",target:`${t}_Knowledge_Item_Template.md`},{source:"template-meeting-daily.md",target:"template-meeting-daily.md"},{source:"template-meeting-discussion.md",target:"template-meeting-discussion.md"},{source:"template-meeting-knowledge.md",target:"template-meeting-knowledge.md"},{source:"template-meeting-planning.md",target:"template-meeting-planning.md"},{source:"template-meeting-refinement.md",target:"template-meeting-refinement.md"},{source:"template-meeting-retro.md",target:"template-meeting-retro.md"},{source:"template-meeting-demo.md",target:"template-meeting-demo.md"},{source:"template-sprint.md",target:"template-sprint.md"},{source:"template-task.md",target:"template-task.md"},{source:"template-idea.md",target:"template-idea.md"},{source:"template-knowledge-base-item.md",target:"template-knowledge-base-item.md"}];for(let i of c)try{let d=n(i.target);await hr(e,l,d,i.source,r)}catch(d){console.warn(`Failed to create template ${i.target}: ${d}`)}}var Qe=_(()=>{Tt()});var At={};L(At,{CURRENT_SETTINGS_SCHEMA_VERSION:()=>ot,migrateSettings:()=>Pr});function Pr(e){var n,s,a,l,c,i,d,f;let t={dimensions:(n=e==null?void 0:e.dimensions)!=null?n:[],projectsRoot:(s=e==null?void 0:e.projectsRoot)!=null?s:"1. Projects",archiveRoot:(a=e==null?void 0:e.archiveRoot)!=null?a:"4. Archive",templatesRoot:(l=e==null?void 0:e.templatesRoot)!=null?l:"Templates/ProjectFlow",schemaVersion:(c=e==null?void 0:e.schemaVersion)!=null?c:0,projectRecords:{},archivedRecords:(i=e==null?void 0:e.archivedRecords)!=null?i:{},entityTypes:(d=e==null?void 0:e.entityTypes)!=null?d:{},projectTypes:(f=e==null?void 0:e.projectTypes)!=null?f:{},projectIndex:e==null?void 0:e.projectIndex,projectGraph:e==null?void 0:e.projectGraph},r=e==null?void 0:e.projectRecords;if(r&&typeof r=="object"&&!Array.isArray(r))t.projectRecords=r;else if(Array.isArray(r)){let g={};for(let m of r){if(!m||!m.info)continue;let u=m.info.dimension,y=m.info.category,P=m.info.id;!u||!y||!P||(g[u]=g[u]||{},g[u][y]=g[u][y]||{},g[u][y][P]=m)}t.projectRecords=g}else t.projectRecords={};if(Array.isArray(t.dimensions)){let g=1;t.dimensions=t.dimensions.map(m=>{var u;if(m&&typeof m=="object"){let y=(u=m.name)!=null?u:"",P=m.order,j=typeof y=="string"?y.match(/^\s*(\d+)\.\s*(.+)$/):null;return j&&(P=parseInt(j[1],10),y=j[2]),(P==null||Number.isNaN(P))&&(P=g++),{name:y,order:P,categories:Array.isArray(m.categories)?m.categories:[]}}return{name:String(m!=null?m:""),order:g++,categories:[]}})}else t.dimensions=[];let o=[...t.dimensions].sort((g,m)=>{var u,y;return((u=g.order)!=null?u:0)-((y=m.order)!=null?y:0)});return o.forEach((g,m)=>{g.order=m+1}),t.dimensions=o,(!t.schemaVersion||t.schemaVersion<ot)&&((!t.entityTypes||Object.keys(t.entityTypes).length===0)&&(t.entityTypes=re),(!t.projectTypes||Object.keys(t.projectTypes).length===0)&&(t.projectTypes=ne),t.schemaVersion=ot),t}var ot,It=_(()=>{ue();ot=3});function Ft(e){return e?e.startsWith("/")||e.includes("\\")?!1:!e.split("/").filter(Boolean).some(r=>r==="."||r===".."):!0}function we(e,t){let r=V(e),o=V(t);return o?r===o||r.startsWith(`${o}/`):!1}var $t=_(()=>{ie()});var kt={};L(kt,{listProjects:()=>nt,resolveArchivedProject:()=>Ue,resolveProject:()=>Re});function Re(e,t){var a,l,c;let r=Fe()||$e(e.settings.projectIndex,e.settings.projectRecords).index,o=Nt(t),n=o.fullName&&r.byFullName[o.fullName]||o.id&&r.byId[o.id]||o.tag&&r.byTag[o.tag];if(!n)return null;let s=(c=(l=(a=e.settings.projectRecords)==null?void 0:a[n.dimension])==null?void 0:l[n.category])==null?void 0:c[n.projectId];return s?{entry:n,record:s}:null}function Ue(e,t){var n;let r=Nt(t),o=jr(e.settings.archivedRecords,r);return o?{entry:{fullName:o.variables.PROJECT_FULL_NAME,projectId:o.info.id,projectTag:o.variables.PROJECT_TAG,path:o.variables.PROJECT_PATH,dimension:o.info.dimension,category:o.info.category,projectName:o.info.name,parent:(n=o.info.parent)!=null?n:null},record:o}:null}function nt(e){let t=Fe()||$e(e.settings.projectIndex,e.settings.projectRecords).index;return Object.values(t.byFullName)}function Nt(e){var t,r,o;if(typeof e=="string"){let n=e.trim();return n.startsWith("project/")?{tag:n}:n.includes(".")?{fullName:n}:{id:n}}return{fullName:(t=e.fullName)==null?void 0:t.trim(),id:(r=e.id)==null?void 0:r.trim(),tag:(o=e.tag)==null?void 0:o.trim()}}function jr(e,t){if(!e)return null;for(let r of Object.values(e))for(let o of Object.values(r))for(let n of Object.values(o))if(n&&(t.fullName&&n.variables.PROJECT_FULL_NAME===t.fullName||t.id&&n.info.id===t.id||t.tag&&n.variables.PROJECT_TAG===t.tag))return n;return null}var st=_(()=>{le()});async function Dt(e,t){let{resolveProject:r}=await Promise.resolve().then(()=>(st(),kt)),{mergeEntityTypes:o}=await Promise.resolve().then(()=>(Je(),wt)),{processTemplate:n}=await Promise.resolve().then(()=>(Ge(),Me)),{SafeFileManager:s}=await Promise.resolve().then(()=>(ae(),se)),a=r(e,t.projectRef);if(!a)throw new Error("Project not found for reference.");let c=o(e.settings.entityTypes)[t.entityTypeId];if(!c)throw new Error(`Entity type not found: ${t.entityTypeId}`);Tr(c,t.fields);let i={...a.record.variables,...t.fields||{}},d=await wr(e,c,a.record,i);if(!d)throw new Error(`Template not found for entity type: ${c.id}`);let g=await e.app.vault.adapter.read(d.path),m=n(g,i),u=n(c.targetFolder,i);if(!Ft(u))throw new Error("Unsafe targetFolder path.");let y=V(a.record.variables.PROJECT_PATH),P=u?V(`${y}/${u}`):y;if(!we(P,y))throw new Error("Target folder is outside project path.");if(!St(P,e.settings))throw new Error("Target folder is outside allowed roots.");let j=c.filenameRule||"Untitled",A=n(j,i),U=A.endsWith(".md")?A.slice(0,-3):A,Q=Ae(U),O=V(`${P}/${Q}.md`);if(!we(O,y))throw new Error("Target file is outside project path.");if(!St(O,e.settings))throw new Error("Target file is outside allowed roots.");let W=new s(e.app);if(await W.ensureFolder(P),await W.has(O))throw new Error(`File already exists: ${O}`);return await W.createIfAbsent(O,m),{path:O}}function St(e,t){let r=t.projectsRoot||"1. Projects",o=t.archiveRoot||"4. Archive";return we(e,r)||we(e,o)}function Tr(e,t){if(!e.requiredFields||e.requiredFields.length===0)return;let r=e.requiredFields.filter(o=>t==null||t[o]==null||String(t[o]).trim()==="");if(r.length>0)throw new Error(`Missing required fields: ${r.join(", ")}`)}async function wr(e,t,r,o){let{processTemplate:n}=await Promise.resolve().then(()=>(Ge(),Me)),s=e.app.vault.adapter,a=n(t.templatePath,o),l=V(`Templates/${r.info.name}_Templates`),c=V(e.settings.templatesRoot||"Templates/ProjectFlow"),i=`.obsidian/plugins/${e.manifest.id}/src/templates`,d=g=>g.map(m=>m==="project"?{scope:m,path:V(`${l}/${a}`)}:m==="vault"?{scope:m,path:V(`${c}/${a}`)}:{scope:m,path:`${i}/${a}`}),f=t.templateScope?[t.templateScope,"builtin"].filter((g,m,u)=>u.indexOf(g)===m):["project","vault","builtin"];for(let g of d(f))if(await s.exists(g.path))return g;return null}var _t=_(()=>{ie();$t()});function Rr(e,t,r,o,n){let s=vr(t),a=e.indexOf(s);if(a>=0){let l=e.indexOf(`
`,a),c=l>=0?l+1:e.length,i=Er(e,c),d=i>=0?i:e.length;return{updated:!0,text:[e.slice(0,c),at(r),e.slice(d)].join("")}}if(o==="strict")return{updated:!1,text:e};if(n){let l=Ot(e,n,r,o);if(l.updated)return l}return{updated:!0,text:Lt(e,n||"AI Notes",r)}}function Ot(e,t,r,o){let n=Gt(t),a=new RegExp(`^#{1,6}\\s+${br(n)}\\s*$`,"m").exec(e);if(!a||a.index==null)return o==="strict"?{updated:!1,text:e}:{updated:!0,text:Lt(e,n,r)};let l=a.index,c=e.indexOf(`
`,l),i=c>=0?c+1:e.length,d=xr(e,i);return{updated:!0,text:[e.slice(0,i),at(r),e.slice(d)].join("")}}async function Ct(e,t){var a;let r=e.vault.adapter,o=(a=t.patchMode)!=null?a:"lenient";if(!await r.exists(t.path))return{ok:!1,error:`File not found: ${t.path}`};let n=await r.read(t.path),s=Rr(n,t.marker,t.content,o,t.fallbackHeading);return s.updated?(await r.write(t.path,s.text),{ok:!0}):{ok:!1,error:"Marker or heading not found in strict mode."}}async function Mt(e,t){var a;let r=e.vault.adapter,o=(a=t.patchMode)!=null?a:"lenient";if(!await r.exists(t.path))return{ok:!1,error:`File not found: ${t.path}`};let n=await r.read(t.path),s=Ot(n,t.heading,t.content,o);return s.updated?(await r.write(t.path,s.text),{ok:!0}):{ok:!1,error:"Heading not found in strict mode."}}function vr(e){let t=e.trim();return t.startsWith("<!--")&&t.endsWith("-->")?t:`<!-- ${t} -->`}function Gt(e){return e.replace(/^#+\s*/,"").trim()}function Er(e,t){let r=/<!--\s*AI:[A-Z_]+\s*-->/g;r.lastIndex=t;let o=r.exec(e);return o&&o.index!=null?o.index:-1}function xr(e,t){let r=/^#{1,6}\s+/gm;r.lastIndex=t;let o=r.exec(e);return o&&o.index!=null?o.index:e.length}function at(e){let t=e!=null?e:"";return t.endsWith(`
`)?t:`${t}
`}function Lt(e,t,r){let o=Gt(t);return`${e.endsWith(`
`)?e:`${e}
`}
## ${o}
${at(r)}`}function br(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}var Bt=_(()=>{});var Jt={};L(Jt,{createCoreApi:()=>Ar});function Ar(e){return{version:"1.0.0",capabilities:{resolveProject:!0,listProjects:!0,entityTypes:!0,projectTypes:!0,createProject:!0,createEntity:!0,patching:!0,projectGraph:!0},resolveProject:r=>Re(e,r),listProjects:()=>nt(e),listProjectTypes:()=>me(e.settings.projectTypes),describeProjectType:r=>me(e.settings.projectTypes)[r]||null,listEntityTypes:()=>Be(e.settings.entityTypes),describeEntityType:r=>Be(e.settings.entityTypes)[r]||null,createProject:async r=>Ve(e,r),createEntity:async r=>Dt(e,r),patchMarker:async r=>Ct(e.app,r),patchSection:async r=>Mt(e.app,r),getChildren:(r,o)=>{let n=o?Ue(e,r):Re(e,r);if(!n)return[];let{graph:s}=ye(e.settings.projectGraph,e.settings.projectRecords,e.settings.archivedRecords);return Xe(s,n.entry.fullName,Boolean(o))},getParents:(r,o)=>{let n=o?Ue(e,r):Re(e,r);if(!n)return[];let{graph:s}=ye(e.settings.projectGraph,e.settings.projectRecords,e.settings.archivedRecords);return Ze(s,n.entry.fullName,Boolean(o))},clearArchivedProjectGraph:async()=>{let{graph:r}=ye(e.settings.projectGraph,e.settings.projectRecords,e.settings.archivedRecords);return e.settings.projectGraph=qe(r,e.settings.archivedRecords),await e.saveData(e.settings),{ok:!0}}}}var Vt=_(()=>{Je();Qe();_t();Bt();st();de()});var Fr={};L(Fr,{default:()=>Ir});module.exports=Xt(Fr);var Ut=require("obsidian");var x=require("obsidian");ue();var ct=require("obsidian"),be=class extends ct.Modal{constructor(r,o){super(r);this.onResult=o}onOpen(){let{contentEl:r}=this;r.empty(),r.addClass("project-flow-settings"),r.createEl("p",{text:"Do you want skip settings to defaults? This will override all custom settings."});let o=r.createDiv({cls:"gc-row"});o.createDiv({cls:"gc-spacer"});let n=o.createEl("button",{text:"Yes, use defaults"}),s=o.createEl("button",{text:"Go back"});n.onclick=()=>{this.close(),this.onResult(!0)},s.onclick=()=>{this.close(),this.onResult(!1)}}onClose(){this.contentEl.empty()}};async function ke(e,t,r,o){let n="",s=e.settings.projectRecords,a=s[t][r][o],{SafeFileManager:l}=await Promise.resolve().then(()=>(ae(),se)),c=new l(e.app),{sanitizePath:i}=await Promise.resolve().then(()=>(ie(),fe)),d=i(a.variables.PROJECT_PATH),f=i(`Templates/${a.info.name}_Templates`);try{await c.removeDir(d),await c.removeDir(f);try{s[t][r][o]&&(delete s[t][r][o],Object.keys(s[t][r]).length===0&&delete s[t][r],Object.keys(s[t]).length===0&&delete s[t]);try{let{ensureProjectIndex:g,removeFromProjectIndex:m,toIndexEntry:u}=await Promise.resolve().then(()=>(le(),he)),{ensureProjectGraph:y,removeProjectFromGraph:P}=await Promise.resolve().then(()=>(de(),Pe)),{index:j}=g(e.settings.projectIndex,s);e.settings.projectIndex=m(j,u(a,o,t,r));let{graph:A}=y(e.settings.projectGraph,s,e.settings.archivedRecords);e.settings.projectGraph=P(A,a.variables.PROJECT_FULL_NAME,!1)}catch(g){console.warn("Failed to update projectIndex after delete:",g)}await e.saveData(e.settings),n="Project deleted successfully."}catch(g){n="Failed to update projectRecords after delete",console.warn(n,g)}return[!0,n]}catch(g){n="Error removing project: "+g.message,console.error("Error removing project:",g)}return[!1,n]}async function Se(e,t,r,o){var n,s,a,l,c;try{let i=e.settings.projectRecords,d=(s=(n=i==null?void 0:i[t])==null?void 0:n[r])==null?void 0:s[o];if(!d)return[!1,"Project not found."];let{sanitizePath:f}=await Promise.resolve().then(()=>(ie(),fe)),{SafeFileManager:g}=await Promise.resolve().then(()=>(ae(),se)),m=new g(e.app),u=e.app.vault.adapter,y=f(d.variables.PROJECT_PATH),P=f(`Templates/${d.info.name}_Templates`),j=e.settings.archiveRoot||"4. Archive",A=d.variables.YEAR,U=d.variables.DIMENSION||d.info.dimension,Q=d.info.category,O=d.info.parent&&d.info.parent.trim().length>0?d.info.parent.trim():null,W=d.info.name,p=O?`${A}.${U}.${Q}.${O}.${W}`:`${A}.${U}.${Q}.${W}`,v=f(`${j}/${p}`),F=h=>{let w=h.split("/").filter(Boolean);return w.pop(),w.join("/")};if(await m.ensureFolder(F(v)),!await u.exists(y))return[!1,`Project directory not found: ${y}`];if(await u.exists(v))return[!1,`Archive destination already exists: ${v}`];await u.rename(y,v);try{if(await u.exists(P)){let h=f(`${v}/Templates`);await m.ensureFolder(h);let w=f(`${h}/${d.info.name}_Templates`);if(await u.exists(w)){let k=f(`${h}/${d.info.name}_Templates_archived`);await u.rename(P,k)}else await u.rename(P,w)}}catch(h){console.warn("Archiving templates failed:",h)}try{let h=e.settings.projectRecords;(!e.settings.archivedRecords||Array.isArray(e.settings.archivedRecords))&&(e.settings.archivedRecords=e.settings.archivedRecords&&Array.isArray(e.settings.archivedRecords)?{}:e.settings.archivedRecords||{});let w=e.settings.archivedRecords;w[t]=w[t]||{},w[t][r]=w[t][r]||{},w[t][r][o]=d,(l=(a=h==null?void 0:h[t])==null?void 0:a[r])!=null&&l[o]&&(delete h[t][r][o],Object.keys(h[t][r]).length===0&&delete h[t][r],Object.keys(h[t]||{}).length===0&&delete h[t]);try{let{ensureProjectIndex:k,removeFromProjectIndex:B,toIndexEntry:J}=await Promise.resolve().then(()=>(le(),he)),{ensureProjectGraph:S,removeProjectFromGraph:q,addProjectToGraph:oe}=await Promise.resolve().then(()=>(de(),Pe)),{index:ve}=k(e.settings.projectIndex,h);e.settings.projectIndex=B(ve,J(d,o,t,r));let{graph:b}=S(e.settings.projectGraph,h,w);e.settings.projectGraph=q(b,d.variables.PROJECT_FULL_NAME,!1),e.settings.projectGraph=oe(e.settings.projectGraph,d,!0)}catch(k){console.warn("Failed to update projectIndex after archive:",k)}await e.saveData(e.settings)}catch(h){console.warn("Failed to move project record to archive in settings:",h)}return[!0,"Project archived successfully."]}catch(i){return console.error("Archive failed:",i),[!1,(c=i==null?void 0:i.message)!=null?c:"Failed to archive project."]}}var ir=[{name:"Business",order:1,categories:["R&D","Jobs","OpenSource","Education"]},{name:"Family",order:2,categories:["Vacations","Parenting","Common"]},{name:"Friends",order:3,categories:[]},{name:"Health",order:4,categories:["Clinics","Issues","R&D"]},{name:"Personal",order:5,categories:["R&D","Languages","SelfManagement","Writing","Reading","Music","Sports"]},{name:"Residence",order:6,categories:[]}],_e={dimensions:JSON.parse(JSON.stringify(ir)),projectsRoot:"1. Projects",archiveRoot:"4. Archive",templatesRoot:"Templates/ProjectFlow",projectRecords:{},archivedRecords:{},projectGraph:{version:1,byFullName:{},archivedByFullName:{}},entityTypes:re,projectTypes:ne};function mt(e){let t=0;for(let r=0;r<e.length;r++)t=(t<<5)-t+e.charCodeAt(r),t|=0;return t}var De=class extends x.PluginSettingTab{constructor(r,o){super(r,o);this.plugin=o}display(){var W;let{containerEl:r}=this;r.empty(),r.addClass("project-flow-settings");let o=r.createDiv({cls:"gc-row"});o.createDiv({cls:"gc-spacer"});let n=o.createEl("button",{cls:["gc-icon-button","clickable-icon"],attr:{"aria-label":"Reset to defaults",title:"Reset to defaults"}});try{(0,x.setIcon)(n,"rotate-ccw")}catch(p){n.setText("Reset to defaults")}n.onclick=()=>{new be(this.app,async v=>{v&&(this.plugin.settings=JSON.parse(JSON.stringify(_e)),await this.plugin.saveSettings(),new x.Notice("Settings were reset to defaults."),this.display())}).open()},r.createEl("h2",{text:"Folders"});let s=r.createDiv({cls:"gc-column"}),a=s.createDiv({cls:"setting-item"});a.createEl("label",{text:"Projects root"});let l=a.createEl("input",{type:"text"});l.value=this.plugin.settings.projectsRoot||"1. Projects",l.placeholder="e.g. 1. Projects",l.onchange=async()=>{this.plugin.settings.projectsRoot=l.value.trim()||"1. Projects",await this.plugin.saveSettings()};let c=s.createDiv({cls:"setting-item"});c.createEl("label",{text:"Archive root"});let i=c.createEl("input",{type:"text"});i.value=this.plugin.settings.archiveRoot||"4. Archive",i.placeholder="e.g. 4. Archive",i.onchange=async()=>{this.plugin.settings.archiveRoot=i.value.trim()||"4. Archive",await this.plugin.saveSettings()};let d=s.createDiv({cls:"setting-item"});d.createEl("label",{text:"Templates root"});let f=d.createEl("input",{type:"text"});f.value=this.plugin.settings.templatesRoot||"Templates/ProjectFlow",f.placeholder="e.g. Templates/ProjectFlow",f.onchange=async()=>{this.plugin.settings.templatesRoot=f.value.trim()||"Templates/ProjectFlow",await this.plugin.saveSettings()},r.createEl("h2",{text:"Dimensions"}),[...this.plugin.settings.dimensions].sort((p,v)=>{var F,h;return((F=p.order)!=null?F:0)-((h=v.order)!=null?h:0)}).forEach((p,v)=>{let F=r.createDiv({cls:"dimension-setting"}),h=F.createDiv({cls:"dimension-header"});h.addClass("gc-row"),h.createSpan({text:`${p.order}. `});let w=h.createEl("b",{text:p.name});h.createDiv({cls:"gc-spacer"});let k=h.createEl("button",{cls:["gc-icon-button","clickable-icon"]});k.setAttr("aria-label","Move up"),k.setAttr("title","Move up");try{(0,x.setIcon)(k,"arrow-up")}catch(b){k.setText("Up")}k.onclick=async()=>{let T=[...this.plugin.settings.dimensions].filter(R=>{var I,E;return((I=R.order)!=null?I:0)<((E=p.order)!=null?E:0)}).sort((R,I)=>{var E,N;return((E=I.order)!=null?E:0)-((N=R.order)!=null?N:0)})[0];if(!T)return;let $=T.order;T.order=p.order,p.order=$,await this.plugin.saveSettings(),this.display()};let B=h.createEl("button",{cls:["gc-icon-button","clickable-icon"]});B.setAttr("aria-label","Move down"),B.setAttr("title","Move down");try{(0,x.setIcon)(B,"arrow-down")}catch(b){B.setText("Down")}B.onclick=async()=>{let T=[...this.plugin.settings.dimensions].filter(R=>{var I,E;return((I=R.order)!=null?I:0)>((E=p.order)!=null?E:0)}).sort((R,I)=>{var E,N;return((E=R.order)!=null?E:0)-((N=I.order)!=null?N:0)})[0];if(!T)return;let $=T.order;T.order=p.order,p.order=$,await this.plugin.saveSettings(),this.display()};let J=h.createEl("button",{cls:["gc-icon-button","clickable-icon"]});J.setAttr("aria-label",`Delete ${p.name}`),J.setAttr("title",`Delete ${p.name}`);try{(0,x.setIcon)(J,"trash")}catch(b){J.setText("Remove")}J.onclick=async()=>{let b=this.plugin.settings.dimensions.findIndex(T=>T===p);b>=0&&this.plugin.settings.dimensions.splice(b,1),await this.plugin.saveSettings(),this.display()};let S=h.createEl("button",{cls:["gc-icon-button","clickable-icon"]});S.setAttr("aria-label",`Rename ${p.name}`),S.setAttr("title",`Rename ${p.name}`);try{(0,x.setIcon)(S,"pencil")}catch(b){S.setText("Edit")}if(S.onclick=async()=>{var X;let b=p.name,T=w.parentElement;(X=w.detach)==null||X.call(w),S.style.display="none",J.style.display="none";let $=T.createEl("input",{type:"text"});$.value=b,$.addClass("gc-rename");let R=T.createDiv({cls:"gc-row"});R.createDiv({cls:"gc-spacer"});let I=R.createEl("button",{cls:["gc-icon-button","clickable-icon"]});I.setAttr("aria-label","Apply"),I.setAttr("title","Apply");try{(0,x.setIcon)(I,"check")}catch(C){I.setText("Apply")}let E=R.createEl("button",{cls:["gc-icon-button","clickable-icon"]});E.setAttr("aria-label","Discard"),E.setAttr("title","Discard");try{(0,x.setIcon)(E,"x")}catch(C){E.setText("Discard")}let N=()=>{this.display()},M=async C=>{let Y=C.trim();if(!Y||Y===b){N();return}if(this.plugin.settings.dimensions.some(ge=>ge!==p&&ge.name===Y)){new x.Notice("A dimension with this name already exists.");return}p.name=Y,await this.plugin.saveSettings(),N()};I.onclick=async()=>{await M($.value)},E.onclick=()=>N(),$.focus(),$.select(),$.onkeydown=async C=>{C.key==="Enter"&&await M($.value),C.key==="Escape"&&N()},$.onblur=async()=>{await M($.value)}},p.categories.length>0){let b=F.createDiv({cls:"categories-list gc-list"});p.categories.forEach((T,$)=>{var ge;let R=b.createDiv({cls:"gc-list-item gc-row"}),I=this.plugin.settings.projectRecords||{},E=p.name,N=Object.keys(((ge=I==null?void 0:I[E])==null?void 0:ge[T])||{}),M=R.createEl("b",{text:T}),X=R.createDiv({cls:"gc-id-wrap"});N.length>0&&(X.createSpan({text:" "}),N.forEach((G,Ee)=>{let D=X.createSpan({cls:"gc-id-chip"});D.style.display="inline-flex",D.style.alignItems="center",D.style.gap="4px";let ce=D.createSpan({cls:"gc-id-tag",text:G}),ee=Math.abs(mt(G))%360;ce.style.backgroundColor=`hsl(${ee}, 70%, 90%)`,ce.style.color=`hsl(${ee}, 70%, 25%)`;let z=D.createSpan({cls:"gc-id-actions"});z.style.display="none";let H=z.createEl("button",{cls:["gc-icon-button","clickable-icon"]});H.setAttr("aria-label",`Delete ${G}`),H.setAttr("title",`Delete ${G}`);try{(0,x.setIcon)(H,"trash")}catch(te){H.setText("Del")}H.onclick=async te=>{te.stopPropagation();let[,K]=await ke(this.plugin,E,T,G);new x.Notice(K),this.display()};let Z=z.createEl("button",{cls:["gc-icon-button","clickable-icon"]});Z.setAttr("aria-label",`Archive ${G}`),Z.setAttr("title",`Archive ${G}`);try{(0,x.setIcon)(Z,"archive")}catch(te){Z.setText("Arc")}Z.onclick=async te=>{te.stopPropagation();let[,K]=await Se(this.plugin,E,T,G);new x.Notice(K),this.display()},D.onmouseenter=()=>{z.style.display="inline-flex"},D.onmouseleave=()=>{z.style.display="none"},Ee<N.length-1&&X.createSpan({text:" "})})),R.createDiv({cls:"gc-spacer"});let C=R.createEl("button",{cls:["remove-category","gc-icon-button","clickable-icon"]});C.setAttr("aria-label",`Delete ${T}`),C.setAttr("title",`Delete ${T}`);try{(0,x.setIcon)(C,"trash")}catch(G){C.setText("Remove")}C.onclick=async()=>{p.categories.splice($,1),await this.plugin.saveSettings(),this.display()};let Y=R.createEl("button",{cls:["gc-icon-button","clickable-icon"]});Y.setAttr("aria-label",`Rename ${T}`),Y.setAttr("title",`Rename ${T}`);try{(0,x.setIcon)(Y,"pencil")}catch(G){Y.setText("Edit")}Y.onclick=async()=>{var te;let G=p.categories[$],Ee=M.parentElement;(te=M.detach)==null||te.call(M),Y.style.display="none",C.style.display="none";let D=Ee.createEl("input",{type:"text"});D.value=G,D.addClass("gc-rename");let ce=Ee.createDiv({cls:"gc-row"});ce.createDiv({cls:"gc-spacer"});let ee=ce.createEl("button",{cls:["gc-icon-button","clickable-icon"]});ee.setAttr("aria-label","Apply"),ee.setAttr("title","Apply");try{(0,x.setIcon)(ee,"check")}catch(K){ee.setText("Apply")}let z=ce.createEl("button",{cls:["gc-icon-button","clickable-icon"]});z.setAttr("aria-label","Discard"),z.setAttr("title","Discard");try{(0,x.setIcon)(z,"x")}catch(K){z.setText("Discard")}let H=()=>{this.display()},Z=async K=>{let xe=K.trim();if(!xe||xe===G){H();return}if(p.categories.some((Wt,Yt)=>Yt!==$&&Wt===xe)){new x.Notice("This category already exists in the dimension.");return}p.categories[$]=xe,await this.plugin.saveSettings(),H()};ee.onclick=async()=>{await Z(D.value)},z.onclick=()=>H(),D.focus(),D.select(),D.onkeydown=async K=>{K.key==="Enter"&&await Z(D.value),K.key==="Escape"&&H()},D.onblur=async()=>{await Z(D.value)}}})}let q=F.createDiv({cls:"add-category gc-row"}),oe=q.createEl("input",{type:"text",placeholder:"New category"});q.createDiv({cls:"gc-spacer"});let ve=q.createEl("button",{text:"Add Category"});ve.onclick=async()=>{let b=oe.value.trim();b&&!p.categories.includes(b)&&(p.categories.push(b),await this.plugin.saveSettings(),this.display())}});let m=r.createDiv({cls:"add-dimension"});m.createEl("h3",{text:"Add new dimension"});let u=m.createDiv({cls:"gc-row"}),y=u.createEl("input",{type:"text",placeholder:"Dimension name"});u.createDiv({cls:"gc-spacer"});let P=u.createEl("button",{text:"Add Dimension"});P.onclick=async()=>{let p=y.value.trim();if(p&&!this.plugin.settings.dimensions.some(v=>v.name===p)){{let v=this.plugin.settings.dimensions.reduce((F,h)=>{var w;return Math.max(F,(w=h.order)!=null?w:0)},0);this.plugin.settings.dimensions.push({name:p,order:v+1,categories:[]})}await this.plugin.saveSettings(),this.display()}},r.createEl("h2",{text:"Archive"});let j=this.plugin.settings.archivedRecords||{},A=j&&!Array.isArray(j)?j:{},U={};for(let p of this.plugin.settings.dimensions)U[p.name]=(W=p.order)!=null?W:Number.MAX_SAFE_INTEGER;let Q=Object.keys(A).map(p=>{var v;return{name:p,order:(v=U[p])!=null?v:Number.MAX_SAFE_INTEGER}}).sort((p,v)=>p.order-v.order||p.name.localeCompare(v.name)),O=!1;Q.forEach(({name:p,order:v})=>{let F=A[p]||{},h=Object.keys(F).filter(S=>Object.keys(F[S]||{}).length>0).sort();if(h.length===0)return;O=!0;let w=r.createDiv({cls:"dimension-setting"}),k=w.createDiv({cls:"dimension-header gc-row"}),B=this.plugin.settings.dimensions.find(S=>S.name===p);B&&k.createSpan({text:`${B.order}. `}),k.createEl("b",{text:p}),k.createDiv({cls:"gc-spacer"});let J=w.createDiv({cls:"categories-list gc-list"});h.forEach(S=>{let q=J.createDiv({cls:"gc-list-item gc-row"}),oe=Object.keys((F==null?void 0:F[S])||{}).sort(),ve=q.createEl("b",{text:S}),b=q.createDiv({cls:"gc-id-wrap"});oe.length>0&&(b.createSpan({text:" "}),oe.forEach((T,$)=>{let R=b.createSpan({cls:"gc-id-chip"});R.style.display="inline-flex",R.style.alignItems="center",R.style.gap="4px";let I=R.createSpan({cls:"gc-id-tag",text:T}),E=Math.abs(mt(T))%360;I.style.backgroundColor=`hsl(${E}, 70%, 90%)`,I.style.color=`hsl(${E}, 70%, 25%)`;let N=R.createSpan({cls:"gc-id-actions"});N.style.display="none";let M=N.createEl("button",{cls:["gc-icon-button","clickable-icon"]});M.setAttr("aria-label",`Delete ${T}`),M.setAttr("title",`Delete ${T}`);try{(0,x.setIcon)(M,"trash")}catch(X){M.setText("Del")}M.onclick=async X=>{X.stopPropagation();let[,C]=await this.plugin.deleteArchivedProject(p,S,T);new x.Notice(C),this.display()},R.onmouseenter=()=>{N.style.display="inline-flex"},R.onmouseleave=()=>{N.style.display="none"},$<oe.length-1&&b.createSpan({text:" "})})),q.createDiv({cls:"gc-spacer"})})}),O||r.createDiv({cls:"setting-item"}).createSpan({text:"No archived projects yet."})}};var et=require("obsidian");var gt=require("obsidian"),Oe=class extends gt.Modal{constructor(r,o,n){super(r);this.prompt=o,this.callback=n}onOpen(){let{contentEl:r}=this;r.createEl("h2",{text:this.prompt});let o=r.createEl("input",{type:"text"});o.focus();let n=r.createEl("button",{text:"Submit"});n.onclick=()=>{let s=o.value.trim();this.close(),this.callback(s||null)}}onClose(){let{contentEl:r}=this;r.empty()}};var ut=require("obsidian"),je=class extends ut.Modal{constructor(r,o,n,s){super(r);this.prompt=o,this.choices=n,this.callback=s}onOpen(){let{contentEl:r}=this;r.createEl("h2",{text:this.prompt}),this.choices.forEach(o=>{let n=r.createEl("button",{text:o});n.onclick=()=>{this.close(),this.callback(o)}})}onClose(){let{contentEl:r}=this;r.empty()}};async function Te(e,t){return new Promise(r=>{new Oe(e,t,r).open()})}async function pe(e,t,r){return new Promise(o=>{new je(e,t,r,o).open()})}async function yt(e,t){var m,u;let r=await Te(e,"Enter project name:");if(!r)return[null,"Project creation cancelled. No project name provided."];let o=await Te(e,"Enter project tag:");if(!o)return[null,"Project creation cancelled. No project tag provided."];let n=await Te(e,"Enter Project ID (used for task prefixes):");if(!n)return[null,"Project creation cancelled. No Project ID provided."];let s=await Te(e,"Enter parent name (optional):"),a=s&&s.trim().length>0?s.trim():null,l=[...t.dimensions].sort((y,P)=>{var j,A;return((j=y.order)!=null?j:0)-((A=P.order)!=null?A:0)}).map(y=>y.name),c=await pe(e,"Select dimension:",l);if(!c)return[null,"Project creation cancelled. No dimension selected."];let i=t.dimensions.find(y=>y.name===c);if(!i||i.categories.length===0)return[null,"Selected dimension has no categories. Please add categories in settings first."];let d=i.categories,f=await pe(e,"Select category:",d);if(!f)return[null,"Project creation cancelled. No category selected."];let g={name:r,tag:o,id:n,parent:a,dimension:c,category:f};try{let y=t.projectRecords;if(y&&!Array.isArray(y)&&((u=(m=y[c])==null?void 0:m[f])==null?void 0:u[n]))return[null,`Project with ID "${n}" already exists in ${c}:${f}. Choose a different ID.`]}catch(y){}try{let{validateProjectName:y,validateTag:P,ensureValidOrThrow:j}=await Promise.resolve().then(()=>(ht(),ft));j(()=>y(g.name),"Invalid project name"),j(()=>P(g.tag),"Invalid tag"),j(()=>P(g.id),"Invalid Project ID")}catch(y){let P=y.message||"Invalid input";return console.error("Validation error:",y),[null,P]}return[g,"Project details collected."]}async function Ce(e,t){var d;if(!t.projectRecords)return[null,"You don't have any projects yet."];let r=t.projectRecords,o=[...t.dimensions].sort((f,g)=>{var m,u;return((m=f.order)!=null?m:0)-((u=g.order)!=null?u:0)}).map(f=>f.name),n=await pe(e,"Select dimension of your project:",o);if(!n)return[null,"Project action cancelled. No dimension selected."];let s=t.dimensions.find(f=>f.name===n);if(!s||s.categories.length===0)return[null,"Selected dimension has no categories. No project found."];let a=s.categories,l=await pe(e,"Select category:",a);if(!l)return[null,"Project action cancelled. No category selected."];let c=(d=r[n])==null?void 0:d[l];if(!c||Object.keys(c).length===0)return[null,"No projects found in this category."];let i=await pe(e,"Select Project:",Object.keys(c));return i?[{dimension:n,category:l,projectId:i},"Project details collected."]:[null,"Project action cancelled. No project selected."]}Qe();async function Et(e){let[t,r]=await yt(e.app,e.settings);if(t===null){new et.Notice(r);return}let[,o]=await Ve(e,t);new et.Notice(o),console.log(o)}var tt=require("obsidian");async function xt(e){let[t,r]=await Ce(e.app,e.settings);if(t===null){new tt.Notice(r);return}let{dimension:o,category:n,projectId:s}=t,[,a]=await ke(e,o,n,s);new tt.Notice(a),console.log(a)}var rt=require("obsidian");async function bt(e){let[t,r]=await Ce(e.app,e.settings);if(t===null){new rt.Notice(r);return}let{dimension:o,category:n,projectId:s}=t,[,a]=await Se(e,o,n,s);new rt.Notice(a),console.log(a)}var We=class extends Ut.Plugin{async onload(){console.log("ProjectFlow plugin loaded"),await this.loadSettings(),this.addSettingTab(new De(this.app,this)),this.addCommand({id:"add-project-info",name:"Add Project Info",callback:()=>Et(this)}),this.addCommand({id:"remove-project-by-id",name:"Remove Project",callback:()=>xt(this)}),this.addCommand({id:"archive-project-by-id",name:"Archive Project",callback:()=>bt(this)}),await this.exposeCoreApi()}async loadSettings(){let r=await this.loadData();try{let{migrateSettings:o,CURRENT_SETTINGS_SCHEMA_VERSION:n}=await Promise.resolve().then(()=>(It(),At)),{DEFAULT_ENTITY_TYPES:s,DEFAULT_PROJECT_TYPES:a}=await Promise.resolve().then(()=>(ue(),it)),{ensureProjectIndex:l}=await Promise.resolve().then(()=>(le(),he)),{ensureProjectGraph:c}=await Promise.resolve().then(()=>(de(),Pe));this.settings=Object.assign({},_e,o(r));let i=!1;this.settings.templatesRoot||(this.settings.templatesRoot="Templates/ProjectFlow",i=!0),(!this.settings.entityTypes||Object.keys(this.settings.entityTypes).length===0)&&(this.settings.entityTypes=s,i=!0),(!this.settings.projectTypes||Object.keys(this.settings.projectTypes).length===0)&&(this.settings.projectTypes=a,i=!0),(!this.settings.schemaVersion||this.settings.schemaVersion<n)&&(this.settings.schemaVersion=n,i=!0);let{index:d,updated:f}=l(this.settings.projectIndex,this.settings.projectRecords);f&&(this.settings.projectIndex=d,i=!0);let{graph:g,updated:m}=c(this.settings.projectGraph,this.settings.projectRecords,this.settings.archivedRecords);m&&(this.settings.projectGraph=g,i=!0),i&&await this.saveData(this.settings)}catch(o){this.settings=Object.assign({},_e,r)}}async saveSettings(){await this.saveData(this.settings)}getApi(){return this.coreApi}async exposeCoreApi(){let{createCoreApi:r}=await Promise.resolve().then(()=>(Vt(),Jt));this.coreApi=r(this);let o=window;o.PluginApi=o.PluginApi||{},o.PluginApi["@projectflow/core"]=this.coreApi}};var Ir=We;
