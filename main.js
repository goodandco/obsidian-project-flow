/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var ut=Object.defineProperty;var _t=Object.getOwnPropertyDescriptor;var Ft=Object.getOwnPropertyNames;var Ct=Object.prototype.hasOwnProperty;var it=(n,o)=>()=>(n&&(o=n(n=0)),o);var et=(n,o)=>{for(var t in o)ut(n,t,{get:o[t],enumerable:!0})},Nt=(n,o,t,e)=>{if(o&&typeof o=="object"||typeof o=="function")for(let s of Ft(o))!Ct.call(n,s)&&s!==t&&ut(n,s,{get:()=>o[s],enumerable:!(e=_t(o,s))||e.enumerable});return n};var Ot=n=>Nt(ut({},"__esModule",{value:!0}),n);var bt={};et(bt,{CURRENT_SETTINGS_SCHEMA_VERSION:()=>Bt,migrateSettings:()=>It});function It(n){var s,r,a;let o={dimensions:(s=n==null?void 0:n.dimensions)!=null?s:[],projectsRoot:(r=n==null?void 0:n.projectsRoot)!=null?r:"1. Projects",schemaVersion:(a=n==null?void 0:n.schemaVersion)!=null?a:0,projectRecords:{}},t=n==null?void 0:n.projectRecords;if(t&&typeof t=="object"&&!Array.isArray(t))o.projectRecords=t;else if(Array.isArray(t)){let c={};for(let i of t){if(!i||!i.info)continue;let l=i.info.dimension,d=i.info.category,p=i.info.id;!l||!d||!p||(c[l]=c[l]||{},c[l][d]=c[l][d]||{},c[l][d][p]=i)}o.projectRecords=c}else o.projectRecords={};if(Array.isArray(o.dimensions)){let c=1;o.dimensions=o.dimensions.map(i=>{var l;if(i&&typeof i=="object"){let d=(l=i.name)!=null?l:"",p=i.order,m=typeof d=="string"?d.match(/^\s*(\d+)\.\s*(.+)$/):null;return m&&(p=parseInt(m[1],10),d=m[2]),(p==null||Number.isNaN(p))&&(p=c++),{name:d,order:p,categories:Array.isArray(i.categories)?i.categories:[]}}return{name:String(i!=null?i:""),order:c++,categories:[]}})}else o.dimensions=[];let e=[...o.dimensions].sort((c,i)=>{var l,d;return((l=c.order)!=null?l:0)-((d=i.order)!=null?d:0)});return e.forEach((c,i)=>{c.order=i+1}),o.dimensions=e,(!o.schemaVersion||o.schemaVersion<2)&&(o.schemaVersion=2),o}var Bt,Rt=it(()=>{Bt=2});var st={};et(st,{sanitizeFileName:()=>Et,sanitizePath:()=>Vt});function Et(n){let o=(n!=null?n:"").trim();return Array.from(o).filter(e=>e.charCodeAt(0)>=32).join("").replace(/[\\/:*?"<>|]/g,"-").replace(/\s+/g," ").replace(/\.+$/g,"").substring(0,200)||"untitled"}function Vt(n){return n?n.split("/").filter(Boolean).map(Et).join("/"):""}var rt=it(()=>{});var Z={};et(Z,{SafeFileManager:()=>yt});var yt,Q=it(()=>{yt=class{constructor(o){this.vault=o.vault}async createBatch(o){let t=[];try{for(let e of o)e.type==="folder"?await this.ensureFolder(e.path):await this.createIfAbsent(e.path,e.data)==="created"&&t.push(e.path);return{ok:!0}}catch(e){for(let s of t.reverse())try{let r=this.vault.getAbstractFileByPath(s);r&&this.vault.delete&&await this.vault.delete(r)}catch(r){}return{ok:!1,error:e}}}async has(o){var t;try{return this.vault.getAbstractFileByPath(o)?!0:(t=this.vault.adapter)!=null&&t.exists?await this.vault.adapter.exists(o):!1}catch(e){return!1}}async ensureFolder(o){var e;if(!this.vault.getAbstractFileByPath(o))try{await this.vault.createFolder(o)}catch(s){if(s&&typeof s=="object"&&((e=s.message)!=null&&e.includes("Parent folder"))){let r=o.split("/").filter(Boolean),a="";for(let c of r)if(a=a?`${a}/${c}`:c,!this.vault.getAbstractFileByPath(a))try{await this.vault.createFolder(a)}catch(i){}}}}async createIfAbsent(o,t){if(await this.has(o))return"skipped";try{return await this.vault.create(o,t),"created"}catch(e){return await this.has(o),"skipped"}}async removeDir(o){let t=this.vault.getAbstractFileByPath(o);if(t&&this.vault)try{await this.vault.trash(t,!0),await new Promise(e=>setTimeout(e,200))}catch(e){console.warn(`removeDir: failed to trash ${o}: ${e}`)}else console.warn(`removeDir: file not found: ${o}. File: ${t==null?void 0:t.path}`)}}});var At={};et(At,{ensureValidOrThrow:()=>zt,validateProjectName:()=>Gt,validateTag:()=>Lt});function Gt(n){if(!n||!n.trim())return{ok:!1,reason:"Project name is required"};let o=n.trim();if(o.length>120)return{ok:!1,reason:"Project name too long (max 120)"};for(let t of o)if(t.charCodeAt(0)<32||t==="/"||t==="\\")return{ok:!1,reason:"Project name contains invalid characters"};return{ok:!0}}function Lt(n){if(!n||!n.trim())return{ok:!1,reason:"Tag is required"};let o=n.trim();return Jt.test(o)?{ok:!0}:{ok:!1,reason:"Tag must be 2-63 chars, start with letter/digit; may include -, _, /"}}function zt(n,o){let t=n();if(!t.ok)throw new Error(`${o}: ${t.reason}`)}var Jt,$t=it(()=>{Jt=/^[A-Za-z0-9][A-Za-z0-9_/-]{1,62}$/});var xt={};et(xt,{processTemplate:()=>Ut});function Dt(n){return n==null?"":String(n)}function Ut(n,o){if(!n||typeof n!="string")return"";let t=n;for(let[e,s]of Object.entries(o)){let r=Dt(s),a=`$_${e}`;t.includes(a)&&(t=t.split(a).join(r))}for(let[e,s]of Object.entries(o)){let r=Dt(s),a=new RegExp(`\\$\\{${Wt(e)}\\}`,"g");t=t.replace(a,r)}return t}function Wt(n){return n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}var Tt=it(()=>{});var Yt={};et(Yt,{default:()=>Ht});module.exports=Ot(Yt);var Y=require("obsidian");var vt=require("obsidian"),dt=class extends vt.Modal{constructor(t,e,s){super(t);this.prompt=e,this.callback=s}onOpen(){let{contentEl:t}=this;t.createEl("h2",{text:this.prompt});let e=t.createEl("input",{type:"text"});e.focus();let s=t.createEl("button",{text:"Submit"});s.onclick=()=>{let r=e.value.trim();this.close(),this.callback(r||null)}}onClose(){let{contentEl:t}=this;t.empty()}};var wt=require("obsidian"),at=class extends wt.Modal{constructor(t,e,s,r){super(t);this.prompt=e,this.choices=s,this.callback=r}onOpen(){let{contentEl:t}=this;t.createEl("h2",{text:this.prompt}),this.choices.forEach(e=>{let s=t.createEl("button",{text:e});s.onclick=()=>{this.close(),this.callback(e)}})}onClose(){let{contentEl:t}=this;t.empty()}};var P=require("obsidian");var Pt=require("obsidian"),pt=class extends Pt.Modal{constructor(t,e){super(t);this.onResult=e}onOpen(){let{contentEl:t}=this;t.empty(),t.addClass("project-flow-settings"),t.createEl("p",{text:"Do you want skip settings to defaults? This will override all custom settings."});let e=t.createDiv({cls:"gc-row"});e.createDiv({cls:"gc-spacer"});let s=e.createEl("button",{text:"Yes, use defaults"}),r=e.createEl("button",{text:"Go back"});s.onclick=()=>{this.close(),this.onResult(!0)},r.onclick=()=>{this.close(),this.onResult(!1)}}onClose(){this.contentEl.empty()}};var Mt=[{name:"Business",order:1,categories:["R&D","Jobs","OpenSource","Education"]},{name:"Family",order:2,categories:["Vacations","Parenting","Common"]},{name:"Friends",order:3,categories:[]},{name:"Health",order:4,categories:["Clinics","Issues","R&D"]},{name:"Personal",order:5,categories:["R&D","Languages","SelfManagement","Writing","Reading","Music","Sports"]},{name:"Residence",order:6,categories:[]}],mt={dimensions:JSON.parse(JSON.stringify(Mt)),projectsRoot:"1. Projects",archiveRoot:"4. Archive",projectRecords:{},archivedRecords:{}};function jt(n){let o=0;for(let t=0;t<n.length;t++)o=(o<<5)-o+n.charCodeAt(t),o|=0;return o}var gt=class extends P.PluginSettingTab{constructor(t,e){super(t,e);this.plugin=e}display(){var V;let{containerEl:t}=this;t.empty(),t.addClass("project-flow-settings");let e=t.createDiv({cls:"gc-row"});e.createDiv({cls:"gc-spacer"});let s=e.createEl("button",{cls:["gc-icon-button","clickable-icon"],attr:{"aria-label":"Reset to defaults",title:"Reset to defaults"}});try{(0,P.setIcon)(s,"rotate-ccw")}catch(g){s.setText("Reset to defaults")}s.onclick=()=>{new pt(this.app,async u=>{u&&(this.plugin.settings=JSON.parse(JSON.stringify(mt)),await this.plugin.saveSettings(),new P.Notice("Settings were reset to defaults."),this.display())}).open()},t.createEl("h2",{text:"Folders"});let r=t.createDiv({cls:"gc-column"}),a=r.createDiv({cls:"setting-item"});a.createEl("label",{text:"Projects root"});let c=a.createEl("input",{type:"text"});c.value=this.plugin.settings.projectsRoot||"1. Projects",c.placeholder="e.g. 1. Projects",c.onchange=async()=>{this.plugin.settings.projectsRoot=c.value.trim()||"1. Projects",await this.plugin.saveSettings()};let i=r.createDiv({cls:"setting-item"});i.createEl("label",{text:"Archive root"});let l=i.createEl("input",{type:"text"});l.value=this.plugin.settings.archiveRoot||"4. Archive",l.placeholder="e.g. 4. Archive",l.onchange=async()=>{this.plugin.settings.archiveRoot=l.value.trim()||"4. Archive",await this.plugin.saveSettings()},t.createEl("h2",{text:"Dimensions"}),[...this.plugin.settings.dimensions].sort((g,u)=>{var j,b;return((j=g.order)!=null?j:0)-((b=u.order)!=null?b:0)}).forEach((g,u)=>{let j=t.createDiv({cls:"dimension-setting"}),b=j.createDiv({cls:"dimension-header"});b.addClass("gc-row"),b.createSpan({text:`${g.order}. `});let S=b.createEl("b",{text:g.name});b.createDiv({cls:"gc-spacer"});let M=b.createEl("button",{cls:["gc-icon-button","clickable-icon"]});M.setAttr("aria-label","Move up"),M.setAttr("title","Move up");try{(0,P.setIcon)(M,"arrow-up")}catch(A){M.setText("Up")}M.onclick=async()=>{let f=[...this.plugin.settings.dimensions].filter(v=>{var R,w;return((R=v.order)!=null?R:0)<((w=g.order)!=null?w:0)}).sort((v,R)=>{var w,T;return((w=R.order)!=null?w:0)-((T=v.order)!=null?T:0)})[0];if(!f)return;let D=f.order;f.order=g.order,g.order=D,await this.plugin.saveSettings(),this.display()};let y=b.createEl("button",{cls:["gc-icon-button","clickable-icon"]});y.setAttr("aria-label","Move down"),y.setAttr("title","Move down");try{(0,P.setIcon)(y,"arrow-down")}catch(A){y.setText("Down")}y.onclick=async()=>{let f=[...this.plugin.settings.dimensions].filter(v=>{var R,w;return((R=v.order)!=null?R:0)>((w=g.order)!=null?w:0)}).sort((v,R)=>{var w,T;return((w=v.order)!=null?w:0)-((T=R.order)!=null?T:0)})[0];if(!f)return;let D=f.order;f.order=g.order,g.order=D,await this.plugin.saveSettings(),this.display()};let $=b.createEl("button",{cls:["gc-icon-button","clickable-icon"]});$.setAttr("aria-label",`Delete ${g.name}`),$.setAttr("title",`Delete ${g.name}`);try{(0,P.setIcon)($,"trash")}catch(A){$.setText("Remove")}$.onclick=async()=>{let A=this.plugin.settings.dimensions.findIndex(f=>f===g);A>=0&&this.plugin.settings.dimensions.splice(A,1),await this.plugin.saveSettings(),this.display()};let F=b.createEl("button",{cls:["gc-icon-button","clickable-icon"]});F.setAttr("aria-label",`Rename ${g.name}`),F.setAttr("title",`Rename ${g.name}`);try{(0,P.setIcon)(F,"pencil")}catch(A){F.setText("Edit")}if(F.onclick=async()=>{var W;let A=g.name,f=S.parentElement;(W=S.detach)==null||W.call(S),F.style.display="none",$.style.display="none";let D=f.createEl("input",{type:"text"});D.value=A,D.addClass("gc-rename");let v=f.createDiv({cls:"gc-row"});v.createDiv({cls:"gc-spacer"});let R=v.createEl("button",{cls:["gc-icon-button","clickable-icon"]});R.setAttr("aria-label","Apply"),R.setAttr("title","Apply");try{(0,P.setIcon)(R,"check")}catch(N){R.setText("Apply")}let w=v.createEl("button",{cls:["gc-icon-button","clickable-icon"]});w.setAttr("aria-label","Discard"),w.setAttr("title","Discard");try{(0,P.setIcon)(w,"x")}catch(N){w.setText("Discard")}let T=()=>{this.display()},O=async N=>{let J=N.trim();if(!J||J===A){T();return}if(this.plugin.settings.dimensions.some(nt=>nt!==g&&nt.name===J)){new P.Notice("A dimension with this name already exists.");return}g.name=J,await this.plugin.saveSettings(),T()};R.onclick=async()=>{await O(D.value)},w.onclick=()=>T(),D.focus(),D.select(),D.onkeydown=async N=>{N.key==="Enter"&&await O(D.value),N.key==="Escape"&&T()},D.onblur=async()=>{await O(D.value)}},g.categories.length>0){let A=j.createDiv({cls:"categories-list gc-list"});g.categories.forEach((f,D)=>{var nt;let v=A.createDiv({cls:"gc-list-item gc-row"}),R=this.plugin.settings.projectRecords||{},w=g.name,T=Object.keys(((nt=R==null?void 0:R[w])==null?void 0:nt[f])||{}),O=v.createEl("b",{text:f}),W=v.createDiv({cls:"gc-id-wrap"});T.length>0&&(W.createSpan({text:" "}),T.forEach((B,ct)=>{let _=W.createSpan({cls:"gc-id-chip"});_.style.display="inline-flex",_.style.alignItems="center",_.style.gap="4px";let tt=_.createSpan({cls:"gc-id-tag",text:B}),K=Math.abs(jt(B))%360;tt.style.backgroundColor=`hsl(${K}, 70%, 90%)`,tt.style.color=`hsl(${K}, 70%, 25%)`;let G=_.createSpan({cls:"gc-id-actions"});G.style.display="none";let z=G.createEl("button",{cls:["gc-icon-button","clickable-icon"]});z.setAttr("aria-label",`Delete ${B}`),z.setAttr("title",`Delete ${B}`);try{(0,P.setIcon)(z,"trash")}catch(X){z.setText("Del")}z.onclick=async X=>{X.stopPropagation();let[,U]=await this.plugin.deleteProjectById(w,f,B);new P.Notice(U),this.display()};let H=G.createEl("button",{cls:["gc-icon-button","clickable-icon"]});H.setAttr("aria-label",`Archive ${B}`),H.setAttr("title",`Archive ${B}`);try{(0,P.setIcon)(H,"archive")}catch(X){H.setText("Arc")}H.onclick=async X=>{X.stopPropagation();let[,U]=await this.plugin.archiveProjectByPromptInfo(w,f,B);new P.Notice(U),this.display()},_.onmouseenter=()=>{G.style.display="inline-flex"},_.onmouseleave=()=>{G.style.display="none"},ct<T.length-1&&W.createSpan({text:" "})})),v.createDiv({cls:"gc-spacer"});let N=v.createEl("button",{cls:["remove-category","gc-icon-button","clickable-icon"]});N.setAttr("aria-label",`Delete ${f}`),N.setAttr("title",`Delete ${f}`);try{(0,P.setIcon)(N,"trash")}catch(B){N.setText("Remove")}N.onclick=async()=>{g.categories.splice(D,1),await this.plugin.saveSettings(),this.display()};let J=v.createEl("button",{cls:["gc-icon-button","clickable-icon"]});J.setAttr("aria-label",`Rename ${f}`),J.setAttr("title",`Rename ${f}`);try{(0,P.setIcon)(J,"pencil")}catch(B){J.setText("Edit")}J.onclick=async()=>{var X;let B=g.categories[D],ct=O.parentElement;(X=O.detach)==null||X.call(O),J.style.display="none",N.style.display="none";let _=ct.createEl("input",{type:"text"});_.value=B,_.addClass("gc-rename");let tt=ct.createDiv({cls:"gc-row"});tt.createDiv({cls:"gc-spacer"});let K=tt.createEl("button",{cls:["gc-icon-button","clickable-icon"]});K.setAttr("aria-label","Apply"),K.setAttr("title","Apply");try{(0,P.setIcon)(K,"check")}catch(U){K.setText("Apply")}let G=tt.createEl("button",{cls:["gc-icon-button","clickable-icon"]});G.setAttr("aria-label","Discard"),G.setAttr("title","Discard");try{(0,P.setIcon)(G,"x")}catch(U){G.setText("Discard")}let z=()=>{this.display()},H=async U=>{let lt=U.trim();if(!lt||lt===B){z();return}if(g.categories.some((kt,St)=>St!==D&&kt===lt)){new P.Notice("This category already exists in the dimension.");return}g.categories[D]=lt,await this.plugin.saveSettings(),z()};K.onclick=async()=>{await H(_.value)},G.onclick=()=>z(),_.focus(),_.select(),_.onkeydown=async U=>{U.key==="Enter"&&await H(_.value),U.key==="Escape"&&z()},_.onblur=async()=>{await H(_.value)}}})}let q=j.createDiv({cls:"add-category gc-row"}),ot=q.createEl("input",{type:"text",placeholder:"New category"});q.createDiv({cls:"gc-spacer"});let ft=q.createEl("button",{text:"Add Category"});ft.onclick=async()=>{let A=ot.value.trim();A&&!g.categories.includes(A)&&(g.categories.push(A),await this.plugin.saveSettings(),this.display())}});let p=t.createDiv({cls:"add-dimension"});p.createEl("h3",{text:"Add new dimension"});let m=p.createDiv({cls:"gc-row"}),E=m.createEl("input",{type:"text",placeholder:"Dimension name"});m.createDiv({cls:"gc-spacer"});let C=m.createEl("button",{text:"Add Dimension"});C.onclick=async()=>{let g=E.value.trim();if(g&&!this.plugin.settings.dimensions.some(u=>u.name===g)){{let u=this.plugin.settings.dimensions.reduce((j,b)=>{var S;return Math.max(j,(S=b.order)!=null?S:0)},0);this.plugin.settings.dimensions.push({name:g,order:u+1,categories:[]})}await this.plugin.saveSettings(),this.display()}},t.createEl("h2",{text:"Archive"});let h=this.plugin.settings.archivedRecords||{},k=h&&!Array.isArray(h)?h:{},x={};for(let g of this.plugin.settings.dimensions)x[g.name]=(V=g.order)!=null?V:Number.MAX_SAFE_INTEGER;let I=Object.keys(k).map(g=>{var u;return{name:g,order:(u=x[g])!=null?u:Number.MAX_SAFE_INTEGER}}).sort((g,u)=>g.order-u.order||g.name.localeCompare(u.name)),L=!1;I.forEach(({name:g,order:u})=>{let j=k[g]||{},b=Object.keys(j).filter(F=>Object.keys(j[F]||{}).length>0).sort();if(b.length===0)return;L=!0;let S=t.createDiv({cls:"dimension-setting"}),M=S.createDiv({cls:"dimension-header gc-row"}),y=this.plugin.settings.dimensions.find(F=>F.name===g);y&&M.createSpan({text:`${y.order}. `}),M.createEl("b",{text:g}),M.createDiv({cls:"gc-spacer"});let $=S.createDiv({cls:"categories-list gc-list"});b.forEach(F=>{let q=$.createDiv({cls:"gc-list-item gc-row"}),ot=Object.keys((j==null?void 0:j[F])||{}).sort(),ft=q.createEl("b",{text:F}),A=q.createDiv({cls:"gc-id-wrap"});ot.length>0&&(A.createSpan({text:" "}),ot.forEach((f,D)=>{let v=A.createSpan({cls:"gc-id-chip"});v.style.display="inline-flex",v.style.alignItems="center",v.style.gap="4px";let R=v.createSpan({cls:"gc-id-tag",text:f}),w=Math.abs(jt(f))%360;R.style.backgroundColor=`hsl(${w}, 70%, 90%)`,R.style.color=`hsl(${w}, 70%, 25%)`;let T=v.createSpan({cls:"gc-id-actions"});T.style.display="none";let O=T.createEl("button",{cls:["gc-icon-button","clickable-icon"]});O.setAttr("aria-label",`Delete ${f}`),O.setAttr("title",`Delete ${f}`);try{(0,P.setIcon)(O,"trash")}catch(W){O.setText("Del")}O.onclick=async W=>{W.stopPropagation();let[,N]=await this.plugin.deleteArchivedProject(g,F,f);new P.Notice(N),this.display()},v.onmouseenter=()=>{T.style.display="inline-flex"},v.onmouseleave=()=>{T.style.display="none"},D<ot.length-1&&A.createSpan({text:" "})})),q.createDiv({cls:"gc-spacer"})})}),L||t.createDiv({cls:"setting-item"}).createSpan({text:"No archived projects yet."})}};var ht=class extends Y.Plugin{async onload(){console.log("ProjectFlow plugin loaded"),await this.loadSettings(),this.addSettingTab(new gt(this.app,this)),this.addCommand({id:"add-project-info",name:"Add Project Info",callback:()=>this.showProjectPrompt()}),this.addCommand({id:"remove-project-by-id",name:"Remove Project",callback:()=>this.showProjectRemovePrompt()}),this.addCommand({id:"archive-project-by-id",name:"Archive Project",callback:()=>this.showProjectArchivePrompt()})}async loadSettings(){let t=await this.loadData();try{let{migrateSettings:e}=await Promise.resolve().then(()=>(Rt(),bt));this.settings=Object.assign({},mt,e(t))}catch(e){this.settings=Object.assign({},mt,t)}}async saveSettings(){await this.saveData(this.settings)}async showProjectRemovePrompt(){let[t,e]=await this.getProjectDetailsWithPrompt();if(t===null){new Y.Notice(e);return}let{dimension:s,category:r,projectId:a}=t,[,c]=await this.deleteProjectById(s,r,a);new Y.Notice(c),console.log(c)}async showProjectArchivePrompt(){let[t,e]=await this.getProjectDetailsWithPrompt();if(t===null){new Y.Notice(e);return}let{dimension:s,category:r,projectId:a}=t,[,c]=await this.archiveProjectByPromptInfo(s,r,a);new Y.Notice(c),console.log(c)}async archiveProjectByPromptInfo(t,e,s){var r,a,c,i,l;try{let d=this.settings.projectRecords,p=(a=(r=d==null?void 0:d[t])==null?void 0:r[e])==null?void 0:a[s];if(!p)return[!1,"Project not found."];let{sanitizePath:m}=await Promise.resolve().then(()=>(rt(),st)),{SafeFileManager:E}=await Promise.resolve().then(()=>(Q(),Z)),C=new E(this.app),h=this.app.vault.adapter,k=m(p.variables.PROJECT_PATH),x=m(`Templates/${p.info.name}_Templates`),I=this.settings.archiveRoot||"4. Archive",L=p.variables.YEAR,V=p.variables.DIMENSION||p.info.dimension,g=p.info.category,u=p.info.parent&&p.info.parent.trim().length>0?p.info.parent.trim():null,j=p.info.name,b=u?`${L}.${V}.${g}.${u}.${j}`:`${L}.${V}.${g}.${j}`,S=m(`${I}/${b}`),M=y=>{let $=y.split("/").filter(Boolean);return $.pop(),$.join("/")};if(await C.ensureFolder(M(S)),!await h.exists(k))return[!1,`Project directory not found: ${k}`];if(await h.exists(S))return[!1,`Archive destination already exists: ${S}`];await h.rename(k,S);try{if(await h.exists(x)){let y=m(`${S}/Templates`);await C.ensureFolder(y);let $=m(`${y}/${p.info.name}_Templates`);if(await h.exists($)){let F=m(`${y}/${p.info.name}_Templates_archived`);await h.rename(x,F)}else await h.rename(x,$)}}catch(y){console.warn("Archiving templates failed:",y)}try{let y=this.settings.projectRecords;(!this.settings.archivedRecords||Array.isArray(this.settings.archivedRecords))&&(this.settings.archivedRecords=this.settings.archivedRecords&&Array.isArray(this.settings.archivedRecords)?{}:this.settings.archivedRecords||{});let $=this.settings.archivedRecords;$[t]=$[t]||{},$[t][e]=$[t][e]||{},$[t][e][s]=p,(i=(c=y==null?void 0:y[t])==null?void 0:c[e])!=null&&i[s]&&(delete y[t][e][s],Object.keys(y[t][e]).length===0&&delete y[t][e],Object.keys(y[t]||{}).length===0&&delete y[t]),await this.saveSettings()}catch(y){console.warn("Failed to move project record to archive in settings:",y)}return[!0,"Project archived successfully."]}catch(d){return console.error("Archive failed:",d),[!1,(l=d==null?void 0:d.message)!=null?l:"Failed to archive project."]}}async showProjectPrompt(){let[t,e]=await this.getNewProjectDetailsWithPrompt();if(t===null){new Y.Notice(e);return}let{dimension:s,category:r,id:a,name:c,tag:i,parent:l}=t,[,d]=await this.createProject(t);new Y.Notice(d),console.log(d)}async getNewProjectDetailsWithPrompt(){var E,C;let t=await this.promptForText("Enter project name:");if(!t)return[null,"Project creation cancelled. No project name provided."];let e=await this.promptForText("Enter project tag:");if(!e)return[null,"Project creation cancelled. No project tag provided."];let s=await this.promptForText("Enter Project ID (used for task prefixes):");if(!s)return[null,"Project creation cancelled. No Project ID provided."];let r=await this.promptForText("Enter parent name (optional):"),a=r&&r.trim().length>0?r.trim():null,c=[...this.settings.dimensions].sort((h,k)=>{var x,I;return((x=h.order)!=null?x:0)-((I=k.order)!=null?I:0)}).map(h=>h.name),i=await this.promptForChoice("Select dimension:",c);if(!i)return[null,"Project creation cancelled. No dimension selected."];let l=this.settings.dimensions.find(h=>h.name===i);if(!l||l.categories.length===0)return[null,"Selected dimension has no categories. Please add categories in settings first."];let d=l.categories,p=await this.promptForChoice("Select category:",d);if(!p)return[null,"Project creation cancelled. No category selected."];let m={name:t,tag:e,id:s,parent:a,dimension:i,category:p};try{let h=this.settings.projectRecords;if(h&&!Array.isArray(h)&&((C=(E=h[i])==null?void 0:E[p])==null?void 0:C[s]))return[null,`Project with ID "${s}" already exists in ${i}:${p}. Choose a different ID.`]}catch(h){}try{let{validateProjectName:h,validateTag:k,ensureValidOrThrow:x}=await Promise.resolve().then(()=>($t(),At));x(()=>h(m.name),"Invalid project name"),x(()=>k(m.tag),"Invalid tag"),x(()=>k(m.id),"Invalid Project ID")}catch(h){let k=h.message||"Invalid input";return console.error("Validation error:",h),[null,k]}return[m,"Project details collected."]}async promptForText(t){return new Promise(e=>{new dt(this.app,t,e).open()})}async promptForChoice(t,e){return new Promise(s=>{new at(this.app,t,e,s).open()})}async getProjectDetailsWithPrompt(){if(!this.settings.projectRecords)return[null,"You don't have any projects yet."];let t=this.settings.projectRecords,e=[...this.settings.dimensions].sort((l,d)=>{var p,m;return((p=l.order)!=null?p:0)-((m=d.order)!=null?m:0)}).map(l=>l.name),s=await this.promptForChoice("Select dimension of your project:",e);if(!s)return[null,"Project removal cancelled. No dimension selected."];let r=this.settings.dimensions.find(l=>l.name===s);if(!r||r.categories.length===0)return[null,"Selected dimension has no categories. No project to remove."];let a=r.categories,c=await this.promptForChoice("Select category:",a);if(!c)return[null,"Project removal cancelled. No category selected."];let i=await this.promptForChoice("Select Project to remove:",Object.keys(t[s][c]));return i?[{dimension:s,category:c,projectId:i},"Project removal confirmed."]:[null,"Project removal cancelled. No project selected."]}generateProjectVariables(t){let e=new Date,s=e.getFullYear().toString(),r=e.toISOString().split("T")[0],a=this.settings.projectsRoot||"1. Projects",c=t.parent&&t.parent.trim().length>0?`.${t.parent.trim()}`:"",i=`${s}${c}.${t.name}`,l=this.settings.dimensions.find(E=>E.name===t.dimension),d=l?`${l.order}. ${l.name}`:t.dimension,p=`${a}/${d}/${t.category}/${i}`,m=`${p}`;return{PROJECT_NAME:t.name,PROJECT_TAG:t.tag,PROJECT_PARENT:t.parent?t.parent:"",PARENT_TAG:t.parent?t.tag:"",YEAR:s,DATE:r,PROJECT_FULL_NAME:i,PROJECT_RELATIVE_PATH:p,PROJECT_PATH:m,DIMENSION:l?l.name:t.dimension,CATEGORY:t.category,PROJECT_ID:t.id,PROJECT_DIMENSION:l?l.name:t.dimension}}async processTemplate(t,e){try{let{processTemplate:s}=await Promise.resolve().then(()=>(Tt(),xt));return s(t,e)}catch(s){console.warn("Template processor import failed, using legacy replacement:",s);let r=t;return Object.entries(e).forEach(([a,c])=>{let i=`$_${a}`;r=r.split(i).join(c)}),r}}async createProject(t){try{let e=this.generateProjectVariables(t),s=this.settings.projectsRoot||"1. Projects",{sanitizePath:r,sanitizeFileName:a}=await Promise.resolve().then(()=>(rt(),st)),{SafeFileManager:c}=await Promise.resolve().then(()=>(Q(),Z)),i=new c(this.app),l=r(s),d=this.settings.dimensions.find(u=>u.name===t.dimension),p=d?`${d.order}. ${d.name}`:t.dimension,m=a(p),E=a(t.category),C=r(`${l}/${m}/${E}/${e.PROJECT_FULL_NAME}`),k=[{type:"folder",path:C},...["Knowledge Base","Meetings","Work","Work/Tasks","People"].map(u=>({type:"folder",path:r(`${C}/${u}`)}))],x=this.app.vault.adapter,I=`.obsidian/plugins/${this.manifest.id}/src/templates`,L=[{fileName:`${e.PROJECT_FULL_NAME}.md`,template:"project.md"},{fileName:`${t.name} Meetings.md`,template:"meetings.md"},{fileName:`${t.name} People.md`,template:"people.md"},{fileName:`${t.name} Work.md`,template:"work.md"},{fileName:`${t.name} Knowledge Base.md`,template:"knowledge-base.md"}],V=[];for(let u of L){let j=`${I}/${u.template}`;if(!await x.exists(j))throw new Error(`Template file not found: ${u.template}`);let b=await x.read(j),S=await this.processTemplate(b,e),M=r(`${C}/${a(u.fileName)}`);V.push({type:"file",path:M,data:S})}let g=await i.createBatch([...k,...V]);if(!("ok"in g)||!g.ok)throw new Error(`Batch creation failed: ${g.error||"unknown"}`);return await this.createProjectTemplates(t.name,e),await this.recordProjectCreation(t,e),[!0,`Project "${t.name}" created successfully!`]}catch(e){return[!1,`Error creating project: ${e}`]}}async recordProjectCreation(t,e){try{let s={info:t,variables:e,createdAt:new Date().toISOString()},r=t.dimension,a=t.category,c=t.id;if(!this.settings.projectRecords||Array.isArray(this.settings.projectRecords)){let l={},d=Array.isArray(this.settings.projectRecords)?this.settings.projectRecords:[];for(let p of d){let m=p.info.dimension,E=p.info.category,C=p.info.id;l[m]=l[m]||{},l[m][E]=l[m][E]||{},l[m][E][C]=p}this.settings.projectRecords=l}let i=this.settings.projectRecords;if(i[r]=i[r]||{},i[r][a]=i[r][a]||{},i[r][a][c])throw new Error(`Project with id "${c}" already exists in ${r}:${a}`);i[r][a][c]=s,await this.saveSettings()}catch(s){throw console.warn("Failed to record project creation:",s),s}}async ensureDirectoryExists(t){let{SafeFileManager:e}=await Promise.resolve().then(()=>(Q(),Z));await new e(this.app).ensureFolder(t)}async createProjectFile(t,e,s,r){try{let a=this.app.vault.adapter,c=`.obsidian/plugins/${this.manifest.id}/src/templates/${s}`;if(console.log("Template: "+c),!await a.exists(c))throw new Error(`Template file not found: ${s}`);let i=await this.app.vault.adapter.read(c),l=await this.processTemplate(i,r),d=`${t}/${e}`,{SafeFileManager:p}=await Promise.resolve().then(()=>(Q(),Z));await new p(this.app).createIfAbsent(d,l)}catch(a){throw console.error(`Failed to create ${e}:`,a),new Error(`Failed to create ${e}: ${a}`)}}async createProjectTemplates(t,e){let{sanitizePath:s,sanitizeFileName:r}=await Promise.resolve().then(()=>(rt(),st)),a=s(`Templates/${t}_Templates`);await this.ensureDirectoryExists(a);let c=[{source:"template-meeting-daily.md",target:`${t}_Meeting_Daily_Template.md`},{source:"template-meeting-discussion.md",target:`${t}_Meeting_Discussion_Template.md`},{source:"template-meeting-knowledge.md",target:`${t}_Meeting_Knowledge_Template.md`},{source:"template-meeting-planning.md",target:`${t}_Meeting_Planning_Template.md`},{source:"template-meeting-refinement.md",target:`${t}_Meeting_Refinement_Template.md`},{source:"template-meeting-retro.md",target:`${t}_Meeting_Retro_Template.md`},{source:"template-meeting-demo.md",target:`${t}_Meeting_Demo_Template.md`},{source:"template-sprint.md",target:`${t}_Sprint_Template.md`},{source:"template-task.md",target:`${t}_Task_Template.md`},{source:"template-idea.md",target:`${t}_Idea_Template.md`},{source:"template-knowledge-base-item.md",target:`${t}_Knowledge_Item_Template.md`}];for(let i of c)try{let l=r(i.target);await this.createProjectFile(a,l,i.source,e)}catch(l){console.warn(`Failed to create template ${i.target}: ${l}`)}}async deleteProjectById(t,e,s){let r="",a=this.settings.projectRecords,c=a[t][e][s];console.log(c);let{SafeFileManager:i}=await Promise.resolve().then(()=>(Q(),Z)),l=new i(this.app),{sanitizePath:d}=await Promise.resolve().then(()=>(rt(),st)),p=d(c.variables.PROJECT_PATH),m=d(`Templates/${c.info.name}_Templates`);try{console.debug("Removing project dir: "+p),await l.removeDir(p),console.debug("Removing templates dir: "+m),await l.removeDir(m);try{console.debug("Removing project record from settings"),a[t][e][s]&&(delete a[t][e][s],Object.keys(a[t][e]).length===0&&delete a[t][e],Object.keys(a[t]).length===0&&delete a[t]),await this.saveSettings(),r="Project deleted successfully."}catch(E){r="Failed to update projectRecords after delete",console.warn(r,E)}return[!0,r]}catch(E){r="Error removing project: "+E.message,console.error("Error removing project:",E)}return[!1,r]}async deleteArchivedProject(t,e,s){var r,a,c,i,l;try{let d=this.settings.archivedRecords,p=(a=(r=d==null?void 0:d[t])==null?void 0:r[e])==null?void 0:a[s];if(!p)return[!1,"Archived project not found."];let{sanitizePath:m}=await Promise.resolve().then(()=>(rt(),st)),{SafeFileManager:E}=await Promise.resolve().then(()=>(Q(),Z)),C=new E(this.app),h=this.app.vault.adapter,k=this.settings.archiveRoot||"4. Archive",x=p.variables.YEAR,I=p.variables.DIMENSION||p.info.dimension,L=p.info.category,V=p.info.parent&&p.info.parent.trim().length>0?p.info.parent.trim():null,g=p.info.name,u=V?`${x}.${I}.${L}.${V}.${g}`:`${x}.${I}.${L}.${g}`,j=m(`${k}/${u}`);await h.exists(j)&&await C.removeDir(j);try{(i=(c=d==null?void 0:d[t])==null?void 0:c[e])!=null&&i[s]&&(delete d[t][e][s],Object.keys(d[t][e]).length===0&&delete d[t][e],Object.keys(d[t]||{}).length===0&&delete d[t]),await this.saveSettings()}catch(b){console.warn("Failed to update archivedRecords after delete:",b)}return[!0,"Archived project deleted."]}catch(d){return console.error("deleteArchivedProject error:",d),[!1,(l=d==null?void 0:d.message)!=null?l:"Failed to delete archived project."]}}};var Ht=ht;
