/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var ut=Object.defineProperty;var _t=Object.getOwnPropertyDescriptor;var Ft=Object.getOwnPropertyNames;var Ct=Object.prototype.hasOwnProperty;var it=(n,o)=>()=>(n&&(o=n(n=0)),o);var et=(n,o)=>{for(var t in o)ut(n,t,{get:o[t],enumerable:!0})},Ot=(n,o,t,e)=>{if(o&&typeof o=="object"||typeof o=="function")for(let s of Ft(o))!Ct.call(n,s)&&s!==t&&ut(n,s,{get:()=>o[s],enumerable:!(e=_t(o,s))||e.enumerable});return n};var Nt=n=>Ot(ut({},"__esModule",{value:!0}),n);var Z={};et(Z,{SafeFileManager:()=>yt});var yt,Q=it(()=>{yt=class{constructor(o){this.vault=o.vault}async createBatch(o){let t=[];try{for(let e of o)e.type==="folder"?await this.ensureFolder(e.path):await this.createIfAbsent(e.path,e.data)==="created"&&t.push(e.path);return{ok:!0}}catch(e){for(let s of t.reverse())try{let r=this.vault.getAbstractFileByPath(s);r&&this.vault.delete&&await this.vault.delete(r)}catch(r){}return{ok:!1,error:e}}}async has(o){var t;try{return this.vault.getAbstractFileByPath(o)?!0:(t=this.vault.adapter)!=null&&t.exists?await this.vault.adapter.exists(o):!1}catch(e){return!1}}async ensureFolder(o){var e;if(!this.vault.getAbstractFileByPath(o))try{await this.vault.createFolder(o)}catch(s){if(s&&typeof s=="object"&&((e=s.message)!=null&&e.includes("Parent folder"))){let r=o.split("/").filter(Boolean),a="";for(let c of r)if(a=a?`${a}/${c}`:c,!this.vault.getAbstractFileByPath(a))try{await this.vault.createFolder(a)}catch(i){}}}}async createIfAbsent(o,t){if(await this.has(o))return"skipped";try{return await this.vault.create(o,t),"created"}catch(e){return await this.has(o),"skipped"}}async removeDir(o){let t=this.vault.getAbstractFileByPath(o);if(t&&this.vault)try{await this.vault.trash(t,!0),await new Promise(e=>setTimeout(e,200))}catch(e){console.warn(`removeDir: failed to trash ${o}: ${e}`)}else console.warn(`removeDir: file not found: ${o}. File: ${t==null?void 0:t.path}`)}}});var st={};et(st,{sanitizeFileName:()=>jt,sanitizePath:()=>Bt});function jt(n){let o=(n!=null?n:"").trim();return Array.from(o).filter(e=>e.charCodeAt(0)>=32).join("").replace(/[\\/:*?"<>|]/g,"-").replace(/\s+/g," ").replace(/\.+$/g,"").substring(0,200)||"untitled"}function Bt(n){return n?n.split("/").filter(Boolean).map(jt).join("/"):""}var rt=it(()=>{});var Rt={};et(Rt,{CURRENT_SETTINGS_SCHEMA_VERSION:()=>It,migrateSettings:()=>Vt});function Vt(n){var s,r,a;let o={dimensions:(s=n==null?void 0:n.dimensions)!=null?s:[],projectsRoot:(r=n==null?void 0:n.projectsRoot)!=null?r:"1. Projects",schemaVersion:(a=n==null?void 0:n.schemaVersion)!=null?a:0,projectRecords:{}},t=n==null?void 0:n.projectRecords;if(t&&typeof t=="object"&&!Array.isArray(t))o.projectRecords=t;else if(Array.isArray(t)){let c={};for(let i of t){if(!i||!i.info)continue;let l=i.info.dimension,g=i.info.category,d=i.info.id;!l||!g||!d||(c[l]=c[l]||{},c[l][g]=c[l][g]||{},c[l][g][d]=i)}o.projectRecords=c}else o.projectRecords={};if(Array.isArray(o.dimensions)){let c=1;o.dimensions=o.dimensions.map(i=>{var l;if(i&&typeof i=="object"){let g=(l=i.name)!=null?l:"",d=i.order,m=typeof g=="string"?g.match(/^\s*(\d+)\.\s*(.+)$/):null;return m&&(d=parseInt(m[1],10),g=m[2]),(d==null||Number.isNaN(d))&&(d=c++),{name:g,order:d,categories:Array.isArray(i.categories)?i.categories:[]}}return{name:String(i!=null?i:""),order:c++,categories:[]}})}else o.dimensions=[];let e=[...o.dimensions].sort((c,i)=>{var l,g;return((l=c.order)!=null?l:0)-((g=i.order)!=null?g:0)});return e.forEach((c,i)=>{c.order=i+1}),o.dimensions=e,(!o.schemaVersion||o.schemaVersion<2)&&(o.schemaVersion=2),o}var It,Et=it(()=>{It=2});var At={};et(At,{ensureValidOrThrow:()=>zt,validateProjectName:()=>Gt,validateTag:()=>Lt});function Gt(n){if(!n||!n.trim())return{ok:!1,reason:"Project name is required"};let o=n.trim();if(o.length>120)return{ok:!1,reason:"Project name too long (max 120)"};for(let t of o)if(t.charCodeAt(0)<32||t==="/"||t==="\\")return{ok:!1,reason:"Project name contains invalid characters"};return{ok:!0}}function Lt(n){if(!n||!n.trim())return{ok:!1,reason:"Tag is required"};let o=n.trim();return Jt.test(o)?{ok:!0}:{ok:!1,reason:"Tag must be 2-63 chars, start with letter/digit; may include -, _, /"}}function zt(n,o){let t=n();if(!t.ok)throw new Error(`${o}: ${t.reason}`)}var Jt,$t=it(()=>{Jt=/^[A-Za-z0-9][A-Za-z0-9_/-]{1,62}$/});var Dt={};et(Dt,{processTemplate:()=>Ut});function xt(n){return n==null?"":String(n)}function Ut(n,o){if(!n||typeof n!="string")return"";let t=n;for(let[e,s]of Object.entries(o)){let r=xt(s),a=`$_${e}`;t.includes(a)&&(t=t.split(a).join(r))}for(let[e,s]of Object.entries(o)){let r=xt(s),a=new RegExp(`\\$\\{${Ht(e)}\\}`,"g");t=t.replace(a,r)}return t}function Ht(n){return n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}var Tt=it(()=>{});var Yt={};et(Yt,{default:()=>Wt});module.exports=Nt(Yt);var F=require("obsidian");var wt=require("obsidian"),dt=class extends wt.Modal{constructor(t,e,s){super(t);this.prompt=e,this.callback=s}onOpen(){let{contentEl:t}=this;t.createEl("h2",{text:this.prompt});let e=t.createEl("input",{type:"text"});e.focus();let s=t.createEl("button",{text:"Submit"});s.onclick=()=>{let r=e.value.trim();this.close(),this.callback(r||null)}}onClose(){let{contentEl:t}=this;t.empty()}};var vt=require("obsidian"),at=class extends vt.Modal{constructor(t,e,s,r){super(t);this.prompt=e,this.choices=s,this.callback=r}onOpen(){let{contentEl:t}=this;t.createEl("h2",{text:this.prompt}),this.choices.forEach(e=>{let s=t.createEl("button",{text:e});s.onclick=()=>{this.close(),this.callback(e)}})}onClose(){let{contentEl:t}=this;t.empty()}};var P=require("obsidian");var Pt=require("obsidian"),pt=class extends Pt.Modal{constructor(t,e){super(t);this.onResult=e}onOpen(){let{contentEl:t}=this;t.empty(),t.addClass("project-flow-settings"),t.createEl("p",{text:"Do you want skip settings to defaults? This will override all custom settings."});let e=t.createDiv({cls:"gc-row"});e.createDiv({cls:"gc-spacer"});let s=e.createEl("button",{text:"Yes, use defaults"}),r=e.createEl("button",{text:"Go back"});s.onclick=()=>{this.close(),this.onResult(!0)},r.onclick=()=>{this.close(),this.onResult(!1)}}onClose(){this.contentEl.empty()}};var Mt=[{name:"Business",order:1,categories:["R&D","Jobs","OpenSource","Education"]},{name:"Family",order:2,categories:["Vacations","Parenting","Common"]},{name:"Friends",order:3,categories:[]},{name:"Health",order:4,categories:["Clinics","Issues","R&D"]},{name:"Personal",order:5,categories:["R&D","Languages","SelfManagement","Writing","Reading","Music","Sports"]},{name:"Residence",order:6,categories:[]}],mt={dimensions:JSON.parse(JSON.stringify(Mt)),projectsRoot:"1. Projects",archiveRoot:"4. Archive",projectRecords:{},archivedRecords:{}};function bt(n){let o=0;for(let t=0;t<n.length;t++)o=(o<<5)-o+n.charCodeAt(t),o|=0;return o}var gt=class extends P.PluginSettingTab{constructor(t,e){super(t,e);this.plugin=e}display(){var J;let{containerEl:t}=this;t.empty(),t.addClass("project-flow-settings");let e=t.createDiv({cls:"gc-row"});e.createDiv({cls:"gc-spacer"});let s=e.createEl("button",{cls:["gc-icon-button","clickable-icon"],attr:{"aria-label":"Reset to defaults",title:"Reset to defaults"}});try{(0,P.setIcon)(s,"rotate-ccw")}catch(p){s.setText("Reset to defaults")}s.onclick=()=>{new pt(this.app,async u=>{u&&(this.plugin.settings=JSON.parse(JSON.stringify(mt)),await this.plugin.saveSettings(),new P.Notice("Settings were reset to defaults."),this.display())}).open()},t.createEl("h2",{text:"Folders"});let r=t.createDiv({cls:"gc-column"}),a=r.createDiv({cls:"setting-item"});a.createEl("label",{text:"Projects root"});let c=a.createEl("input",{type:"text"});c.value=this.plugin.settings.projectsRoot||"1. Projects",c.placeholder="e.g. 1. Projects",c.onchange=async()=>{this.plugin.settings.projectsRoot=c.value.trim()||"1. Projects",await this.plugin.saveSettings()};let i=r.createDiv({cls:"setting-item"});i.createEl("label",{text:"Archive root"});let l=i.createEl("input",{type:"text"});l.value=this.plugin.settings.archiveRoot||"4. Archive",l.placeholder="e.g. 4. Archive",l.onchange=async()=>{this.plugin.settings.archiveRoot=l.value.trim()||"4. Archive",await this.plugin.saveSettings()},t.createEl("h2",{text:"Dimensions"}),[...this.plugin.settings.dimensions].sort((p,u)=>{var b,j;return((b=p.order)!=null?b:0)-((j=u.order)!=null?j:0)}).forEach((p,u)=>{let b=t.createDiv({cls:"dimension-setting"}),j=b.createDiv({cls:"dimension-header"});j.addClass("gc-row"),j.createSpan({text:`${p.order}. `});let S=j.createEl("b",{text:p.name});j.createDiv({cls:"gc-spacer"});let B=j.createEl("button",{cls:["gc-icon-button","clickable-icon"]});B.setAttr("aria-label","Move up"),B.setAttr("title","Move up");try{(0,P.setIcon)(B,"arrow-up")}catch(A){B.setText("Up")}B.onclick=async()=>{let f=[...this.plugin.settings.dimensions].filter(w=>{var R,v;return((R=w.order)!=null?R:0)<((v=p.order)!=null?v:0)}).sort((w,R)=>{var v,T;return((v=R.order)!=null?v:0)-((T=w.order)!=null?T:0)})[0];if(!f)return;let x=f.order;f.order=p.order,p.order=x,await this.plugin.saveSettings(),this.display()};let y=j.createEl("button",{cls:["gc-icon-button","clickable-icon"]});y.setAttr("aria-label","Move down"),y.setAttr("title","Move down");try{(0,P.setIcon)(y,"arrow-down")}catch(A){y.setText("Down")}y.onclick=async()=>{let f=[...this.plugin.settings.dimensions].filter(w=>{var R,v;return((R=w.order)!=null?R:0)>((v=p.order)!=null?v:0)}).sort((w,R)=>{var v,T;return((v=w.order)!=null?v:0)-((T=R.order)!=null?T:0)})[0];if(!f)return;let x=f.order;f.order=p.order,p.order=x,await this.plugin.saveSettings(),this.display()};let $=j.createEl("button",{cls:["gc-icon-button","clickable-icon"]});$.setAttr("aria-label",`Delete ${p.name}`),$.setAttr("title",`Delete ${p.name}`);try{(0,P.setIcon)($,"trash")}catch(A){$.setText("Remove")}$.onclick=async()=>{let A=this.plugin.settings.dimensions.findIndex(f=>f===p);A>=0&&this.plugin.settings.dimensions.splice(A,1),await this.plugin.saveSettings(),this.display()};let C=j.createEl("button",{cls:["gc-icon-button","clickable-icon"]});C.setAttr("aria-label",`Rename ${p.name}`),C.setAttr("title",`Rename ${p.name}`);try{(0,P.setIcon)(C,"pencil")}catch(A){C.setText("Edit")}if(C.onclick=async()=>{var W;let A=p.name,f=S.parentElement;(W=S.detach)==null||W.call(S),C.style.display="none",$.style.display="none";let x=f.createEl("input",{type:"text"});x.value=A,x.addClass("gc-rename");let w=f.createDiv({cls:"gc-row"});w.createDiv({cls:"gc-spacer"});let R=w.createEl("button",{cls:["gc-icon-button","clickable-icon"]});R.setAttr("aria-label","Apply"),R.setAttr("title","Apply");try{(0,P.setIcon)(R,"check")}catch(N){R.setText("Apply")}let v=w.createEl("button",{cls:["gc-icon-button","clickable-icon"]});v.setAttr("aria-label","Discard"),v.setAttr("title","Discard");try{(0,P.setIcon)(v,"x")}catch(N){v.setText("Discard")}let T=()=>{this.display()},M=async N=>{let G=N.trim();if(!G||G===A){T();return}if(this.plugin.settings.dimensions.some(nt=>nt!==p&&nt.name===G)){new P.Notice("A dimension with this name already exists.");return}p.name=G,await this.plugin.saveSettings(),T()};R.onclick=async()=>{await M(x.value)},v.onclick=()=>T(),x.focus(),x.select(),x.onkeydown=async N=>{N.key==="Enter"&&await M(x.value),N.key==="Escape"&&T()},x.onblur=async()=>{await M(x.value)}},p.categories.length>0){let A=b.createDiv({cls:"categories-list gc-list"});p.categories.forEach((f,x)=>{var nt;let w=A.createDiv({cls:"gc-list-item gc-row"}),R=this.plugin.settings.projectRecords||{},v=p.name,T=Object.keys(((nt=R==null?void 0:R[v])==null?void 0:nt[f])||{}),M=w.createEl("b",{text:f}),W=w.createDiv({cls:"gc-id-wrap"});T.length>0&&(W.createSpan({text:" "}),T.forEach((I,ct)=>{let _=W.createSpan({cls:"gc-id-chip"});_.style.display="inline-flex",_.style.alignItems="center",_.style.gap="4px";let tt=_.createSpan({cls:"gc-id-tag",text:I}),K=Math.abs(bt(I))%360;tt.style.backgroundColor=`hsl(${K}, 70%, 90%)`,tt.style.color=`hsl(${K}, 70%, 25%)`;let L=_.createSpan({cls:"gc-id-actions"});L.style.display="none";let U=L.createEl("button",{cls:["gc-icon-button","clickable-icon"]});U.setAttr("aria-label",`Delete ${I}`),U.setAttr("title",`Delete ${I}`);try{(0,P.setIcon)(U,"trash")}catch(X){U.setText("Del")}U.onclick=async X=>{X.stopPropagation();let[,H]=await this.plugin.deleteProjectById(v,f,I);new P.Notice(H),this.display()};let Y=L.createEl("button",{cls:["gc-icon-button","clickable-icon"]});Y.setAttr("aria-label",`Archive ${I}`),Y.setAttr("title",`Archive ${I}`);try{(0,P.setIcon)(Y,"archive")}catch(X){Y.setText("Arc")}Y.onclick=async X=>{X.stopPropagation();let[,H]=await this.plugin.archiveProjectByPromptInfo(v,f,I);new P.Notice(H),this.display()},_.onmouseenter=()=>{L.style.display="inline-flex"},_.onmouseleave=()=>{L.style.display="none"},ct<T.length-1&&W.createSpan({text:" "})})),w.createDiv({cls:"gc-spacer"});let N=w.createEl("button",{cls:["remove-category","gc-icon-button","clickable-icon"]});N.setAttr("aria-label",`Delete ${f}`),N.setAttr("title",`Delete ${f}`);try{(0,P.setIcon)(N,"trash")}catch(I){N.setText("Remove")}N.onclick=async()=>{p.categories.splice(x,1),await this.plugin.saveSettings(),this.display()};let G=w.createEl("button",{cls:["gc-icon-button","clickable-icon"]});G.setAttr("aria-label",`Rename ${f}`),G.setAttr("title",`Rename ${f}`);try{(0,P.setIcon)(G,"pencil")}catch(I){G.setText("Edit")}G.onclick=async()=>{var X;let I=p.categories[x],ct=M.parentElement;(X=M.detach)==null||X.call(M),G.style.display="none",N.style.display="none";let _=ct.createEl("input",{type:"text"});_.value=I,_.addClass("gc-rename");let tt=ct.createDiv({cls:"gc-row"});tt.createDiv({cls:"gc-spacer"});let K=tt.createEl("button",{cls:["gc-icon-button","clickable-icon"]});K.setAttr("aria-label","Apply"),K.setAttr("title","Apply");try{(0,P.setIcon)(K,"check")}catch(H){K.setText("Apply")}let L=tt.createEl("button",{cls:["gc-icon-button","clickable-icon"]});L.setAttr("aria-label","Discard"),L.setAttr("title","Discard");try{(0,P.setIcon)(L,"x")}catch(H){L.setText("Discard")}let U=()=>{this.display()},Y=async H=>{let lt=H.trim();if(!lt||lt===I){U();return}if(p.categories.some((kt,St)=>St!==x&&kt===lt)){new P.Notice("This category already exists in the dimension.");return}p.categories[x]=lt,await this.plugin.saveSettings(),U()};K.onclick=async()=>{await Y(_.value)},L.onclick=()=>U(),_.focus(),_.select(),_.onkeydown=async H=>{H.key==="Enter"&&await Y(_.value),H.key==="Escape"&&U()},_.onblur=async()=>{await Y(_.value)}}})}let q=b.createDiv({cls:"add-category gc-row"}),ot=q.createEl("input",{type:"text",placeholder:"New category"});q.createDiv({cls:"gc-spacer"});let ft=q.createEl("button",{text:"Add Category"});ft.onclick=async()=>{let A=ot.value.trim();A&&!p.categories.includes(A)&&(p.categories.push(A),await this.plugin.saveSettings(),this.display())}});let d=t.createDiv({cls:"add-dimension"});d.createEl("h3",{text:"Add new dimension"});let m=d.createDiv({cls:"gc-row"}),E=m.createEl("input",{type:"text",placeholder:"Dimension name"});m.createDiv({cls:"gc-spacer"});let O=m.createEl("button",{text:"Add Dimension"});O.onclick=async()=>{let p=E.value.trim();if(p&&!this.plugin.settings.dimensions.some(u=>u.name===p)){{let u=this.plugin.settings.dimensions.reduce((b,j)=>{var S;return Math.max(b,(S=j.order)!=null?S:0)},0);this.plugin.settings.dimensions.push({name:p,order:u+1,categories:[]})}await this.plugin.saveSettings(),this.display()}},t.createEl("h2",{text:"Archive"});let h=this.plugin.settings.archivedRecords||{},k=h&&!Array.isArray(h)?h:{},D={};for(let p of this.plugin.settings.dimensions)D[p.name]=(J=p.order)!=null?J:Number.MAX_SAFE_INTEGER;let V=Object.keys(k).map(p=>{var u;return{name:p,order:(u=D[p])!=null?u:Number.MAX_SAFE_INTEGER}}).sort((p,u)=>p.order-u.order||p.name.localeCompare(u.name)),z=!1;V.forEach(({name:p,order:u})=>{let b=k[p]||{},j=Object.keys(b).filter(C=>Object.keys(b[C]||{}).length>0).sort();if(j.length===0)return;z=!0;let S=t.createDiv({cls:"dimension-setting"}),B=S.createDiv({cls:"dimension-header gc-row"}),y=this.plugin.settings.dimensions.find(C=>C.name===p);y&&B.createSpan({text:`${y.order}. `}),B.createEl("b",{text:p}),B.createDiv({cls:"gc-spacer"});let $=S.createDiv({cls:"categories-list gc-list"});j.forEach(C=>{let q=$.createDiv({cls:"gc-list-item gc-row"}),ot=Object.keys((b==null?void 0:b[C])||{}).sort(),ft=q.createEl("b",{text:C}),A=q.createDiv({cls:"gc-id-wrap"});ot.length>0&&(A.createSpan({text:" "}),ot.forEach((f,x)=>{let w=A.createSpan({cls:"gc-id-chip"});w.style.display="inline-flex",w.style.alignItems="center",w.style.gap="4px";let R=w.createSpan({cls:"gc-id-tag",text:f}),v=Math.abs(bt(f))%360;R.style.backgroundColor=`hsl(${v}, 70%, 90%)`,R.style.color=`hsl(${v}, 70%, 25%)`;let T=w.createSpan({cls:"gc-id-actions"});T.style.display="none";let M=T.createEl("button",{cls:["gc-icon-button","clickable-icon"]});M.setAttr("aria-label",`Delete ${f}`),M.setAttr("title",`Delete ${f}`);try{(0,P.setIcon)(M,"trash")}catch(W){M.setText("Del")}M.onclick=async W=>{W.stopPropagation();let[,N]=await this.plugin.deleteArchivedProject(p,C,f);new P.Notice(N),this.display()},w.onmouseenter=()=>{T.style.display="inline-flex"},w.onmouseleave=()=>{T.style.display="none"},x<ot.length-1&&A.createSpan({text:" "})})),q.createDiv({cls:"gc-spacer"})})}),z||t.createDiv({cls:"setting-item"}).createSpan({text:"No archived projects yet."})}};var ht=class extends F.Plugin{async deleteProjectById(t,e,s){let r="",a=this.settings.projectRecords,c=a[t][e][s];console.log(c);let{SafeFileManager:i}=await Promise.resolve().then(()=>(Q(),Z)),l=new i(this.app),{sanitizePath:g}=await Promise.resolve().then(()=>(rt(),st)),d=g(c.variables.PROJECT_PATH),m=g(`Templates/${c.info.name}_Templates`);try{console.debug("Removing project dir: "+d),await l.removeDir(d),console.debug("Removing templates dir: "+m),await l.removeDir(m);try{console.debug("Removing project record from settings"),a[t][e][s]&&(delete a[t][e][s],Object.keys(a[t][e]).length===0&&delete a[t][e],Object.keys(a[t]).length===0&&delete a[t]),await this.saveSettings(),r="Project deleted successfully."}catch(E){r="Failed to update projectRecords after delete",console.warn(r,E)}return[!0,r]}catch(E){r="Error removing project: "+E.message,console.error("Error removing project:",E)}return[!1,r]}async deleteArchivedProject(t,e,s){var r,a,c,i,l;try{let g=this.settings.archivedRecords,d=(a=(r=g==null?void 0:g[t])==null?void 0:r[e])==null?void 0:a[s];if(!d)return[!1,"Archived project not found."];let{sanitizePath:m}=await Promise.resolve().then(()=>(rt(),st)),{SafeFileManager:E}=await Promise.resolve().then(()=>(Q(),Z)),O=new E(this.app),h=this.app.vault.adapter,k=this.settings.archiveRoot||"4. Archive",D=d.variables.YEAR,V=d.variables.DIMENSION||d.info.dimension,z=d.info.category,J=d.info.parent&&d.info.parent.trim().length>0?d.info.parent.trim():null,p=d.info.name,u=J?`${D}.${V}.${z}.${J}.${p}`:`${D}.${V}.${z}.${p}`,b=m(`${k}/${u}`);await h.exists(b)&&await O.removeDir(b);try{(i=(c=g==null?void 0:g[t])==null?void 0:c[e])!=null&&i[s]&&(delete g[t][e][s],Object.keys(g[t][e]).length===0&&delete g[t][e],Object.keys(g[t]||{}).length===0&&delete g[t]),await this.saveSettings()}catch(j){console.warn("Failed to update archivedRecords after delete:",j)}return[!0,"Archived project deleted."]}catch(g){return console.error("deleteArchivedProject error:",g),[!1,(l=g==null?void 0:g.message)!=null?l:"Failed to delete archived project."]}}async onload(){console.log("ProjectFlow plugin loaded"),await this.loadSettings(),this.addSettingTab(new gt(this.app,this)),this.addCommand({id:"add-project-info",name:"Add Project Info",callback:()=>this.showProjectPrompt()}),this.addCommand({id:"remove-project-by-id",name:"Remove Project",callback:()=>this.showProjectRemovePrompt()}),this.addCommand({id:"archive-project-by-id",name:"Archive Project",callback:()=>this.showProjectArchivePrompt()})}async loadSettings(){let t=await this.loadData();try{let{migrateSettings:e}=await Promise.resolve().then(()=>(Et(),Rt));this.settings=Object.assign({},mt,e(t))}catch(e){this.settings=Object.assign({},mt,t)}}async saveSettings(){await this.saveData(this.settings)}async getProjectDetailsWithPrompt(){if(!this.settings.projectRecords)return[null,"You don't have any projects yet."];let t=this.settings.projectRecords,e=[...this.settings.dimensions].sort((l,g)=>{var d,m;return((d=l.order)!=null?d:0)-((m=g.order)!=null?m:0)}).map(l=>l.name),s=await this.promptForChoice("Select dimension of your project:",e);if(!s)return[null,"Project removal cancelled. No dimension selected."];let r=this.settings.dimensions.find(l=>l.name===s);if(!r||r.categories.length===0)return[null,"Selected dimension has no categories. No project to remove."];let a=r.categories,c=await this.promptForChoice("Select category:",a);if(!c)return[null,"Project removal cancelled. No category selected."];let i=await this.promptForChoice("Select Project to remove:",Object.keys(t[s][c]));return i?[{dimension:s,category:c,projectId:i},"Project removal confirmed."]:[null,"Project removal cancelled. No project selected."]}async showProjectRemovePrompt(){let[t,e]=await this.getProjectDetailsWithPrompt();if(t===null){new F.Notice(e);return}let{dimension:s,category:r,projectId:a}=t,[,c]=await this.deleteProjectById(s,r,a);new F.Notice(c),console.log(c)}async showProjectArchivePrompt(){let[t,e]=await this.getProjectDetailsWithPrompt();if(t===null){new F.Notice(e);return}let{dimension:s,category:r,projectId:a}=t,[,c]=await this.archiveProjectByPromptInfo(s,r,a);new F.Notice(c),console.log(c)}async archiveProjectByPromptInfo(t,e,s){var r,a,c,i,l;try{let g=this.settings.projectRecords,d=(a=(r=g==null?void 0:g[t])==null?void 0:r[e])==null?void 0:a[s];if(!d)return[!1,"Project not found."];let{sanitizePath:m}=await Promise.resolve().then(()=>(rt(),st)),{SafeFileManager:E}=await Promise.resolve().then(()=>(Q(),Z)),O=new E(this.app),h=this.app.vault.adapter,k=m(d.variables.PROJECT_PATH),D=m(`Templates/${d.info.name}_Templates`),V=this.settings.archiveRoot||"4. Archive",z=d.variables.YEAR,J=d.variables.DIMENSION||d.info.dimension,p=d.info.category,u=d.info.parent&&d.info.parent.trim().length>0?d.info.parent.trim():null,b=d.info.name,j=u?`${z}.${J}.${p}.${u}.${b}`:`${z}.${J}.${p}.${b}`,S=m(`${V}/${j}`),B=y=>{let $=y.split("/").filter(Boolean);return $.pop(),$.join("/")};if(await O.ensureFolder(B(S)),!await h.exists(k))return[!1,`Project directory not found: ${k}`];if(await h.exists(S))return[!1,`Archive destination already exists: ${S}`];await h.rename(k,S);try{if(await h.exists(D)){let y=m(`${S}/Templates`);await O.ensureFolder(y);let $=m(`${y}/${d.info.name}_Templates`);if(await h.exists($)){let C=m(`${y}/${d.info.name}_Templates_archived`);await h.rename(D,C)}else await h.rename(D,$)}}catch(y){console.warn("Archiving templates failed:",y)}try{let y=this.settings.projectRecords;(!this.settings.archivedRecords||Array.isArray(this.settings.archivedRecords))&&(this.settings.archivedRecords=this.settings.archivedRecords&&Array.isArray(this.settings.archivedRecords)?{}:this.settings.archivedRecords||{});let $=this.settings.archivedRecords;$[t]=$[t]||{},$[t][e]=$[t][e]||{},$[t][e][s]=d,(i=(c=y==null?void 0:y[t])==null?void 0:c[e])!=null&&i[s]&&(delete y[t][e][s],Object.keys(y[t][e]).length===0&&delete y[t][e],Object.keys(y[t]||{}).length===0&&delete y[t]),await this.saveSettings()}catch(y){console.warn("Failed to move project record to archive in settings:",y)}return[!0,"Project archived successfully."]}catch(g){return console.error("Archive failed:",g),[!1,(l=g==null?void 0:g.message)!=null?l:"Failed to archive project."]}}async showProjectPrompt(){var E,O;let t=await this.promptForText("Enter project name:");if(!t){new F.Notice("Project creation cancelled. No project name provided.");return}let e=await this.promptForText("Enter project tag:");if(!e){new F.Notice("Project creation cancelled. No project tag provided.");return}let s=await this.promptForText("Enter Project ID (used for task prefixes):");if(!s){new F.Notice("Project creation cancelled. No Project ID provided.");return}let r=await this.promptForText("Enter parent name (optional):"),a=r&&r.trim().length>0?r.trim():null,c=[...this.settings.dimensions].sort((h,k)=>{var D,V;return((D=h.order)!=null?D:0)-((V=k.order)!=null?V:0)}).map(h=>h.name),i=await this.promptForChoice("Select dimension:",c);if(!i){new F.Notice("Project creation cancelled. No dimension selected.");return}let l=this.settings.dimensions.find(h=>h.name===i);if(!l||l.categories.length===0){new F.Notice("Selected dimension has no categories. Please add categories in settings first.");return}let g=l.categories,d=await this.promptForChoice("Select category:",g);if(!d){new F.Notice("Project creation cancelled. No category selected.");return}let m={name:t,tag:e,id:s,parent:a,dimension:i,category:d};try{let h=this.settings.projectRecords;if(h&&!Array.isArray(h)&&((O=(E=h[i])==null?void 0:E[d])==null?void 0:O[s])){new F.Notice(`Project with ID "${s}" already exists in ${i}:${d}. Choose a different ID.`);return}}catch(h){}try{let{validateProjectName:h,validateTag:k,ensureValidOrThrow:D}=await Promise.resolve().then(()=>($t(),At));D(()=>h(m.name),"Invalid project name"),D(()=>k(m.tag),"Invalid tag"),D(()=>k(m.id),"Invalid Project ID")}catch(h){let k=h.message||"Invalid input";console.error("Validation error:",h),new F.Notice(k);return}await this.createProject(m)}async promptForText(t){return new Promise(e=>{new dt(this.app,t,e).open()})}async promptForChoice(t,e){return new Promise(s=>{new at(this.app,t,e,s).open()})}generateProjectVariables(t){let e=new Date,s=e.getFullYear().toString(),r=e.toISOString().split("T")[0],a=this.settings.projectsRoot||"1. Projects",c=t.parent&&t.parent.trim().length>0?`.${t.parent.trim()}`:"",i=`${s}${c}.${t.name}`,l=this.settings.dimensions.find(E=>E.name===t.dimension),g=l?`${l.order}. ${l.name}`:t.dimension,d=`${a}/${g}/${t.category}/${i}`,m=`${d}`;return{PROJECT_NAME:t.name,PROJECT_TAG:t.tag,PROJECT_PARENT:t.parent?t.parent:"",PARENT_TAG:t.parent?t.tag:"",YEAR:s,DATE:r,PROJECT_FULL_NAME:i,PROJECT_RELATIVE_PATH:d,PROJECT_PATH:m,DIMENSION:l?l.name:t.dimension,CATEGORY:t.category,PROJECT_ID:t.id,PROJECT_DIMENSION:l?l.name:t.dimension}}async processTemplate(t,e){try{let{processTemplate:s}=await Promise.resolve().then(()=>(Tt(),Dt));return s(t,e)}catch(s){console.warn("Template processor import failed, using legacy replacement:",s);let r=t;return Object.entries(e).forEach(([a,c])=>{let i=`$_${a}`;r=r.split(i).join(c)}),r}}async createProject(t){try{let e=this.generateProjectVariables(t),s=this.settings.projectsRoot||"1. Projects",{sanitizePath:r,sanitizeFileName:a}=await Promise.resolve().then(()=>(rt(),st)),{SafeFileManager:c}=await Promise.resolve().then(()=>(Q(),Z)),i=new c(this.app),l=r(s),g=this.settings.dimensions.find(u=>u.name===t.dimension),d=g?`${g.order}. ${g.name}`:t.dimension,m=a(d),E=a(t.category),O=r(`${l}/${m}/${E}/${e.PROJECT_FULL_NAME}`),k=[{type:"folder",path:O},...["Knowledge Base","Meetings","Work","Work/Tasks","People"].map(u=>({type:"folder",path:r(`${O}/${u}`)}))],D=this.app.vault.adapter,V=`.obsidian/plugins/${this.manifest.id}/src/templates`,z=[{fileName:`${e.PROJECT_FULL_NAME}.md`,template:"project.md"},{fileName:`${t.name} Meetings.md`,template:"meetings.md"},{fileName:`${t.name} People.md`,template:"people.md"},{fileName:`${t.name} Work.md`,template:"work.md"},{fileName:`${t.name} Knowledge Base.md`,template:"knowledge-base.md"}],J=[];for(let u of z){let b=`${V}/${u.template}`;if(!await D.exists(b))throw new Error(`Template file not found: ${u.template}`);let j=await D.read(b),S=await this.processTemplate(j,e),B=r(`${O}/${a(u.fileName)}`);J.push({type:"file",path:B,data:S})}let p=await i.createBatch([...k,...J]);if(!("ok"in p)||!p.ok)throw new Error(`Batch creation failed: ${p.error||"unknown"}`);await this.createProjectTemplates(t.name,e),await this.recordProjectCreation(t,e),new F.Notice(`Project "${t.name}" created successfully!`)}catch(e){new F.Notice(`Error creating project: ${e}`),console.error("Project creation error:",e)}}async recordProjectCreation(t,e){try{let s={info:t,variables:e,createdAt:new Date().toISOString()},r=t.dimension,a=t.category,c=t.id;if(!this.settings.projectRecords||Array.isArray(this.settings.projectRecords)){let l={},g=Array.isArray(this.settings.projectRecords)?this.settings.projectRecords:[];for(let d of g){let m=d.info.dimension,E=d.info.category,O=d.info.id;l[m]=l[m]||{},l[m][E]=l[m][E]||{},l[m][E][O]=d}this.settings.projectRecords=l}let i=this.settings.projectRecords;if(i[r]=i[r]||{},i[r][a]=i[r][a]||{},i[r][a][c])throw new Error(`Project with id "${c}" already exists in ${r}:${a}`);i[r][a][c]=s,await this.saveSettings()}catch(s){throw console.warn("Failed to record project creation:",s),s}}async ensureDirectoryExists(t){let{SafeFileManager:e}=await Promise.resolve().then(()=>(Q(),Z));await new e(this.app).ensureFolder(t)}async createProjectFile(t,e,s,r){try{let a=this.app.vault.adapter,c=`.obsidian/plugins/${this.manifest.id}/src/templates/${s}`;if(console.log("Template: "+c),!await a.exists(c))throw new Error(`Template file not found: ${s}`);let i=await this.app.vault.adapter.read(c),l=await this.processTemplate(i,r),g=`${t}/${e}`,{SafeFileManager:d}=await Promise.resolve().then(()=>(Q(),Z));await new d(this.app).createIfAbsent(g,l)}catch(a){throw console.error(`Failed to create ${e}:`,a),new Error(`Failed to create ${e}: ${a}`)}}async createProjectTemplates(t,e){let{sanitizePath:s,sanitizeFileName:r}=await Promise.resolve().then(()=>(rt(),st)),a=s(`Templates/${t}_Templates`);await this.ensureDirectoryExists(a);let c=[{source:"template-meeting-daily.md",target:`${t}_Meeting_Daily_Template.md`},{source:"template-meeting-discussion.md",target:`${t}_Meeting_Discussion_Template.md`},{source:"template-meeting-knowledge.md",target:`${t}_Meeting_Knowledge_Template.md`},{source:"template-meeting-planning.md",target:`${t}_Meeting_Planning_Template.md`},{source:"template-meeting-refinement.md",target:`${t}_Meeting_Refinement_Template.md`},{source:"template-meeting-retro.md",target:`${t}_Meeting_Retro_Template.md`},{source:"template-meeting-demo.md",target:`${t}_Meeting_Demo_Template.md`},{source:"template-sprint.md",target:`${t}_Sprint_Template.md`},{source:"template-task.md",target:`${t}_Task_Template.md`},{source:"template-idea.md",target:`${t}_Idea_Template.md`},{source:"template-knowledge-base-item.md",target:`${t}_Knowledge_Item_Template.md`}];for(let i of c)try{let l=r(i.target);await this.createProjectFile(a,l,i.source,e)}catch(l){console.warn(`Failed to create template ${i.target}: ${l}`)}}};var Wt=ht;
