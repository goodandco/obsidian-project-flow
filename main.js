/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var oe=Object.defineProperty;var ve=Object.getOwnPropertyDescriptor;var be=Object.getOwnPropertyNames;var Ee=Object.prototype.hasOwnProperty;var G=(n,r)=>()=>(n&&(r=n(n=0)),r);var O=(n,r)=>{for(var e in r)oe(n,e,{get:r[e],enumerable:!0})},je=(n,r,e,t)=>{if(r&&typeof r=="object"||typeof r=="function")for(let s of be(r))!Ee.call(n,s)&&s!==e&&oe(n,s,{get:()=>r[s],enumerable:!(t=ve(r,s))||t.enumerable});return n};var Re=n=>je(oe({},"__esModule",{value:!0}),n);var U={};O(U,{SafeFileManager:()=>ne});var ne,z=G(()=>{ne=class{constructor(r){this.vault=r.vault}async createBatch(r){let e=[];try{for(let t of r)t.type==="folder"?await this.ensureFolder(t.path):await this.createIfAbsent(t.path,t.data)==="created"&&e.push(t.path);return{ok:!0}}catch(t){for(let s of e.reverse())try{let i=this.vault.getAbstractFileByPath(s);i&&this.vault.delete&&await this.vault.delete(i)}catch(i){}return{ok:!1,error:t}}}async has(r){var e;try{return this.vault.getAbstractFileByPath(r)?!0:(e=this.vault.adapter)!=null&&e.exists?await this.vault.adapter.exists(r):!1}catch(t){return!1}}async ensureFolder(r){var t;if(!this.vault.getAbstractFileByPath(r))try{await this.vault.createFolder(r)}catch(s){if(s&&typeof s=="object"&&((t=s.message)!=null&&t.includes("Parent folder"))){let i=r.split("/").filter(Boolean),c="";for(let l of i)if(c=c?`${c}/${l}`:l,!this.vault.getAbstractFileByPath(c))try{await this.vault.createFolder(c)}catch(a){}}}}async createIfAbsent(r,e){if(await this.has(r))return"skipped";try{return await this.vault.create(r,e),"created"}catch(t){return await this.has(r),"skipped"}}async removeDir(r){let e=this.vault.getAbstractFileByPath(r);if(e&&this.vault)try{await this.vault.trash(e,!0),await new Promise(t=>setTimeout(t,200))}catch(t){console.warn(`removeDir: failed to trash ${r}: ${t}`)}else console.warn(`removeDir: file not found: ${r}. File: ${e==null?void 0:e.path}`)}}});var ee={};O(ee,{sanitizeFileName:()=>de,sanitizePath:()=>Ae});function de(n){let r=(n!=null?n:"").trim();return Array.from(r).filter(t=>t.charCodeAt(0)>=32).join("").replace(/[\\/:*?"<>|]/g,"-").replace(/\s+/g," ").replace(/\.+$/g,"").substring(0,200)||"untitled"}function Ae(n){return n?n.split("/").filter(Boolean).map(de).join("/"):""}var te=G(()=>{});var pe={};O(pe,{CURRENT_SETTINGS_SCHEMA_VERSION:()=>ke,migrateSettings:()=>xe});function xe(n){var s,i,c;let r={dimensions:(s=n==null?void 0:n.dimensions)!=null?s:[],projectsRoot:(i=n==null?void 0:n.projectsRoot)!=null?i:"1. Projects",schemaVersion:(c=n==null?void 0:n.schemaVersion)!=null?c:0,projectRecords:{}},e=n==null?void 0:n.projectRecords;if(e&&typeof e=="object"&&!Array.isArray(e))r.projectRecords=e;else if(Array.isArray(e)){let l={};for(let a of e){if(!a||!a.info)continue;let d=a.info.dimension,o=a.info.category,p=a.info.id;!d||!o||!p||(l[d]=l[d]||{},l[d][o]=l[d][o]||{},l[d][o][p]=a)}r.projectRecords=l}else r.projectRecords={};if(Array.isArray(r.dimensions)){let l=1;r.dimensions=r.dimensions.map(a=>{var d;if(a&&typeof a=="object"){let o=(d=a.name)!=null?d:"",p=a.order,m=typeof o=="string"?o.match(/^\s*(\d+)\.\s*(.+)$/):null;return m&&(p=parseInt(m[1],10),o=m[2]),(p==null||Number.isNaN(p))&&(p=l++),{name:o,order:p,categories:Array.isArray(a.categories)?a.categories:[]}}return{name:String(a!=null?a:""),order:l++,categories:[]}})}else r.dimensions=[];let t=[...r.dimensions].sort((l,a)=>{var d,o;return((d=l.order)!=null?d:0)-((o=a.order)!=null?o:0)});return t.forEach((l,a)=>{l.order=a+1}),r.dimensions=t,(!r.schemaVersion||r.schemaVersion<2)&&(r.schemaVersion=2),r}var ke,me=G(()=>{ke=2});var ge={};O(ge,{ensureValidOrThrow:()=>Ce,validateProjectName:()=>Se,validateTag:()=>_e});function Se(n){if(!n||!n.trim())return{ok:!1,reason:"Project name is required"};let r=n.trim();if(r.length>120)return{ok:!1,reason:"Project name too long (max 120)"};for(let e of r)if(e.charCodeAt(0)<32||e==="/"||e==="\\")return{ok:!1,reason:"Project name contains invalid characters"};return{ok:!0}}function _e(n){if(!n||!n.trim())return{ok:!1,reason:"Tag is required"};let r=n.trim();return De.test(r)?{ok:!0}:{ok:!1,reason:"Tag must be 2-63 chars, start with letter/digit; may include -, _, /"}}function Ce(n,r){let e=n();if(!e.ok)throw new Error(`${r}: ${e.reason}`)}var De,ue=G(()=>{De=/^[A-Za-z0-9][A-Za-z0-9_/-]{1,62}$/});var ye={};O(ye,{processTemplate:()=>Fe});function he(n){return n==null?"":String(n)}function Fe(n,r){if(!n||typeof n!="string")return"";let e=n;for(let[t,s]of Object.entries(r)){let i=he(s),c=`$_${t}`;e.includes(c)&&(e=e.split(c).join(i))}for(let[t,s]of Object.entries(r)){let i=he(s),c=new RegExp(`\\$\\{${Ne(t)}\\}`,"g");e=e.replace(c,i)}return e}function Ne(n){return n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}var fe=G(()=>{});var Me={};O(Me,{default:()=>Oe});module.exports=Re(Me);var E=require("obsidian");var ae=require("obsidian"),q=class extends ae.Modal{constructor(e,t,s){super(e);this.prompt=t,this.callback=s}onOpen(){let{contentEl:e}=this;e.createEl("h2",{text:this.prompt});let t=e.createEl("input",{type:"text"});t.focus();let s=e.createEl("button",{text:"Submit"});s.onclick=()=>{let i=t.value.trim();this.close(),this.callback(i||null)}}onClose(){let{contentEl:e}=this;e.empty()}};var ce=require("obsidian"),L=class extends ce.Modal{constructor(e,t,s,i){super(e);this.prompt=t,this.choices=s,this.callback=i}onOpen(){let{contentEl:e}=this;e.createEl("h2",{text:this.prompt}),this.choices.forEach(t=>{let s=e.createEl("button",{text:t});s.onclick=()=>{this.close(),this.callback(t)}})}onClose(){let{contentEl:e}=this;e.empty()}};var j=require("obsidian");var le=require("obsidian"),Z=class extends le.Modal{constructor(e,t){super(e);this.onResult=t}onOpen(){let{contentEl:e}=this;e.empty(),e.addClass("project-flow-settings"),e.createEl("p",{text:"Do you want skip settings to defaults? This will override all custom settings."});let t=e.createDiv({cls:"gc-row"});t.createDiv({cls:"gc-spacer"});let s=t.createEl("button",{text:"Yes, use defaults"}),i=t.createEl("button",{text:"Go back"});s.onclick=()=>{this.close(),this.onResult(!0)},i.onclick=()=>{this.close(),this.onResult(!1)}}onClose(){this.contentEl.empty()}};var Te=[{name:"Business",order:1,categories:["R&D","Jobs","OpenSource","Education"]},{name:"Family",order:2,categories:["Vacations","Parenting","Common"]},{name:"Friends",order:3,categories:[]},{name:"Health",order:4,categories:["Clinics","Issues","R&D"]},{name:"Personal",order:5,categories:["R&D","Languages","SelfManagement","Writing","Reading","Music","Sports"]},{name:"Residence",order:6,categories:[]}],Q={dimensions:JSON.parse(JSON.stringify(Te)),projectsRoot:"1. Projects",projectRecords:{}};function $e(n){let r=0;for(let e=0;e<n.length;e++)r=(r<<5)-r+n.charCodeAt(e),r|=0;return r}var X=class extends j.PluginSettingTab{constructor(e,t){super(e,t);this.plugin=t}display(){let{containerEl:e}=this;e.empty(),e.addClass("project-flow-settings");let t=e.createDiv({cls:"gc-row"});t.createDiv({cls:"gc-spacer"});let s=t.createEl("button",{cls:["gc-icon-button","clickable-icon"],attr:{"aria-label":"Reset to defaults",title:"Reset to defaults"}});try{(0,j.setIcon)(s,"rotate-ccw")}catch(o){s.setText("Reset to defaults")}s.onclick=()=>{new Z(this.app,async p=>{p&&(this.plugin.settings=JSON.parse(JSON.stringify(Q)),await this.plugin.saveSettings(),new j.Notice("Settings were reset to defaults."),this.display())}).open()},e.createEl("h2",{text:"Dimensions"}),[...this.plugin.settings.dimensions].sort((o,p)=>{var m,g;return((m=o.order)!=null?m:0)-((g=p.order)!=null?g:0)}).forEach((o,p)=>{let m=e.createDiv({cls:"dimension-setting"}),g=m.createDiv({cls:"dimension-header"});g.addClass("gc-row"),g.createSpan({text:`${o.order}. `});let P=g.createEl("b",{text:o.name});g.createDiv({cls:"gc-spacer"});let h=g.createEl("button",{cls:["gc-icon-button","clickable-icon"]});h.setAttr("aria-label","Move up"),h.setAttr("title","Move up");try{(0,j.setIcon)(h,"arrow-up")}catch(u){h.setText("Up")}h.onclick=async()=>{let y=[...this.plugin.settings.dimensions].filter(v=>{var f,b;return((f=v.order)!=null?f:0)<((b=o.order)!=null?b:0)}).sort((v,f)=>{var b,$;return((b=f.order)!=null?b:0)-(($=v.order)!=null?$:0)})[0];if(!y)return;let w=y.order;y.order=o.order,o.order=w,await this.plugin.saveSettings(),this.display()};let T=g.createEl("button",{cls:["gc-icon-button","clickable-icon"]});T.setAttr("aria-label","Move down"),T.setAttr("title","Move down");try{(0,j.setIcon)(T,"arrow-down")}catch(u){T.setText("Down")}T.onclick=async()=>{let y=[...this.plugin.settings.dimensions].filter(v=>{var f,b;return((f=v.order)!=null?f:0)>((b=o.order)!=null?b:0)}).sort((v,f)=>{var b,$;return((b=v.order)!=null?b:0)-(($=f.order)!=null?$:0)})[0];if(!y)return;let w=y.order;y.order=o.order,o.order=w,await this.plugin.saveSettings(),this.display()};let R=g.createEl("button",{cls:["gc-icon-button","clickable-icon"]});R.setAttr("aria-label",`Delete ${o.name}`),R.setAttr("title",`Delete ${o.name}`);try{(0,j.setIcon)(R,"trash")}catch(u){R.setText("Remove")}R.onclick=async()=>{let u=this.plugin.settings.dimensions.findIndex(y=>y===o);u>=0&&this.plugin.settings.dimensions.splice(u,1),await this.plugin.saveSettings(),this.display()};let x=g.createEl("button",{cls:["gc-icon-button","clickable-icon"]});x.setAttr("aria-label",`Rename ${o.name}`),x.setAttr("title",`Rename ${o.name}`);try{(0,j.setIcon)(x,"pencil")}catch(u){x.setText("Edit")}if(x.onclick=async()=>{var C;let u=o.name,y=P.parentElement;(C=P.detach)==null||C.call(P),x.style.display="none",R.style.display="none";let w=y.createEl("input",{type:"text"});w.value=u,w.addClass("gc-rename");let v=y.createDiv({cls:"gc-row"});v.createDiv({cls:"gc-spacer"});let f=v.createEl("button",{cls:["gc-icon-button","clickable-icon"]});f.setAttr("aria-label","Apply"),f.setAttr("title","Apply");try{(0,j.setIcon)(f,"check")}catch(A){f.setText("Apply")}let b=v.createEl("button",{cls:["gc-icon-button","clickable-icon"]});b.setAttr("aria-label","Discard"),b.setAttr("title","Discard");try{(0,j.setIcon)(b,"x")}catch(A){b.setText("Discard")}let $=()=>{this.display()},S=async A=>{let D=A.trim();if(!D||D===u){$();return}if(this.plugin.settings.dimensions.some(B=>B!==o&&B.name===D)){new j.Notice("A dimension with this name already exists.");return}o.name=D,await this.plugin.saveSettings(),$()};f.onclick=async()=>{await S(w.value)},b.onclick=()=>$(),w.focus(),w.select(),w.onkeydown=async A=>{A.key==="Enter"&&await S(w.value),A.key==="Escape"&&$()},w.onblur=async()=>{await S(w.value)}},o.categories.length>0){let u=m.createDiv({cls:"categories-list gc-list"});o.categories.forEach((y,w)=>{var B;let v=u.createDiv({cls:"gc-list-item gc-row"}),f=this.plugin.settings.projectRecords||{},b=o.name,$=Object.keys(((B=f==null?void 0:f[b])==null?void 0:B[y])||{}),S=v.createEl("b",{text:y}),C=v.createDiv({cls:"gc-id-wrap"});$.length>0&&(C.createSpan({text:" "}),$.forEach((_,K)=>{let k=C.createSpan({cls:"gc-id-tag",text:_}),F=Math.abs($e(_))%360;k.style.backgroundColor=`hsl(${F}, 70%, 90%)`,k.style.color=`hsl(${F}, 70%, 25%)`,K<$.length-1&&C.createSpan({text:" "})})),v.createDiv({cls:"gc-spacer"});let A=v.createEl("button",{cls:["remove-category","gc-icon-button","clickable-icon"]});A.setAttr("aria-label",`Delete ${y}`),A.setAttr("title",`Delete ${y}`);try{(0,j.setIcon)(A,"trash")}catch(_){A.setText("Remove")}A.onclick=async()=>{o.categories.splice(w,1),await this.plugin.saveSettings(),this.display()};let D=v.createEl("button",{cls:["gc-icon-button","clickable-icon"]});D.setAttr("aria-label",`Rename ${y}`),D.setAttr("title",`Rename ${y}`);try{(0,j.setIcon)(D,"pencil")}catch(_){D.setText("Edit")}D.onclick=async()=>{var ie;let _=o.categories[w],K=S.parentElement;(ie=S.detach)==null||ie.call(S),D.style.display="none",A.style.display="none";let k=K.createEl("input",{type:"text"});k.value=_,k.addClass("gc-rename");let F=K.createDiv({cls:"gc-row"});F.createDiv({cls:"gc-spacer"});let I=F.createEl("button",{cls:["gc-icon-button","clickable-icon"]});I.setAttr("aria-label","Apply"),I.setAttr("title","Apply");try{(0,j.setIcon)(I,"check")}catch(N){I.setText("Apply")}let J=F.createEl("button",{cls:["gc-icon-button","clickable-icon"]});J.setAttr("aria-label","Discard"),J.setAttr("title","Discard");try{(0,j.setIcon)(J,"x")}catch(N){J.setText("Discard")}let W=()=>{this.display()},re=async N=>{let Y=N.trim();if(!Y||Y===_){W();return}if(o.categories.some((we,Pe)=>Pe!==w&&we===Y)){new j.Notice("This category already exists in the dimension.");return}o.categories[w]=Y,await this.plugin.saveSettings(),W()};I.onclick=async()=>{await re(k.value)},J.onclick=()=>W(),k.focus(),k.select(),k.onkeydown=async N=>{N.key==="Enter"&&await re(k.value),N.key==="Escape"&&W()},k.onblur=async()=>{await re(k.value)}}})}let M=m.createDiv({cls:"add-category gc-row"}),H=M.createEl("input",{type:"text",placeholder:"New category"});M.createDiv({cls:"gc-spacer"});let V=M.createEl("button",{text:"Add Category"});V.onclick=async()=>{let u=H.value.trim();u&&!o.categories.includes(u)&&(o.categories.push(u),await this.plugin.saveSettings(),this.display())}});let c=e.createDiv({cls:"add-dimension"});c.createEl("h3",{text:"Add new dimension"});let l=c.createDiv({cls:"gc-row"}),a=l.createEl("input",{type:"text",placeholder:"Dimension name"});l.createDiv({cls:"gc-spacer"});let d=l.createEl("button",{text:"Add Dimension"});d.onclick=async()=>{let o=a.value.trim();if(o&&!this.plugin.settings.dimensions.some(p=>p.name===o)){{let p=this.plugin.settings.dimensions.reduce((m,g)=>{var P;return Math.max(m,(P=g.order)!=null?P:0)},0);this.plugin.settings.dimensions.push({name:o,order:p+1,categories:[]})}await this.plugin.saveSettings(),this.display()}}}};var se=class extends E.Plugin{async deleteProjectById(e,t,s){let i="",c=this.settings.projectRecords,l=c[e][t][s];console.log(l);let{SafeFileManager:a}=await Promise.resolve().then(()=>(z(),U)),d=new a(this.app),{sanitizePath:o}=await Promise.resolve().then(()=>(te(),ee)),p=o(l.variables.PROJECT_PATH),m=o(`Templates/${l.info.name}_Templates`);try{console.debug("Removing project dir: "+p),await d.removeDir(p),console.debug("Removing templates dir: "+m),await d.removeDir(m);try{console.debug("Removing project record from settings"),c[e][t][s]&&(delete c[e][t][s],Object.keys(c[e][t]).length===0&&delete c[e][t],Object.keys(c[e]).length===0&&delete c[e]),await this.saveSettings(),i="Project deleted successfully."}catch(g){i="Failed to update projectRecords after delete",console.warn(i,g)}return[!0,i]}catch(g){i="Error removing project: "+g.message,console.error("Error removing project:",g)}return[!1,i]}async onload(){console.log("ProjectFlow plugin loaded"),await this.loadSettings(),this.addSettingTab(new X(this.app,this)),this.addCommand({id:"add-project-info",name:"Add Project Info",callback:()=>this.showProjectPrompt()}),this.addCommand({id:"remove-project-by-id",name:"Remove Project",callback:()=>this.showProjectRemovePrompt()})}async loadSettings(){let e=await this.loadData();try{let{migrateSettings:t}=await Promise.resolve().then(()=>(me(),pe));this.settings=Object.assign({},Q,t(e))}catch(t){this.settings=Object.assign({},Q,e)}}async saveSettings(){await this.saveData(this.settings)}async showProjectRemovePrompt(){if(!this.settings.projectRecords){new E.Notice("You don't have any projects yet.");return}let e=this.settings.projectRecords,t=[...this.settings.dimensions].sort((p,m)=>{var g,P;return((g=p.order)!=null?g:0)-((P=m.order)!=null?P:0)}).map(p=>p.name),s=await this.promptForChoice("Select dimension of your project:",t);if(!s){new E.Notice("Project removal cancelled. No dimension selected.");return}let i=this.settings.dimensions.find(p=>p.name===s);if(!i||i.categories.length===0){new E.Notice("Selected dimension has no categories. No project to remove.");return}let c=i.categories,l=await this.promptForChoice("Select category:",c);if(!l){new E.Notice("Project removal cancelled. No category selected.");return}let a=await this.promptForChoice("Select Project to remove:",Object.keys(e[s][l]));if(!a){new E.Notice("Project deletion cancelled. No project was provided.");return}let[d,o]=await this.deleteProjectById(s,l,a);d&&new E.Notice("Project "+a+" has been successfully removed."),console.log(o)}async showProjectPrompt(){var g,P;let e=await this.promptForText("Enter project name:");if(!e){new E.Notice("Project creation cancelled. No project name provided.");return}let t=await this.promptForText("Enter project tag:");if(!t){new E.Notice("Project creation cancelled. No project tag provided.");return}let s=await this.promptForText("Enter Project ID (used for task prefixes):");if(!s){new E.Notice("Project creation cancelled. No Project ID provided.");return}let i=await this.promptForText("Enter parent name (optional):"),c=i&&i.trim().length>0?i.trim():null,l=[...this.settings.dimensions].sort((h,T)=>{var R,x;return((R=h.order)!=null?R:0)-((x=T.order)!=null?x:0)}).map(h=>h.name),a=await this.promptForChoice("Select dimension:",l);if(!a){new E.Notice("Project creation cancelled. No dimension selected.");return}let d=this.settings.dimensions.find(h=>h.name===a);if(!d||d.categories.length===0){new E.Notice("Selected dimension has no categories. Please add categories in settings first.");return}let o=d.categories,p=await this.promptForChoice("Select category:",o);if(!p){new E.Notice("Project creation cancelled. No category selected.");return}let m={name:e,tag:t,id:s,parent:c,dimension:a,category:p};try{let h=this.settings.projectRecords;if(h&&!Array.isArray(h)&&((P=(g=h[a])==null?void 0:g[p])==null?void 0:P[s])){new E.Notice(`Project with ID "${s}" already exists in ${a}:${p}. Choose a different ID.`);return}}catch(h){}try{let{validateProjectName:h,validateTag:T,ensureValidOrThrow:R}=await Promise.resolve().then(()=>(ue(),ge));R(()=>h(m.name),"Invalid project name"),R(()=>T(m.tag),"Invalid tag"),R(()=>T(m.id),"Invalid Project ID")}catch(h){let T=h.message||"Invalid input";console.error("Validation error:",h),new E.Notice(T);return}await this.createProject(m)}async promptForText(e){return new Promise(t=>{new q(this.app,e,t).open()})}async promptForChoice(e,t){return new Promise(s=>{new L(this.app,e,t,s).open()})}generateProjectVariables(e){let t=new Date,s=t.getFullYear().toString(),i=t.toISOString().split("T")[0],c=this.settings.projectsRoot||"1. Projects",l=e.parent&&e.parent.trim().length>0?`.${e.parent.trim()}`:"",a=`${s}${l}.${e.name}`,d=this.settings.dimensions.find(g=>g.name===e.dimension),o=d?`${d.order}. ${d.name}`:e.dimension,p=`${c}/${o}/${e.category}/${a}`,m=`${p}`;return{PROJECT_NAME:e.name,PROJECT_TAG:e.tag,PROJECT_PARENT:e.parent?e.parent:"",PARENT_TAG:e.parent?e.tag:"",YEAR:s,DATE:i,PROJECT_FULL_NAME:a,PROJECT_RELATIVE_PATH:p,PROJECT_PATH:m,DIMENSION:d?d.name:e.dimension,CATEGORY:e.category,PROJECT_ID:e.id,PROJECT_DIMENSION:d?d.name:e.dimension}}async processTemplate(e,t){try{let{processTemplate:s}=await Promise.resolve().then(()=>(fe(),ye));return s(e,t)}catch(s){console.warn("Template processor import failed, using legacy replacement:",s);let i=e;return Object.entries(t).forEach(([c,l])=>{let a=`$_${c}`;i=i.split(a).join(l)}),i}}async createProject(e){try{let t=this.generateProjectVariables(e),s=this.settings.projectsRoot||"1. Projects",{sanitizePath:i,sanitizeFileName:c}=await Promise.resolve().then(()=>(te(),ee)),{SafeFileManager:l}=await Promise.resolve().then(()=>(z(),U)),a=new l(this.app),d=i(s),o=this.settings.dimensions.find(u=>u.name===e.dimension),p=o?`${o.order}. ${o.name}`:e.dimension,m=c(p),g=c(e.category),P=i(`${d}/${m}/${g}/${t.PROJECT_FULL_NAME}`),T=[{type:"folder",path:P},...["Knowledge Base","Meetings","Work","Work/Tasks","People"].map(u=>({type:"folder",path:i(`${P}/${u}`)}))],R=this.app.vault.adapter,x=`.obsidian/plugins/${this.manifest.id}/src/templates`,M=[{fileName:`${t.PROJECT_FULL_NAME}.md`,template:"project.md"},{fileName:`${e.name} Meetings.md`,template:"meetings.md"},{fileName:`${e.name} People.md`,template:"people.md"},{fileName:`${e.name} Work.md`,template:"work.md"},{fileName:`${e.name} Knowledge Base.md`,template:"knowledge-base.md"}],H=[];for(let u of M){let y=`${x}/${u.template}`;if(!await R.exists(y))throw new Error(`Template file not found: ${u.template}`);let w=await R.read(y),v=await this.processTemplate(w,t),f=i(`${P}/${c(u.fileName)}`);H.push({type:"file",path:f,data:v})}let V=await a.createBatch([...T,...H]);if(!("ok"in V)||!V.ok)throw new Error(`Batch creation failed: ${V.error||"unknown"}`);await this.createProjectTemplates(e.name,t),await this.recordProjectCreation(e,t),new E.Notice(`Project "${e.name}" created successfully!`)}catch(t){new E.Notice(`Error creating project: ${t}`),console.error("Project creation error:",t)}}async recordProjectCreation(e,t){try{let s={info:e,variables:t,createdAt:new Date().toISOString()},i=e.dimension,c=e.category,l=e.id;if(!this.settings.projectRecords||Array.isArray(this.settings.projectRecords)){let d={},o=Array.isArray(this.settings.projectRecords)?this.settings.projectRecords:[];for(let p of o){let m=p.info.dimension,g=p.info.category,P=p.info.id;d[m]=d[m]||{},d[m][g]=d[m][g]||{},d[m][g][P]=p}this.settings.projectRecords=d}let a=this.settings.projectRecords;if(a[i]=a[i]||{},a[i][c]=a[i][c]||{},a[i][c][l])throw new Error(`Project with id "${l}" already exists in ${i}:${c}`);a[i][c][l]=s,await this.saveSettings()}catch(s){throw console.warn("Failed to record project creation:",s),s}}async ensureDirectoryExists(e){let{SafeFileManager:t}=await Promise.resolve().then(()=>(z(),U));await new t(this.app).ensureFolder(e)}async createProjectFile(e,t,s,i){try{let c=this.app.vault.adapter,l=`.obsidian/plugins/${this.manifest.id}/src/templates/${s}`;if(console.log("Template: "+l),!await c.exists(l))throw new Error(`Template file not found: ${s}`);let a=await this.app.vault.adapter.read(l),d=await this.processTemplate(a,i),o=`${e}/${t}`,{SafeFileManager:p}=await Promise.resolve().then(()=>(z(),U));await new p(this.app).createIfAbsent(o,d)}catch(c){throw console.error(`Failed to create ${t}:`,c),new Error(`Failed to create ${t}: ${c}`)}}async createProjectTemplates(e,t){let{sanitizePath:s,sanitizeFileName:i}=await Promise.resolve().then(()=>(te(),ee)),c=s(`Templates/${e}_Templates`);await this.ensureDirectoryExists(c);let l=[{source:"template-meeting-daily.md",target:`${e}_Meeting_Daily_Template.md`},{source:"template-meeting-discussion.md",target:`${e}_Meeting_Discussion_Template.md`},{source:"template-meeting-knowledge.md",target:`${e}_Meeting_Knowledge_Template.md`},{source:"template-meeting-planning.md",target:`${e}_Meeting_Planning_Template.md`},{source:"template-meeting-refinement.md",target:`${e}_Meeting_Refinement_Template.md`},{source:"template-meeting-retro.md",target:`${e}_Meeting_Retro_Template.md`},{source:"template-meeting-demo.md",target:`${e}_Meeting_Demo_Template.md`},{source:"template-sprint.md",target:`${e}_Sprint_Template.md`},{source:"template-task.md",target:`${e}_Task_Template.md`},{source:"template-idea.md",target:`${e}_Idea_Template.md`},{source:"template-knowledge-base-item.md",target:`${e}_Knowledge_Item_Template.md`}];for(let a of l)try{let d=i(a.target);await this.createProjectFile(c,d,a.source,t)}catch(d){console.warn(`Failed to create template ${a.target}: ${d}`)}}};var Oe=se;
