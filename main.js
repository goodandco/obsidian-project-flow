/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var Xe=Object.defineProperty;var sr=Object.getOwnPropertyDescriptor;var ar=Object.getOwnPropertyNames;var ir=Object.prototype.hasOwnProperty;var k=(e,t)=>()=>(e&&(t=e(e=0)),t);var G=(e,t)=>{for(var r in t)Xe(e,r,{get:t[r],enumerable:!0})},cr=(e,t,r,o)=>{if(t&&typeof t=="object"||typeof t=="function")for(let n of ar(t))!ir.call(e,n)&&n!==r&&Xe(e,n,{get:()=>t[n],enumerable:!(o=sr(t,n))||o.enumerable});return e};var lr=e=>cr(Xe({},"__esModule",{value:!0}),e);var ut={};G(ut,{DEFAULT_ENTITY_TYPES:()=>oe,DEFAULT_PROJECT_TYPES:()=>ie});var oe,ie,ye=k(()=>{oe={task:{id:"task",name:"Task",templatePath:"template-task.md",targetFolder:"Work/Tasks",filenameRule:"${PROJECT_ID}-${TITLE}",requiredFields:["TITLE"],patchMarkers:["AI:CONTENT","AI:ACTIONS"]},"meeting.planning":{id:"meeting.planning",name:"Meeting (Planning)",templatePath:"template-meeting-planning.md",targetFolder:"Meetings",filenameRule:"${DATE} ${TITLE}",requiredFields:["TITLE"],patchMarkers:["AI:AGENDA","AI:NOTES","AI:ACTIONS"]},"meeting.refinement":{id:"meeting.refinement",name:"Meeting (Refinement)",templatePath:"template-meeting-refinement.md",targetFolder:"Meetings",filenameRule:"${DATE} ${TITLE}",requiredFields:["TITLE"],patchMarkers:["AI:AGENDA","AI:NOTES","AI:ACTIONS"]},"meeting.retro":{id:"meeting.retro",name:"Meeting (Retro)",templatePath:"template-meeting-retro.md",targetFolder:"Meetings",filenameRule:"${DATE} ${TITLE}",requiredFields:["TITLE"],patchMarkers:["AI:AGENDA","AI:NOTES","AI:ACTIONS"]},"meeting.demo":{id:"meeting.demo",name:"Meeting (Demo)",templatePath:"template-meeting-demo.md",targetFolder:"Meetings",filenameRule:"${DATE} ${TITLE}",requiredFields:["TITLE"],patchMarkers:["AI:AGENDA","AI:NOTES","AI:ACTIONS"]},"meeting.daily":{id:"meeting.daily",name:"Meeting (Daily)",templatePath:"template-meeting-daily.md",targetFolder:"Meetings",filenameRule:"${DATE} ${TITLE}",requiredFields:["TITLE"],patchMarkers:["AI:AGENDA","AI:NOTES","AI:ACTIONS"]},"meeting.knowledge":{id:"meeting.knowledge",name:"Meeting (Knowledge)",templatePath:"template-meeting-knowledge.md",targetFolder:"Meetings",filenameRule:"${DATE} ${TITLE}",requiredFields:["TITLE"],patchMarkers:["AI:AGENDA","AI:NOTES","AI:ACTIONS"]},sprint:{id:"sprint",name:"Sprint",templatePath:"template-sprint.md",targetFolder:"Work",filenameRule:"Sprint ${TITLE}",requiredFields:["TITLE"],patchMarkers:["AI:CONTENT","AI:ACTIONS"]},idea:{id:"idea",name:"Idea",templatePath:"template-idea.md",targetFolder:"Knowledge Base",filenameRule:"Idea ${TITLE}",requiredFields:["TITLE"],patchMarkers:["AI:CONTENT"]}},ie={operational:{id:"operational",name:"Operational",description:"Default ProjectFlow structure for active projects.",folderStructure:["Knowledge Base","Meetings","Work","Work/Tasks","People"],initialNotes:[{fileName:"${PROJECT_FULL_NAME}.md",template:"project.md"},{fileName:"${PROJECT_NAME} Meetings.md",template:"meetings.md"},{fileName:"${PROJECT_NAME} People.md",template:"people.md"},{fileName:"${PROJECT_NAME} Work.md",template:"work.md"},{fileName:"${PROJECT_NAME} Knowledge Base.md",template:"knowledge-base.md"}],allowedEntityTypes:Object.keys(oe)}}});var ce={};G(ce,{SafeFileManager:()=>Ze});var Ze,le=k(()=>{Ze=class{constructor(t){this.vault=t.vault}async createBatch(t){let r=[];try{for(let o of t)o.type==="folder"?await this.ensureFolder(o.path):await this.createIfAbsent(o.path,o.data)==="created"&&r.push(o.path);return{ok:!0}}catch(o){for(let n of r.reverse())try{let s=this.vault.getAbstractFileByPath(n);s&&this.vault.delete&&await this.vault.delete(s)}catch(s){}return{ok:!1,error:o}}}async has(t){var r;try{return this.vault.getAbstractFileByPath(t)?!0:(r=this.vault.adapter)!=null&&r.exists?await this.vault.adapter.exists(t):!1}catch(o){return!1}}async ensureFolder(t){var o;if(!this.vault.getAbstractFileByPath(t))try{await this.vault.createFolder(t)}catch(n){if(n&&typeof n=="object"&&((o=n.message)!=null&&o.includes("Parent folder"))){let s=t.split("/").filter(Boolean),a="";for(let l of s)if(a=a?`${a}/${l}`:l,!this.vault.getAbstractFileByPath(a))try{await this.vault.createFolder(a)}catch(c){}}}}async createIfAbsent(t,r){if(await this.has(t))return"skipped";try{return await this.vault.create(t,r),"created"}catch(o){return await this.has(t),"skipped"}}async removeDir(t){let r=this.vault.getAbstractFileByPath(t);if(r&&this.vault)try{await this.vault.trash(r,!0),await new Promise(o=>setTimeout(o,200))}catch(o){console.warn(`removeDir: failed to trash ${t}: ${o}`)}else console.warn(`removeDir: file not found: ${t}. File: ${r==null?void 0:r.path}`)}}});var Pe={};G(Pe,{sanitizeFileName:()=>Ne,sanitizePath:()=>J});function Ne(e){let t=(e!=null?e:"").trim();return Array.from(t).filter(o=>o.charCodeAt(0)>=32).join("").replace(/[\\/:*?"<>|]/g,"-").replace(/\s+/g," ").replace(/\.+$/g,"").substring(0,200)||"untitled"}function J(e){return e?e.split("/").filter(Boolean).map(Ne).join("/"):""}var de=k(()=>{});var je={};G(je,{PROJECT_INDEX_VERSION:()=>Qe,addToProjectIndex:()=>pr,buildProjectIndex:()=>ht,ensureProjectIndex:()=>Se,getProjectIndexCache:()=>ke,removeFromProjectIndex:()=>mr,setProjectIndexCache:()=>dr,toIndexEntry:()=>qe});function ke(){return $e}function dr(e){$e=e}function ht(e){let t={},r={},o={};if(e&&typeof e=="object"){for(let[n,s]of Object.entries(e))if(!(!s||typeof s!="object")){for(let[a,l]of Object.entries(s))if(!(!l||typeof l!="object"))for(let[c,i]of Object.entries(l)){if(!i||!i.variables||!i.info)continue;let d=qe(i,c,n,a);t[d.fullName]=d,r[d.projectId]=d,o[d.projectTag]=d}}}return{version:1,byFullName:t,byId:r,byTag:o}}function qe(e,t,r,o){var n;return{fullName:e.variables.PROJECT_FULL_NAME,projectId:t,projectTag:e.variables.PROJECT_TAG,path:e.variables.PROJECT_PATH,dimension:r,category:o,projectName:e.info.name,parent:(n=e.info.parent)!=null?n:null}}function Se(e,t){if(!e||e.version!==1){let r=ht(t);return $e=r,{index:r,updated:!0}}return $e=e,{index:e,updated:!1}}function pr(e,t,r,o,n){let s=qe(t,r,o,n);return e.byFullName[s.fullName]=s,e.byId[s.projectId]=s,e.byTag[s.projectTag]=s,e}function mr(e,t){return delete e.byFullName[t.fullName],delete e.byId[t.projectId],delete e.byTag[t.projectTag],e}var Qe,$e,pe=k(()=>{Qe=1,$e=null});var we={};G(we,{PROJECT_GRAPH_VERSION:()=>et,addProjectToGraph:()=>fr,buildProjectGraph:()=>tt,cleanArchivedGraph:()=>rt,ensureProjectGraph:()=>Re,getChildren:()=>ot,getParents:()=>nt,getProjectGraphCache:()=>gr,removeProjectFromGraph:()=>hr,setProjectGraphCache:()=>ur});function gr(){return De}function ur(e){De=e}function tt(e,t){let r={},o={};return e&&yt(e,r),t&&yt(t,o),{version:1,byFullName:r,archivedByFullName:o}}function Re(e,t,r){if(!e||e.version!==1){let o=tt(t,r);return De=o,{graph:o,updated:!0}}return De=e,{graph:e,updated:!1}}function fr(e,t,r){let o=t.variables.PROJECT_FULL_NAME,n=Pt(t.info.parent),s=r?e.archivedByFullName:e.byFullName;if(s[o]=s[o]||{parent:n,children:[]},s[o].parent=n!=null?n:null,n){let a=s[n]||{parent:null,children:[]};a.children.includes(o)||a.children.push(o),s[n]=a}return e}function hr(e,t,r){let o=r?e.archivedByFullName:e.byFullName,n=o[t];return n!=null&&n.parent&&o[n.parent]&&(o[n.parent].children=o[n.parent].children.filter(s=>s!==t)),delete o[t],e}function rt(e,t){let r=tt(void 0,t);return e.archivedByFullName=r.archivedByFullName,e}function ot(e,t,r){var n,s;return(s=(n=(r?e.archivedByFullName:e.byFullName)[t])==null?void 0:n.children)!=null?s:[]}function nt(e,t,r){var a,l,c,i;let o=r?e.archivedByFullName:e.byFullName,n=[],s=(l=(a=o[t])==null?void 0:a.parent)!=null?l:null;for(;s;)n.push(s),s=(i=(c=o[s])==null?void 0:c.parent)!=null?i:null;return n}function yt(e,t){for(let r of Object.values(e))for(let o of Object.values(r))for(let n of Object.values(o)){if(!n||!n.variables)continue;let s=n.variables.PROJECT_FULL_NAME,a=Pt(n.info.parent);if(t[s]=t[s]||{parent:a,children:[]},t[s].parent=a!=null?a:null,a){let l=t[a]||{parent:null,children:[]};l.children.includes(s)||l.children.push(s),t[a]=l}}}function Pt(e){let t=e==null?void 0:e.trim();return t&&t.length>0?t:null}var et,De,me=k(()=>{et=1,De=null});var Tt={};G(Tt,{ensureValidOrThrow:()=>wr,validateProjectName:()=>jr,validateTag:()=>Rr});function jr(e){if(!e||!e.trim())return{ok:!1,reason:"Project name is required"};let t=e.trim();if(t.length>120)return{ok:!1,reason:"Project name too long (max 120)"};for(let r of t)if(r.charCodeAt(0)<32||r==="/"||r==="\\")return{ok:!1,reason:"Project name contains invalid characters"};return{ok:!0}}function Rr(e){if(!e||!e.trim())return{ok:!1,reason:"Tag is required"};let t=e.trim();return Pr.test(t)?{ok:!0}:{ok:!1,reason:"Tag must be 2-63 chars, start with letter/digit; may include -, _, /"}}function wr(e,t){let r=e();if(!r.ok)throw new Error(`${t}: ${r.reason}`)}var Pr,vt=k(()=>{Pr=/^[A-Za-z0-9][A-Za-z0-9_/-]{1,62}$/});var Be={};G(Be,{processTemplate:()=>Tr});function xt(e){return e==null?"":String(e)}function Tr(e,t){if(!e||typeof e!="string")return"";let r=e;for(let[o,n]of Object.entries(t)){let s=xt(n),a=`$_${o}`;r.includes(a)&&(r=r.split(a).join(s))}for(let[o,n]of Object.entries(t)){let s=xt(n),a=new RegExp(`\\$\\{${vr(o)}\\}`,"g");r=r.replace(a,s)}return r}function vr(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}var Ve=k(()=>{});function bt(e,t){let r=new Date,o=r.getFullYear().toString(),n=r.toISOString().split("T")[0],s=t.projectsRoot||"1. Projects",a=e.parent&&e.parent.trim().length>0?`.${e.parent.trim()}`:"",l=`${o}${a}.${e.name}`,c=t.dimensions.find(g=>g.name===e.dimension),i=c?`${c.order}. ${c.name}`:e.dimension,d=`${s}/${i}/${e.category}/${l}`,f=`${d}`;return{PROJECT_NAME:e.name,PROJECT_TAG:e.tag,PROJECT_PARENT:e.parent?e.parent:"",PARENT_TAG:e.parent?e.tag:"",YEAR:o,DATE:n,PROJECT_FULL_NAME:l,PROJECT_RELATIVE_PATH:d,PROJECT_PATH:f,DIMENSION:c?c.name:e.dimension,CATEGORY:e.category,PROJECT_ID:e.id,PROJECT_DIMENSION:c?c.name:e.dimension}}async function Je(e,t){try{let{processTemplate:r}=await Promise.resolve().then(()=>(Ve(),Be));return r(e,t)}catch(r){console.warn("Template processor import failed, using legacy replacement:",r);let o=e;return Object.entries(t).forEach(([n,s])=>{let a=`$_${n}`;o=o.split(a).join(s)}),o}}var At=k(()=>{});var It={};G(It,{mergeEntityTypes:()=>Ue,mergeProjectTypes:()=>fe});function Ue(e){let t={...oe};if(e&&typeof e=="object")for(let[r,o]of Object.entries(e))!o||typeof o!="object"||(t[r]={...t[r],...o,id:r});return t}function fe(e){let t={...ie};if(e&&typeof e=="object")for(let[r,o]of Object.entries(e))!o||typeof o!="object"||(t[r]={...t[r],...o,id:r});return t}var We=k(()=>{ye()});var Ft={};G(Ft,{resolveProjectType:()=>Er});function Er(e,t){let r=fe(e.projectTypes),o=t==null?void 0:t.projectTypeId,n=o&&r[o]?o:"operational",s=r[n]||r.operational;return{projectTypeId:n,projectType:s}}var Nt=k(()=>{We()});async function He(e,t){var r,o;try{let{resolveProjectType:n}=await Promise.resolve().then(()=>(Nt(),Ft)),{projectTypeId:s,projectType:a}=n(e.settings,t);t.projectTypeId=s;let l=bt(t,e.settings),c=e.settings.projectsRoot||"1. Projects",{sanitizePath:i,sanitizeFileName:d}=await Promise.resolve().then(()=>(de(),Pe)),{SafeFileManager:f}=await Promise.resolve().then(()=>(le(),ce)),g=new f(e.app),m=i(c),u=e.settings.dimensions.find(h=>h.name===t.dimension),y=u?`${u.order}. ${u.name}`:t.dimension,P=d(y),j=d(t.category),A=i(`${m}/${P}/${j}/${l.PROJECT_FULL_NAME}`),U=(r=a==null?void 0:a.folderStructure)!=null?r:["Knowledge Base","Meetings","Work","Work/Tasks","People"],q=[{type:"folder",path:A},...U.map(h=>({type:"folder",path:i(`${A}/${h}`)}))],O=e.app.vault.adapter,W=`.obsidian/plugins/${e.manifest.id}/src/templates`,p=(o=a==null?void 0:a.initialNotes)!=null?o:[{fileName:`${l.PROJECT_FULL_NAME}.md`,template:"project.md"},{fileName:`${t.name} Meetings.md`,template:"meetings.md"},{fileName:`${t.name} People.md`,template:"people.md"},{fileName:`${t.name} Work.md`,template:"work.md"},{fileName:`${t.name} Knowledge Base.md`,template:"knowledge-base.md"}],E=[];for(let h of p){let T=h.fileName?await Je(h.fileName,l):h.fileName,S=`${W}/${h.template}`;if(!await O.exists(S))throw new Error(`Template file not found: ${h.template}`);let B=await O.read(S),V=await Je(B,l),D=i(`${A}/${d(T)}`);E.push({type:"file",path:D,data:V})}let F=await g.createBatch([...q,...E]);if(!("ok"in F)||!F.ok)throw new Error(`Batch creation failed: ${F.error||"unknown"}`);return await Ar(e,t.name,l),await xr(e,t,l),[!0,`Project "${t.name}" created successfully!`]}catch(n){return[!1,`Error creating project: ${n}`]}}async function xr(e,t,r){try{let{ensureProjectIndex:o,addToProjectIndex:n}=await Promise.resolve().then(()=>(pe(),je)),{ensureProjectGraph:s,addProjectToGraph:a}=await Promise.resolve().then(()=>(me(),we)),l={info:t,variables:r,createdAt:new Date().toISOString()},c=t.dimension,i=t.category,d=t.id;if(!e.settings.projectRecords||Array.isArray(e.settings.projectRecords)){let u={},y=Array.isArray(e.settings.projectRecords)?e.settings.projectRecords:[];for(let P of y){let j=P.info.dimension,A=P.info.category,U=P.info.id;u[j]=u[j]||{},u[j][A]=u[j][A]||{},u[j][A][U]=P}e.settings.projectRecords=u}let f=e.settings.projectRecords;if(f[c]=f[c]||{},f[c][i]=f[c][i]||{},f[c][i][d])throw new Error(`Project with id "${d}" already exists in ${c}:${i}`);f[c][i][d]=l;let{index:g}=o(e.settings.projectIndex,f);e.settings.projectIndex=n(g,l,d,c,i);let{graph:m}=s(e.settings.projectGraph,f,e.settings.archivedRecords);e.settings.projectGraph=a(m,l,!1),await e.saveData(e.settings)}catch(o){throw console.warn("Failed to record project creation:",o),o}}async function br(e,t,r,o,n){try{let s=e.app.vault.adapter,a=`.obsidian/plugins/${e.manifest.id}/src/templates/${o}`;if(!await s.exists(a))throw new Error(`Template file not found: ${o}`);let l=await s.read(a),c=await Je(l,n),i=`${t}/${r}`,{SafeFileManager:d}=await Promise.resolve().then(()=>(le(),ce));await new d(e.app).createIfAbsent(i,c)}catch(s){throw console.error(`Failed to create ${r}:`,s),new Error(`Failed to create ${r}: ${s}`)}}async function Ar(e,t,r){let{sanitizePath:o,sanitizeFileName:n}=await Promise.resolve().then(()=>(de(),Pe)),{SafeFileManager:s}=await Promise.resolve().then(()=>(le(),ce)),a=new s(e.app),l=o(`Templates/${t}_Templates`);await a.ensureFolder(l);let c=[{source:"template-meeting-daily.md",target:`${t}_Meeting_Daily_Template.md`},{source:"template-meeting-discussion.md",target:`${t}_Meeting_Discussion_Template.md`},{source:"template-meeting-knowledge.md",target:`${t}_Meeting_Knowledge_Template.md`},{source:"template-meeting-planning.md",target:`${t}_Meeting_Planning_Template.md`},{source:"template-meeting-refinement.md",target:`${t}_Meeting_Refinement_Template.md`},{source:"template-meeting-retro.md",target:`${t}_Meeting_Retro_Template.md`},{source:"template-meeting-demo.md",target:`${t}_Meeting_Demo_Template.md`},{source:"template-sprint.md",target:`${t}_Sprint_Template.md`},{source:"template-task.md",target:`${t}_Task_Template.md`},{source:"template-idea.md",target:`${t}_Idea_Template.md`},{source:"template-knowledge-base-item.md",target:`${t}_Knowledge_Item_Template.md`},{source:"template-meeting-daily.md",target:"template-meeting-daily.md"},{source:"template-meeting-discussion.md",target:"template-meeting-discussion.md"},{source:"template-meeting-knowledge.md",target:"template-meeting-knowledge.md"},{source:"template-meeting-planning.md",target:"template-meeting-planning.md"},{source:"template-meeting-refinement.md",target:"template-meeting-refinement.md"},{source:"template-meeting-retro.md",target:"template-meeting-retro.md"},{source:"template-meeting-demo.md",target:"template-meeting-demo.md"},{source:"template-sprint.md",target:"template-sprint.md"},{source:"template-task.md",target:"template-task.md"},{source:"template-idea.md",target:"template-idea.md"},{source:"template-knowledge-base-item.md",target:"template-knowledge-base-item.md"}];for(let i of c)try{let d=n(i.target);await br(e,l,d,i.source,r)}catch(d){console.warn(`Failed to create template ${i.target}: ${d}`)}}var st=k(()=>{At()});var Dt={};G(Dt,{CURRENT_SETTINGS_SCHEMA_VERSION:()=>Ee,migrateSettings:()=>Ir});function Ir(e){var n,s,a,l,c,i,d,f;let t={dimensions:(n=e==null?void 0:e.dimensions)!=null?n:[],projectsRoot:(s=e==null?void 0:e.projectsRoot)!=null?s:"1. Projects",archiveRoot:(a=e==null?void 0:e.archiveRoot)!=null?a:"4. Archive",templatesRoot:(l=e==null?void 0:e.templatesRoot)!=null?l:"Templates/ProjectFlow",schemaVersion:(c=e==null?void 0:e.schemaVersion)!=null?c:0,projectRecords:{},archivedRecords:(i=e==null?void 0:e.archivedRecords)!=null?i:{},entityTypes:(d=e==null?void 0:e.entityTypes)!=null?d:{},projectTypes:(f=e==null?void 0:e.projectTypes)!=null?f:{},projectIndex:e==null?void 0:e.projectIndex,projectGraph:e==null?void 0:e.projectGraph},r=e==null?void 0:e.projectRecords;if(r&&typeof r=="object"&&!Array.isArray(r))t.projectRecords=r;else if(Array.isArray(r)){let g={};for(let m of r){if(!m||!m.info)continue;let u=m.info.dimension,y=m.info.category,P=m.info.id;!u||!y||!P||(g[u]=g[u]||{},g[u][y]=g[u][y]||{},g[u][y][P]=m)}t.projectRecords=g}else t.projectRecords={};if(Array.isArray(t.dimensions)){let g=1;t.dimensions=t.dimensions.map(m=>{var u;if(m&&typeof m=="object"){let y=(u=m.name)!=null?u:"",P=m.order,j=typeof y=="string"?y.match(/^\s*(\d+)\.\s*(.+)$/):null;return j&&(P=parseInt(j[1],10),y=j[2]),(P==null||Number.isNaN(P))&&(P=g++),{name:y,order:P,categories:Array.isArray(m.categories)?m.categories:[]}}return{name:String(m!=null?m:""),order:g++,categories:[]}})}else t.dimensions=[];let o=[...t.dimensions].sort((g,m)=>{var u,y;return((u=g.order)!=null?u:0)-((y=m.order)!=null?y:0)});return o.forEach((g,m)=>{g.order=m+1}),t.dimensions=o,(!t.schemaVersion||t.schemaVersion<Ee)&&((!t.entityTypes||Object.keys(t.entityTypes).length===0)&&(t.entityTypes=oe),(!t.projectTypes||Object.keys(t.projectTypes).length===0)&&(t.projectTypes=ie),t.schemaVersion=Ee),t}var Ee,lt=k(()=>{ye();Ee=3});function _t(e){return e?e.startsWith("/")||e.includes("\\")?!1:!e.split("/").filter(Boolean).some(r=>r==="."||r===".."):!0}function xe(e,t){let r=J(e),o=J(t);return o?r===o||r.startsWith(`${o}/`):!1}var Ot=k(()=>{de()});var Mt={};G(Mt,{listProjects:()=>dt,resolveArchivedProject:()=>Ye,resolveProject:()=>be});function be(e,t){var a,l,c;let r=ke()||Se(e.settings.projectIndex,e.settings.projectRecords).index,o=Ct(t),n=o.fullName&&r.byFullName[o.fullName]||o.id&&r.byId[o.id]||o.tag&&r.byTag[o.tag];if(!n)return null;let s=(c=(l=(a=e.settings.projectRecords)==null?void 0:a[n.dimension])==null?void 0:l[n.category])==null?void 0:c[n.projectId];return s?{entry:n,record:s}:null}function Ye(e,t){var n;let r=Ct(t),o=Fr(e.settings.archivedRecords,r);return o?{entry:{fullName:o.variables.PROJECT_FULL_NAME,projectId:o.info.id,projectTag:o.variables.PROJECT_TAG,path:o.variables.PROJECT_PATH,dimension:o.info.dimension,category:o.info.category,projectName:o.info.name,parent:(n=o.info.parent)!=null?n:null},record:o}:null}function dt(e){let t=ke()||Se(e.settings.projectIndex,e.settings.projectRecords).index;return Object.values(t.byFullName)}function Ct(e){var t,r,o;if(typeof e=="string"){let n=e.trim();return n.startsWith("project/")?{tag:n}:n.includes(".")?{fullName:n}:{id:n}}return{fullName:(t=e.fullName)==null?void 0:t.trim(),id:(r=e.id)==null?void 0:r.trim(),tag:(o=e.tag)==null?void 0:o.trim()}}function Fr(e,t){if(!e)return null;for(let r of Object.values(e))for(let o of Object.values(r))for(let n of Object.values(o))if(n&&(t.fullName&&n.variables.PROJECT_FULL_NAME===t.fullName||t.id&&n.info.id===t.id||t.tag&&n.variables.PROJECT_TAG===t.tag))return n;return null}var pt=k(()=>{pe()});async function Lt(e,t){let{resolveProject:r}=await Promise.resolve().then(()=>(pt(),Mt)),{mergeEntityTypes:o}=await Promise.resolve().then(()=>(We(),It)),{processTemplate:n}=await Promise.resolve().then(()=>(Ve(),Be)),{SafeFileManager:s}=await Promise.resolve().then(()=>(le(),ce)),a=r(e,t.projectRef);if(!a)throw new Error("Project not found for reference.");let c=o(e.settings.entityTypes)[t.entityTypeId];if(!c)throw new Error(`Entity type not found: ${t.entityTypeId}`);Nr(c,t.fields);let i={...a.record.variables,...t.fields||{}},d=await $r(e,c,a.record,i);if(!d)throw new Error(`Template not found for entity type: ${c.id}`);let g=await e.app.vault.adapter.read(d.path),m=n(g,i),u=n(c.targetFolder,i);if(!_t(u))throw new Error("Unsafe targetFolder path.");let y=J(a.record.variables.PROJECT_PATH),P=u?J(`${y}/${u}`):y;if(!xe(P,y))throw new Error("Target folder is outside project path.");if(!Gt(P,e.settings))throw new Error("Target folder is outside allowed roots.");let j=c.filenameRule||"Untitled",A=n(j,i),U=A.endsWith(".md")?A.slice(0,-3):A,q=Ne(U),O=J(`${P}/${q}.md`);if(!xe(O,y))throw new Error("Target file is outside project path.");if(!Gt(O,e.settings))throw new Error("Target file is outside allowed roots.");let W=new s(e.app);if(await W.ensureFolder(P),await W.has(O))throw new Error(`File already exists: ${O}`);return await W.createIfAbsent(O,m),{path:O}}function Gt(e,t){let r=t.projectsRoot||"1. Projects",o=t.archiveRoot||"4. Archive";return xe(e,r)||xe(e,o)}function Nr(e,t){if(!e.requiredFields||e.requiredFields.length===0)return;let r=e.requiredFields.filter(o=>t==null||t[o]==null||String(t[o]).trim()==="");if(r.length>0)throw new Error(`Missing required fields: ${r.join(", ")}`)}async function $r(e,t,r,o){let{processTemplate:n}=await Promise.resolve().then(()=>(Ve(),Be)),s=e.app.vault.adapter,a=n(t.templatePath,o),l=J(`Templates/${r.info.name}_Templates`),c=J(e.settings.templatesRoot||"Templates/ProjectFlow"),i=`.obsidian/plugins/${e.manifest.id}/src/templates`,d=g=>g.map(m=>m==="project"?{scope:m,path:J(`${l}/${a}`)}:m==="vault"?{scope:m,path:J(`${c}/${a}`)}:{scope:m,path:`${i}/${a}`}),f=t.templateScope?[t.templateScope,"builtin"].filter((g,m,u)=>u.indexOf(g)===m):["project","vault","builtin"];for(let g of d(f))if(await s.exists(g.path))return g;return null}var Bt=k(()=>{de();Ot()});function kr(e,t,r,o,n){let s=Sr(t),a=e.indexOf(s);if(a>=0){let l=e.indexOf(`
`,a),c=l>=0?l+1:e.length,i=Dr(e,c),d=i>=0?i:e.length;return{updated:!0,text:[e.slice(0,c),mt(r),e.slice(d)].join("")}}if(o==="strict")return{updated:!1,text:e};if(n){let l=Vt(e,n,r,o);if(l.updated)return l}return{updated:!0,text:Ht(e,n||"AI Notes",r)}}function Vt(e,t,r,o){let n=Wt(t),a=new RegExp(`^#{1,6}\\s+${Or(n)}\\s*$`,"m").exec(e);if(!a||a.index==null)return o==="strict"?{updated:!1,text:e}:{updated:!0,text:Ht(e,n,r)};let l=a.index,c=e.indexOf(`
`,l),i=c>=0?c+1:e.length,d=_r(e,i);return{updated:!0,text:[e.slice(0,i),mt(r),e.slice(d)].join("")}}async function Jt(e,t){var a;let r=e.vault.adapter,o=(a=t.patchMode)!=null?a:"lenient";if(!await r.exists(t.path))return{ok:!1,error:`File not found: ${t.path}`};let n=await r.read(t.path),s=kr(n,t.marker,t.content,o,t.fallbackHeading);return s.updated?(await r.write(t.path,s.text),{ok:!0}):{ok:!1,error:"Marker or heading not found in strict mode."}}async function Ut(e,t){var a;let r=e.vault.adapter,o=(a=t.patchMode)!=null?a:"lenient";if(!await r.exists(t.path))return{ok:!1,error:`File not found: ${t.path}`};let n=await r.read(t.path),s=Vt(n,t.heading,t.content,o);return s.updated?(await r.write(t.path,s.text),{ok:!0}):{ok:!1,error:"Heading not found in strict mode."}}function Sr(e){let t=e.trim();return t.startsWith("<!--")&&t.endsWith("-->")?t:`<!-- ${t} -->`}function Wt(e){return e.replace(/^#+\s*/,"").trim()}function Dr(e,t){let r=/<!--\s*AI:[A-Z_]+\s*-->/g;r.lastIndex=t;let o=r.exec(e);return o&&o.index!=null?o.index:-1}function _r(e,t){let r=/^#{1,6}\s+/gm;r.lastIndex=t;let o=r.exec(e);return o&&o.index!=null?o.index:e.length}function mt(e){let t=e!=null?e:"";return t.endsWith(`
`)?t:`${t}
`}function Ht(e,t,r){let o=Wt(t);return`${e.endsWith(`
`)?e:`${e}
`}
## ${o}
${mt(r)}`}function Or(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}var Yt=k(()=>{});function zt(e){if(e instanceof ne)return e;let t=e instanceof Error?e.message:"Unknown error";return new ne("validation_error",t)}var ne,gt=k(()=>{ne=class extends Error{constructor(r,o,n){super(o);this.code=r,this.details=n}}});function L(e,t){if(typeof e!="string"||e.trim().length===0)throw new ne("invalid_request",`${t} is required`,{field:t});return e.trim()}function ze(e){if(e==null)throw new ne("invalid_request","projectRef is required",{field:"projectRef"});if(typeof e=="string"){L(e,"projectRef");return}let t=typeof e.fullName=="string"&&e.fullName.trim().length>0,r=typeof e.id=="string"&&e.id.trim().length>0,o=typeof e.tag=="string"&&e.tag.trim().length>0;if(!t&&!r&&!o)throw new ne("invalid_request","projectRef must include fullName, id, or tag",{field:"projectRef"})}function Kt(e){L(e==null?void 0:e.name,"name"),L(e==null?void 0:e.tag,"tag"),L(e==null?void 0:e.id,"id"),L(e==null?void 0:e.dimension,"dimension"),L(e==null?void 0:e.category,"category")}function Xt(e){ze(e==null?void 0:e.projectRef),L(e==null?void 0:e.entityTypeId,"entityTypeId")}function Zt(e){L(e==null?void 0:e.path,"path"),L(e==null?void 0:e.marker,"marker"),L(e==null?void 0:e.content,"content")}function Qt(e){L(e==null?void 0:e.path,"path"),L(e==null?void 0:e.heading,"heading"),L(e==null?void 0:e.content,"content")}var qt=k(()=>{gt()});var er={};G(er,{createCoreApi:()=>Cr});function Cr(e){return{version:"1.0.0",capabilities:{resolveProject:!0,listProjects:!0,entityTypes:!0,projectTypes:!0,createProject:!0,createEntity:!0,patching:!0,projectGraph:!0,errorHandling:"throws"},compatibility:{settingsSchemaVersion:Ee,projectIndexVersion:1,projectGraphVersion:1},resolveProject:r=>(ze(r),be(e,r)),listProjects:()=>dt(e),listProjectTypes:()=>fe(e.settings.projectTypes),describeProjectType:r=>fe(e.settings.projectTypes)[r]||null,listEntityTypes:()=>Ue(e.settings.entityTypes),describeEntityType:r=>Ue(e.settings.entityTypes)[r]||null,createProject:async r=>(Kt(r),He(e,r)),createEntity:async r=>(Xt(r),Lt(e,r)),patchMarker:async r=>(Zt(r),Jt(e.app,r)),patchSection:async r=>(Qt(r),Ut(e.app,r)),getChildren:(r,o)=>{ze(r);let n=o?Ye(e,r):be(e,r);if(!n)return[];let{graph:s}=Re(e.settings.projectGraph,e.settings.projectRecords,e.settings.archivedRecords);return ot(s,n.entry.fullName,Boolean(o))},getParents:(r,o)=>{let n=o?Ye(e,r):be(e,r);if(!n)return[];let{graph:s}=Re(e.settings.projectGraph,e.settings.projectRecords,e.settings.archivedRecords);return nt(s,n.entry.fullName,Boolean(o))},clearArchivedProjectGraph:async()=>{let{graph:r}=Re(e.settings.projectGraph,e.settings.projectRecords,e.settings.archivedRecords);return e.settings.projectGraph=rt(r,e.settings.archivedRecords),await e.saveData(e.settings),{ok:!0}},wrapError:r=>{let o=zt(r);return{ok:!1,error:{code:o.code,message:o.message,details:o.details}}}}}var tr=k(()=>{We();st();Bt();Yt();pt();me();qt();gt();lt();pe();me()});var Gr={};G(Gr,{default:()=>Mr});module.exports=lr(Gr);var rr=require("obsidian");var x=require("obsidian");ye();var ft=require("obsidian"),Fe=class extends ft.Modal{constructor(r,o){super(r);this.onResult=o}onOpen(){let{contentEl:r}=this;r.empty(),r.addClass("project-flow-settings"),r.createEl("p",{text:"Do you want skip settings to defaults? This will override all custom settings."});let o=r.createDiv({cls:"gc-row"});o.createDiv({cls:"gc-spacer"});let n=o.createEl("button",{text:"Yes, use defaults"}),s=o.createEl("button",{text:"Go back"});n.onclick=()=>{this.close(),this.onResult(!0)},s.onclick=()=>{this.close(),this.onResult(!1)}}onClose(){this.contentEl.empty()}};async function _e(e,t,r,o){let n="",s=e.settings.projectRecords,a=s[t][r][o],{SafeFileManager:l}=await Promise.resolve().then(()=>(le(),ce)),c=new l(e.app),{sanitizePath:i}=await Promise.resolve().then(()=>(de(),Pe)),d=i(a.variables.PROJECT_PATH),f=i(`Templates/${a.info.name}_Templates`);try{await c.removeDir(d),await c.removeDir(f);try{s[t][r][o]&&(delete s[t][r][o],Object.keys(s[t][r]).length===0&&delete s[t][r],Object.keys(s[t]).length===0&&delete s[t]);try{let{ensureProjectIndex:g,removeFromProjectIndex:m,toIndexEntry:u}=await Promise.resolve().then(()=>(pe(),je)),{ensureProjectGraph:y,removeProjectFromGraph:P}=await Promise.resolve().then(()=>(me(),we)),{index:j}=g(e.settings.projectIndex,s);e.settings.projectIndex=m(j,u(a,o,t,r));let{graph:A}=y(e.settings.projectGraph,s,e.settings.archivedRecords);e.settings.projectGraph=P(A,a.variables.PROJECT_FULL_NAME,!1)}catch(g){console.warn("Failed to update projectIndex after delete:",g)}await e.saveData(e.settings),n="Project deleted successfully."}catch(g){n="Failed to update projectRecords after delete",console.warn(n,g)}return[!0,n]}catch(g){n="Error removing project: "+g.message,console.error("Error removing project:",g)}return[!1,n]}async function Oe(e,t,r,o){var n,s,a,l,c;try{let i=e.settings.projectRecords,d=(s=(n=i==null?void 0:i[t])==null?void 0:n[r])==null?void 0:s[o];if(!d)return[!1,"Project not found."];let{sanitizePath:f}=await Promise.resolve().then(()=>(de(),Pe)),{SafeFileManager:g}=await Promise.resolve().then(()=>(le(),ce)),m=new g(e.app),u=e.app.vault.adapter,y=f(d.variables.PROJECT_PATH),P=f(`Templates/${d.info.name}_Templates`),j=e.settings.archiveRoot||"4. Archive",A=d.variables.YEAR,U=d.variables.DIMENSION||d.info.dimension,q=d.info.category,O=d.info.parent&&d.info.parent.trim().length>0?d.info.parent.trim():null,W=d.info.name,p=O?`${A}.${U}.${q}.${O}.${W}`:`${A}.${U}.${q}.${W}`,E=f(`${j}/${p}`),F=h=>{let T=h.split("/").filter(Boolean);return T.pop(),T.join("/")};if(await m.ensureFolder(F(E)),!await u.exists(y))return[!1,`Project directory not found: ${y}`];if(await u.exists(E))return[!1,`Archive destination already exists: ${E}`];await u.rename(y,E);try{if(await u.exists(P)){let h=f(`${E}/Templates`);await m.ensureFolder(h);let T=f(`${h}/${d.info.name}_Templates`);if(await u.exists(T)){let S=f(`${h}/${d.info.name}_Templates_archived`);await u.rename(P,S)}else await u.rename(P,T)}}catch(h){console.warn("Archiving templates failed:",h)}try{let h=e.settings.projectRecords;(!e.settings.archivedRecords||Array.isArray(e.settings.archivedRecords))&&(e.settings.archivedRecords=e.settings.archivedRecords&&Array.isArray(e.settings.archivedRecords)?{}:e.settings.archivedRecords||{});let T=e.settings.archivedRecords;T[t]=T[t]||{},T[t][r]=T[t][r]||{},T[t][r][o]=d,(l=(a=h==null?void 0:h[t])==null?void 0:a[r])!=null&&l[o]&&(delete h[t][r][o],Object.keys(h[t][r]).length===0&&delete h[t][r],Object.keys(h[t]||{}).length===0&&delete h[t]);try{let{ensureProjectIndex:S,removeFromProjectIndex:B,toIndexEntry:V}=await Promise.resolve().then(()=>(pe(),je)),{ensureProjectGraph:D,removeProjectFromGraph:Z,addProjectToGraph:se}=await Promise.resolve().then(()=>(me(),we)),{index:ae}=S(e.settings.projectIndex,h);e.settings.projectIndex=B(ae,V(d,o,t,r));let{graph:v}=D(e.settings.projectGraph,h,T);e.settings.projectGraph=Z(v,d.variables.PROJECT_FULL_NAME,!1),e.settings.projectGraph=se(e.settings.projectGraph,d,!0)}catch(S){console.warn("Failed to update projectIndex after archive:",S)}await e.saveData(e.settings)}catch(h){console.warn("Failed to move project record to archive in settings:",h)}return[!0,"Project archived successfully."]}catch(i){return console.error("Archive failed:",i),[!1,(c=i==null?void 0:i.message)!=null?c:"Failed to archive project."]}}var yr=[{name:"Business",order:1,categories:["R&D","Jobs","OpenSource","Education"]},{name:"Family",order:2,categories:["Vacations","Parenting","Common"]},{name:"Friends",order:3,categories:[]},{name:"Health",order:4,categories:["Clinics","Issues","R&D"]},{name:"Personal",order:5,categories:["R&D","Languages","SelfManagement","Writing","Reading","Music","Sports"]},{name:"Residence",order:6,categories:[]}],Me={dimensions:JSON.parse(JSON.stringify(yr)),projectsRoot:"1. Projects",archiveRoot:"4. Archive",templatesRoot:"Templates/ProjectFlow",projectRecords:{},archivedRecords:{},projectGraph:{version:1,byFullName:{},archivedByFullName:{}},entityTypes:oe,projectTypes:ie};function jt(e){let t=0;for(let r=0;r<e.length;r++)t=(t<<5)-t+e.charCodeAt(r),t|=0;return t}var Ce=class extends x.PluginSettingTab{constructor(r,o){super(r,o);this.plugin=o}display(){var W;let{containerEl:r}=this;r.empty(),r.addClass("project-flow-settings");let o=r.createDiv({cls:"gc-row"});o.createDiv({cls:"gc-spacer"});let n=o.createEl("button",{cls:["gc-icon-button","clickable-icon"],attr:{"aria-label":"Reset to defaults",title:"Reset to defaults"}});try{(0,x.setIcon)(n,"rotate-ccw")}catch(p){n.setText("Reset to defaults")}n.onclick=()=>{new Fe(this.app,async E=>{E&&(this.plugin.settings=JSON.parse(JSON.stringify(Me)),await this.plugin.saveSettings(),new x.Notice("Settings were reset to defaults."),this.display())}).open()},r.createEl("h2",{text:"Folders"});let s=r.createDiv({cls:"gc-column"}),a=s.createDiv({cls:"setting-item"});a.createEl("label",{text:"Projects root"});let l=a.createEl("input",{type:"text"});l.value=this.plugin.settings.projectsRoot||"1. Projects",l.placeholder="e.g. 1. Projects",l.onchange=async()=>{this.plugin.settings.projectsRoot=l.value.trim()||"1. Projects",await this.plugin.saveSettings()};let c=s.createDiv({cls:"setting-item"});c.createEl("label",{text:"Archive root"});let i=c.createEl("input",{type:"text"});i.value=this.plugin.settings.archiveRoot||"4. Archive",i.placeholder="e.g. 4. Archive",i.onchange=async()=>{this.plugin.settings.archiveRoot=i.value.trim()||"4. Archive",await this.plugin.saveSettings()};let d=s.createDiv({cls:"setting-item"});d.createEl("label",{text:"Templates root"});let f=d.createEl("input",{type:"text"});f.value=this.plugin.settings.templatesRoot||"Templates/ProjectFlow",f.placeholder="e.g. Templates/ProjectFlow",f.onchange=async()=>{this.plugin.settings.templatesRoot=f.value.trim()||"Templates/ProjectFlow",await this.plugin.saveSettings()},r.createEl("h2",{text:"Dimensions"}),[...this.plugin.settings.dimensions].sort((p,E)=>{var F,h;return((F=p.order)!=null?F:0)-((h=E.order)!=null?h:0)}).forEach((p,E)=>{let F=r.createDiv({cls:"dimension-setting"}),h=F.createDiv({cls:"dimension-header"});h.addClass("gc-row"),h.createSpan({text:`${p.order}. `});let T=h.createEl("b",{text:p.name});h.createDiv({cls:"gc-spacer"});let S=h.createEl("button",{cls:["gc-icon-button","clickable-icon"]});S.setAttr("aria-label","Move up"),S.setAttr("title","Move up");try{(0,x.setIcon)(S,"arrow-up")}catch(v){S.setText("Up")}S.onclick=async()=>{let b=[...this.plugin.settings.dimensions].filter(N=>{var I,w;return((I=N.order)!=null?I:0)<((w=p.order)!=null?w:0)}).sort((N,I)=>{var w,$;return((w=I.order)!=null?w:0)-(($=N.order)!=null?$:0)})[0];if(!b)return;let R=b.order;b.order=p.order,p.order=R,await this.plugin.saveSettings(),this.display()};let B=h.createEl("button",{cls:["gc-icon-button","clickable-icon"]});B.setAttr("aria-label","Move down"),B.setAttr("title","Move down");try{(0,x.setIcon)(B,"arrow-down")}catch(v){B.setText("Down")}B.onclick=async()=>{let b=[...this.plugin.settings.dimensions].filter(N=>{var I,w;return((I=N.order)!=null?I:0)>((w=p.order)!=null?w:0)}).sort((N,I)=>{var w,$;return((w=N.order)!=null?w:0)-(($=I.order)!=null?$:0)})[0];if(!b)return;let R=b.order;b.order=p.order,p.order=R,await this.plugin.saveSettings(),this.display()};let V=h.createEl("button",{cls:["gc-icon-button","clickable-icon"]});V.setAttr("aria-label",`Delete ${p.name}`),V.setAttr("title",`Delete ${p.name}`);try{(0,x.setIcon)(V,"trash")}catch(v){V.setText("Remove")}V.onclick=async()=>{let v=this.plugin.settings.dimensions.findIndex(b=>b===p);v>=0&&this.plugin.settings.dimensions.splice(v,1),await this.plugin.saveSettings(),this.display()};let D=h.createEl("button",{cls:["gc-icon-button","clickable-icon"]});D.setAttr("aria-label",`Rename ${p.name}`),D.setAttr("title",`Rename ${p.name}`);try{(0,x.setIcon)(D,"pencil")}catch(v){D.setText("Edit")}if(D.onclick=async()=>{var ee;let v=p.name,b=T.parentElement;(ee=T.detach)==null||ee.call(T),D.style.display="none",V.style.display="none";let R=b.createEl("input",{type:"text"});R.value=v,R.addClass("gc-rename");let N=b.createDiv({cls:"gc-row"});N.createDiv({cls:"gc-spacer"});let I=N.createEl("button",{cls:["gc-icon-button","clickable-icon"]});I.setAttr("aria-label","Apply"),I.setAttr("title","Apply");try{(0,x.setIcon)(I,"check")}catch(C){I.setText("Apply")}let w=N.createEl("button",{cls:["gc-icon-button","clickable-icon"]});w.setAttr("aria-label","Discard"),w.setAttr("title","Discard");try{(0,x.setIcon)(w,"x")}catch(C){w.setText("Discard")}let $=()=>{this.display()},H=async C=>{let Y=C.trim();if(!Y||Y===v){$();return}if(this.plugin.settings.dimensions.some(he=>he!==p&&he.name===Y)){new x.Notice("A dimension with this name already exists.");return}p.name=Y,await this.plugin.saveSettings(),$()};I.onclick=async()=>{await H(R.value)},w.onclick=()=>$(),R.focus(),R.select(),R.onkeydown=async C=>{C.key==="Enter"&&await H(R.value),C.key==="Escape"&&$()},R.onblur=async()=>{await H(R.value)}},p.categories.length>0){let v=F.createDiv({cls:"categories-list gc-list"});p.categories.forEach((b,R)=>{var he;let N=v.createDiv({cls:"gc-list-item gc-row"}),I=this.plugin.settings.projectRecords||{},w=p.name,$=Object.keys(((he=I==null?void 0:I[w])==null?void 0:he[b])||{}),H=N.createEl("b",{text:b}),ee=N.createDiv({cls:"gc-id-wrap"});$.length>0&&(ee.createSpan({text:" "}),$.forEach((M,Ae)=>{let _=ee.createSpan({cls:"gc-id-chip"});_.style.display="inline-flex",_.style.alignItems="center",_.style.gap="4px";let ge=_.createSpan({cls:"gc-id-tag",text:M}),te=Math.abs(jt(M))%360;ge.style.backgroundColor=`hsl(${te}, 70%, 90%)`,ge.style.color=`hsl(${te}, 70%, 25%)`;let z=_.createSpan({cls:"gc-id-actions"});z.style.display="none";let K=z.createEl("button",{cls:["gc-icon-button","clickable-icon"]});K.setAttr("aria-label",`Delete ${M}`),K.setAttr("title",`Delete ${M}`);try{(0,x.setIcon)(K,"trash")}catch(re){K.setText("Del")}K.onclick=async re=>{re.stopPropagation();let[,X]=await _e(this.plugin,w,b,M);new x.Notice(X),this.display()};let Q=z.createEl("button",{cls:["gc-icon-button","clickable-icon"]});Q.setAttr("aria-label",`Archive ${M}`),Q.setAttr("title",`Archive ${M}`);try{(0,x.setIcon)(Q,"archive")}catch(re){Q.setText("Arc")}Q.onclick=async re=>{re.stopPropagation();let[,X]=await Oe(this.plugin,w,b,M);new x.Notice(X),this.display()},_.onmouseenter=()=>{z.style.display="inline-flex"},_.onmouseleave=()=>{z.style.display="none"},Ae<$.length-1&&ee.createSpan({text:" "})})),N.createDiv({cls:"gc-spacer"});let C=N.createEl("button",{cls:["remove-category","gc-icon-button","clickable-icon"]});C.setAttr("aria-label",`Delete ${b}`),C.setAttr("title",`Delete ${b}`);try{(0,x.setIcon)(C,"trash")}catch(M){C.setText("Remove")}C.onclick=async()=>{p.categories.splice(R,1),await this.plugin.saveSettings(),this.display()};let Y=N.createEl("button",{cls:["gc-icon-button","clickable-icon"]});Y.setAttr("aria-label",`Rename ${b}`),Y.setAttr("title",`Rename ${b}`);try{(0,x.setIcon)(Y,"pencil")}catch(M){Y.setText("Edit")}Y.onclick=async()=>{var re;let M=p.categories[R],Ae=H.parentElement;(re=H.detach)==null||re.call(H),Y.style.display="none",C.style.display="none";let _=Ae.createEl("input",{type:"text"});_.value=M,_.addClass("gc-rename");let ge=Ae.createDiv({cls:"gc-row"});ge.createDiv({cls:"gc-spacer"});let te=ge.createEl("button",{cls:["gc-icon-button","clickable-icon"]});te.setAttr("aria-label","Apply"),te.setAttr("title","Apply");try{(0,x.setIcon)(te,"check")}catch(X){te.setText("Apply")}let z=ge.createEl("button",{cls:["gc-icon-button","clickable-icon"]});z.setAttr("aria-label","Discard"),z.setAttr("title","Discard");try{(0,x.setIcon)(z,"x")}catch(X){z.setText("Discard")}let K=()=>{this.display()},Q=async X=>{let Ie=X.trim();if(!Ie||Ie===M){K();return}if(p.categories.some((or,nr)=>nr!==R&&or===Ie)){new x.Notice("This category already exists in the dimension.");return}p.categories[R]=Ie,await this.plugin.saveSettings(),K()};te.onclick=async()=>{await Q(_.value)},z.onclick=()=>K(),_.focus(),_.select(),_.onkeydown=async X=>{X.key==="Enter"&&await Q(_.value),X.key==="Escape"&&K()},_.onblur=async()=>{await Q(_.value)}}})}let Z=F.createDiv({cls:"add-category gc-row"}),se=Z.createEl("input",{type:"text",placeholder:"New category"});Z.createDiv({cls:"gc-spacer"});let ae=Z.createEl("button",{text:"Add Category"});ae.onclick=async()=>{let v=se.value.trim();v&&!p.categories.includes(v)&&(p.categories.push(v),await this.plugin.saveSettings(),this.display())}});let m=r.createDiv({cls:"add-dimension"});m.createEl("h3",{text:"Add new dimension"});let u=m.createDiv({cls:"gc-row"}),y=u.createEl("input",{type:"text",placeholder:"Dimension name"});u.createDiv({cls:"gc-spacer"});let P=u.createEl("button",{text:"Add Dimension"});P.onclick=async()=>{let p=y.value.trim();if(p&&!this.plugin.settings.dimensions.some(E=>E.name===p)){{let E=this.plugin.settings.dimensions.reduce((F,h)=>{var T;return Math.max(F,(T=h.order)!=null?T:0)},0);this.plugin.settings.dimensions.push({name:p,order:E+1,categories:[]})}await this.plugin.saveSettings(),this.display()}},r.createEl("h2",{text:"Archive"});let j=this.plugin.settings.archivedRecords||{},A=j&&!Array.isArray(j)?j:{},U={};for(let p of this.plugin.settings.dimensions)U[p.name]=(W=p.order)!=null?W:Number.MAX_SAFE_INTEGER;let q=Object.keys(A).map(p=>{var E;return{name:p,order:(E=U[p])!=null?E:Number.MAX_SAFE_INTEGER}}).sort((p,E)=>p.order-E.order||p.name.localeCompare(E.name)),O=!1;q.forEach(({name:p,order:E})=>{let F=A[p]||{},h=Object.keys(F).filter(D=>Object.keys(F[D]||{}).length>0).sort();if(h.length===0)return;O=!0;let T=r.createDiv({cls:"dimension-setting"}),S=T.createDiv({cls:"dimension-header gc-row"}),B=this.plugin.settings.dimensions.find(D=>D.name===p);B&&S.createSpan({text:`${B.order}. `}),S.createEl("b",{text:p}),S.createDiv({cls:"gc-spacer"});let V=T.createDiv({cls:"categories-list gc-list"});h.forEach(D=>{let Z=V.createDiv({cls:"gc-list-item gc-row"}),se=Object.keys((F==null?void 0:F[D])||{}).sort();Z.createEl("b",{text:D});let ae=Z.createDiv({cls:"gc-id-wrap"});se.length>0&&(ae.createSpan({text:" "}),se.forEach((v,b)=>{let R=ae.createSpan({cls:"gc-id-chip"});R.style.display="inline-flex",R.style.alignItems="center",R.style.gap="4px";let N=R.createSpan({cls:"gc-id-tag",text:v}),I=Math.abs(jt(v))%360;N.style.backgroundColor=`hsl(${I}, 70%, 90%)`,N.style.color=`hsl(${I}, 70%, 25%)`;let w=R.createSpan({cls:"gc-id-actions"});w.style.display="none";let $=w.createEl("button",{cls:["gc-icon-button","clickable-icon"]});$.setAttr("aria-label",`Delete ${v}`),$.setAttr("title",`Delete ${v}`);try{(0,x.setIcon)($,"trash")}catch(H){$.setText("Del")}$.onclick=async H=>{H.stopPropagation();let[,ee]=await this.plugin.deleteArchivedProject(p,D,v);new x.Notice(ee),this.display()},R.onmouseenter=()=>{w.style.display="inline-flex"},R.onmouseleave=()=>{w.style.display="none"},b<se.length-1&&ae.createSpan({text:" "})})),Z.createDiv({cls:"gc-spacer"})})}),O||r.createDiv({cls:"setting-item"}).createSpan({text:"No archived projects yet."})}};var at=require("obsidian");var Rt=require("obsidian"),Ge=class extends Rt.Modal{constructor(r,o,n){super(r);this.prompt=o,this.callback=n}onOpen(){let{contentEl:r}=this;r.createEl("h2",{text:this.prompt});let o=r.createEl("input",{type:"text"});o.focus();let n=r.createEl("button",{text:"Submit"});n.onclick=()=>{let s=o.value.trim();this.close(),this.callback(s||null)}}onClose(){let{contentEl:r}=this;r.empty()}};var wt=require("obsidian"),Te=class extends wt.Modal{constructor(r,o,n,s){super(r);this.prompt=o,this.choices=n,this.callback=s}onOpen(){let{contentEl:r}=this;r.createEl("h2",{text:this.prompt}),this.choices.forEach(o=>{let n=r.createEl("button",{text:o});n.onclick=()=>{this.close(),this.callback(o)}})}onClose(){let{contentEl:r}=this;r.empty()}};async function ve(e,t){return new Promise(r=>{new Ge(e,t,r).open()})}async function ue(e,t,r){return new Promise(o=>{new Te(e,t,r,o).open()})}async function Et(e,t){var m,u;let r=await ve(e,"Enter project name:");if(!r)return[null,"Project creation cancelled. No project name provided."];let o=await ve(e,"Enter project tag:");if(!o)return[null,"Project creation cancelled. No project tag provided."];let n=await ve(e,"Enter Project ID (used for task prefixes):");if(!n)return[null,"Project creation cancelled. No Project ID provided."];let s=await ve(e,"Enter parent name (optional):"),a=s&&s.trim().length>0?s.trim():null,l=[...t.dimensions].sort((y,P)=>{var j,A;return((j=y.order)!=null?j:0)-((A=P.order)!=null?A:0)}).map(y=>y.name),c=await ue(e,"Select dimension:",l);if(!c)return[null,"Project creation cancelled. No dimension selected."];let i=t.dimensions.find(y=>y.name===c);if(!i||i.categories.length===0)return[null,"Selected dimension has no categories. Please add categories in settings first."];let d=i.categories,f=await ue(e,"Select category:",d);if(!f)return[null,"Project creation cancelled. No category selected."];let g={name:r,tag:o,id:n,parent:a,dimension:c,category:f};try{let y=t.projectRecords;if(y&&!Array.isArray(y)&&((u=(m=y[c])==null?void 0:m[f])==null?void 0:u[n]))return[null,`Project with ID "${n}" already exists in ${c}:${f}. Choose a different ID.`]}catch(y){}try{let{validateProjectName:y,validateTag:P,ensureValidOrThrow:j}=await Promise.resolve().then(()=>(vt(),Tt));j(()=>y(g.name),"Invalid project name"),j(()=>P(g.tag),"Invalid tag"),j(()=>P(g.id),"Invalid Project ID")}catch(y){let P=y.message||"Invalid input";return console.error("Validation error:",y),[null,P]}return[g,"Project details collected."]}async function Le(e,t){var d;if(!t.projectRecords)return[null,"You don't have any projects yet."];let r=t.projectRecords,o=[...t.dimensions].sort((f,g)=>{var m,u;return((m=f.order)!=null?m:0)-((u=g.order)!=null?u:0)}).map(f=>f.name),n=await ue(e,"Select dimension of your project:",o);if(!n)return[null,"Project action cancelled. No dimension selected."];let s=t.dimensions.find(f=>f.name===n);if(!s||s.categories.length===0)return[null,"Selected dimension has no categories. No project found."];let a=s.categories,l=await ue(e,"Select category:",a);if(!l)return[null,"Project action cancelled. No category selected."];let c=(d=r[n])==null?void 0:d[l];if(!c||Object.keys(c).length===0)return[null,"No projects found in this category."];let i=await ue(e,"Select Project:",Object.keys(c));return i?[{dimension:n,category:l,projectId:i},"Project details collected."]:[null,"Project action cancelled. No project selected."]}st();async function $t(e){let[t,r]=await Et(e.app,e.settings);if(t===null){new at.Notice(r);return}let[,o]=await He(e,t);new at.Notice(o),console.log(o)}var it=require("obsidian");async function kt(e){let[t,r]=await Le(e.app,e.settings);if(t===null){new it.Notice(r);return}let{dimension:o,category:n,projectId:s}=t,[,a]=await _e(e,o,n,s);new it.Notice(a),console.log(a)}var ct=require("obsidian");async function St(e){let[t,r]=await Le(e.app,e.settings);if(t===null){new ct.Notice(r);return}let{dimension:o,category:n,projectId:s}=t,[,a]=await Oe(e,o,n,s);new ct.Notice(a),console.log(a)}var Ke=class extends rr.Plugin{async onload(){console.log("ProjectFlow plugin loaded"),await this.loadSettings(),this.addSettingTab(new Ce(this.app,this)),this.addCommand({id:"add-project-info",name:"Add Project Info",callback:()=>$t(this)}),this.addCommand({id:"remove-project-by-id",name:"Remove Project",callback:()=>kt(this)}),this.addCommand({id:"archive-project-by-id",name:"Archive Project",callback:()=>St(this)}),await this.exposeCoreApi()}async loadSettings(){let r=await this.loadData();try{let{migrateSettings:o,CURRENT_SETTINGS_SCHEMA_VERSION:n}=await Promise.resolve().then(()=>(lt(),Dt)),{DEFAULT_ENTITY_TYPES:s,DEFAULT_PROJECT_TYPES:a}=await Promise.resolve().then(()=>(ye(),ut)),{ensureProjectIndex:l}=await Promise.resolve().then(()=>(pe(),je)),{ensureProjectGraph:c}=await Promise.resolve().then(()=>(me(),we));this.settings=Object.assign({},Me,o(r));let i=!1;this.settings.templatesRoot||(this.settings.templatesRoot="Templates/ProjectFlow",i=!0),(!this.settings.entityTypes||Object.keys(this.settings.entityTypes).length===0)&&(this.settings.entityTypes=s,i=!0),(!this.settings.projectTypes||Object.keys(this.settings.projectTypes).length===0)&&(this.settings.projectTypes=a,i=!0),(!this.settings.schemaVersion||this.settings.schemaVersion<n)&&(this.settings.schemaVersion=n,i=!0);let{index:d,updated:f}=l(this.settings.projectIndex,this.settings.projectRecords);f&&(this.settings.projectIndex=d,i=!0);let{graph:g,updated:m}=c(this.settings.projectGraph,this.settings.projectRecords,this.settings.archivedRecords);m&&(this.settings.projectGraph=g,i=!0),i&&await this.saveData(this.settings)}catch(o){this.settings=Object.assign({},Me,r)}}async saveSettings(){await this.saveData(this.settings)}getApi(){return this.coreApi}async exposeCoreApi(){let{createCoreApi:r}=await Promise.resolve().then(()=>(tr(),er));this.coreApi=r(this);let o=window;o.PluginApi=o.PluginApi||{},o.PluginApi["@projectflow/core"]=this.coreApi}};var Mr=Ke;
